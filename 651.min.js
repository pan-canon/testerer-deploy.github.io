"use strict";(self.webpackChunktesterer_deploy_github_io=self.webpackChunktesterer_deploy_github_io||[]).push([[651],{651:(e,t,n)=>{n.r(t),n.d(t,{ChatScenarioManager:()=>a});var o=n(470),i=n(713);class a{constructor(e,t=null){this.chatManager=e,this.scenarioConfig=t,this.currentDialogueIndex=0,this.onScenarioEnd=null}async init(){if(!this.scenarioConfig)try{const e=await fetch(`${o.o2}/config/chatDialogueConfig.json`);if(!e.ok)throw new Error("Failed to load dialogue configuration from 'src/config/chatDialogueConfig.json'");this.scenarioConfig=await e.json()}catch(e){return void console.error("Error loading dialogue configuration:",e)}if("true"===i.f.get(this.chatManager.getStateKey("chat_conversation_completed")))return void console.log("Chat conversation already completed, skipping dialogue initialization.");const e=i.f.get(this.chatManager.getStateKey("chat_currentDialogueIndex"));this.currentDialogueIndex=null!==e?parseInt(e,10):0,this.loadCurrentDialogue()}loadCurrentDialogue(){if(!this.scenarioConfig||!this.scenarioConfig.dialogues)return void console.error("Scenario configuration is missing or invalid.");const e=this.scenarioConfig.dialogues[this.currentDialogueIndex];e?this.chatManager.loadDialogue(e):console.warn("No dialogue found at the current index.")}advanceDialogue(e){const t=this.scenarioConfig.dialogues[this.currentDialogueIndex];if(!t||!Array.isArray(t.options)||t.options.length<=e)return void console.error("Invalid option index.");const n=t.options[e];n&&"function"==typeof n.onSelect&&n.onSelect(),n&&"number"==typeof n.nextDialogueIndex?(this.currentDialogueIndex=n.nextDialogueIndex,i.f.set(this.chatManager.getStateKey("chat_currentDialogueIndex"),this.currentDialogueIndex),this.loadCurrentDialogue()):(console.log("No next dialogue defined; scenario may have ended."),i.f.set(this.chatManager.getStateKey("chat_conversation_completed"),"true"),i.f.remove(this.chatManager.getStateKey("chat_currentDialogueIndex")),i.f.remove(this.chatManager.getStateKey("chat_started")),"function"==typeof this.onScenarioEnd&&this.onScenarioEnd())}setScenario(e){this.scenarioConfig=e,this.currentDialogueIndex=0,i.f.set(this.chatManager.getStateKey("chat_currentDialogueIndex"),this.currentDialogueIndex),this.loadCurrentDialogue()}setOnScenarioEnd(e){"function"==typeof e&&(this.onScenarioEnd=e)}}}}]);