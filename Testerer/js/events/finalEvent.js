import { BaseEvent } from './baseEvent.js';

/**
 * FinalEvent ‚Äì –ø—Ä–∏–º–µ—Ä –∑–∞–≤–µ—Ä—à–∞—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è (—Ñ–∏–Ω–∞–ª–∞),
 * –∫–æ—Ç–æ—Ä–æ–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –¥–Ω–µ–≤–Ω–∏–∫ –∏ –º–æ–∂–µ—Ç —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ —Ç–æ–º,
 * —á—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–∏–∑—Ä–∞–∫–∞ (–∏–ª–∏ –≤—Å–µ–π –∏–≥—Ä—ã) –ø–æ–¥–æ—à—ë–ª –∫ –∫–æ–Ω—Ü—É.
 */
export class FinalEvent extends BaseEvent {
  /**
   * @param {EventManager} eventManager ‚Äì –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–Ω–µ–≤–Ω–∏–∫–∞ (EventManager).
   * @param {App} appInstance ‚Äì –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
   * @param {LanguageManager} [languageManager] ‚Äì –ú–µ–Ω–µ–¥–∂–µ—Ä –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
   */
  constructor(eventManager, appInstance, languageManager) {
    super(eventManager);
    this.app = appInstance;
    this.languageManager = languageManager;

    // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.
    // –ú–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å 'final_event' –∏–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—Ö–æ–∂–µ–µ.
    this.key = "final_event";
  }

  /**
   * activate ‚Äì –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.
   * –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –ø–æ—Å—Ç–∞ "–∫–æ–Ω–µ—Ü –∏–≥—Ä—ã", –º–µ–Ω—è—Ç—å UI, –∏ —Ç.–¥.
   */
  async activate() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–æ –ª–∏ —É–∂–µ —Å–æ–±—ã—Ç–∏—è:
    if (this.eventManager.isEventLogged(this.key)) {
      console.log(`–°–æ–±—ã—Ç–∏–µ '${this.key}' —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º.`);
      return;
    }

    console.log(`–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ: '${this.key}'`);
    // –ü—É–±–ª–∏–∫—É–µ–º –∑–∞–ø–∏—Å—å "final_event" –≤ –¥–Ω–µ–≤–Ω–∏–∫ (–∫–∞–∫ –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–π –ø–æ—Å—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä).
    await this.eventManager.addDiaryEntry(this.key, true);

    // –î–æ–ø—É—Å—Ç–∏–º, —Å—Ç–∞–≤–∏–º —Ñ–ª–∞–≥, —á—Ç–æ –∏–≥—Ä–∞/–ø—Ä–∏–∑—Ä–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
    localStorage.setItem("gameFinalized", "true");

    // –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: "–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –ø—Ä–∏–∑—Ä–∞–∫–∞"
    this.app.visualEffectsManager.triggerGhostAppearanceEffect("ghost_fade_out");

    // –õ–∏–±–æ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ/alert
    alert("üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, —Å—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à—ë–Ω!");

    // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –æ—Ç–∫–ª—é—á–∞–µ–º UI –∫–Ω–æ–ø–æ–∫ –∏ —Ç.–¥.
    // this.app.controlsPanel.style.display = "none";
  }
}