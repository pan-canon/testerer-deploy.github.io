{"version":3,"file":"main.js","mappings":"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GAAGD,KAAK;IACnE,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;AACA;AACA;EACE,aAAaxG,UAAUA,CAAC2G,YAAY,EAAE7nB,IAAI,GAAG,CAAC,CAAC,EAAE;IAC/C,MAAMf,QAAQ,GAAG,MAAMC,KAAK,CAAC2oB,YAAY,CAAC;IAC1C,IAAI,CAAC5oB,QAAQ,CAACE,EAAE,EAAE;MAChB,MAAM,IAAIC,KAAK,CAAC,6CAA6CyoB,YAAY,EAAE,CAAC;IAC9E;IACA,MAAMxoB,YAAY,GAAG,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;IAC1C,OAAOlB,cAAc,CAACgC,MAAM,CAACf,YAAY,EAAEW,IAAI,CAAC;EAClD;AACF;;;;;;UC1CA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;;;;;WCzBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,EAAE;WACF;;;;;WCRA;WACA;WACA;WACA;WACA;;;;;WCJA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC;;;;;WCPD;;;;;WCAA;WACA;WACA;WACA;WACA,uBAAuB,4BAA4B;WACnD;WACA;WACA;WACA,iBAAiB,oBAAoB;WACrC;WACA,mGAAmG,YAAY;WAC/G;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,mEAAmE,iCAAiC;WACpG;WACA;WACA;WACA;;;;;WCzCA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;WCNA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WClBA;;WAEA;WACA;WACA;WACA;WACA;WACA;;WAEA;WAC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","sources":["webpack://testerer-deploy.github.io/./build/triads/ lazy ^\\.\\/triad\\-.*\\.js$ chunkName: triads/triad-[request] namespace object","webpack://testerer-deploy.github.io/./src/App.js","webpack://testerer-deploy.github.io/./src/config/paths.js","webpack://testerer-deploy.github.io/./src/config/stateKeys.js","webpack://testerer-deploy.github.io/./src/locales/chatLocales_en.js","webpack://testerer-deploy.github.io/./src/locales/chatLocales_ru.js","webpack://testerer-deploy.github.io/./src/locales/chatLocales_uk.js","webpack://testerer-deploy.github.io/./src/locales/locales.js","webpack://testerer-deploy.github.io/./src/managers/ApartmentPlanManager.js","webpack://testerer-deploy.github.io/./src/managers/CameraSectionManager.js","webpack://testerer-deploy.github.io/./src/managers/ChatManager.js","webpack://testerer-deploy.github.io/./src/managers/DatabaseManager.js","webpack://testerer-deploy.github.io/./src/managers/ErrorManager.js","webpack://testerer-deploy.github.io/./src/managers/EventManager.js","webpack://testerer-deploy.github.io/./src/managers/GameEventManager.js","webpack://testerer-deploy.github.io/./src/managers/GhostManager.js","webpack://testerer-deploy.github.io/./src/managers/LanguageManager.js","webpack://testerer-deploy.github.io/./src/managers/NotificationManager.js","webpack://testerer-deploy.github.io/./src/managers/ProfileManager.js","webpack://testerer-deploy.github.io/./src/managers/QuestManager.js","webpack://testerer-deploy.github.io/./src/managers/SQLiteDataManager.js","webpack://testerer-deploy.github.io/./src/managers/ShowProfileModal.js","webpack://testerer-deploy.github.io/./src/managers/StateManager.js","webpack://testerer-deploy.github.io/./src/managers/ViewManager.js","webpack://testerer-deploy.github.io/./src/managers/VisualEffectsManager.js","webpack://testerer-deploy.github.io/./src/utils/GameEntityLoader.js","webpack://testerer-deploy.github.io/./src/utils/ImageUtils.js","webpack://testerer-deploy.github.io/./src/utils/SequenceManager.js","webpack://testerer-deploy.github.io/./src/utils/SpiritBoardUtils.js","webpack://testerer-deploy.github.io/./src/utils/TemplateEngine.js","webpack://testerer-deploy.github.io/webpack/bootstrap","webpack://testerer-deploy.github.io/webpack/runtime/define property getters","webpack://testerer-deploy.github.io/webpack/runtime/ensure chunk","webpack://testerer-deploy.github.io/webpack/runtime/get javascript chunk filename","webpack://testerer-deploy.github.io/webpack/runtime/global","webpack://testerer-deploy.github.io/webpack/runtime/hasOwnProperty shorthand","webpack://testerer-deploy.github.io/webpack/runtime/load script","webpack://testerer-deploy.github.io/webpack/runtime/make namespace object","webpack://testerer-deploy.github.io/webpack/runtime/publicPath","webpack://testerer-deploy.github.io/webpack/runtime/jsonp chunk loading","webpack://testerer-deploy.github.io/./main.js"],"sourcesContent":["var map = {\n\t\"./triad-final_event.js\": [\n\t\t\"./build/triads/triad-final_event.js\",\n\t\t\"triads/triad-triad-final_event-js\"\n\t],\n\t\"./triad-post_repeating_event.js\": [\n\t\t\"./build/triads/triad-post_repeating_event.js\",\n\t\t\"triads/triad-triad-post_repeating_event-js\"\n\t],\n\t\"./triad-welcome.js\": [\n\t\t\"./build/triads/triad-welcome.js\",\n\t\t\"triads/triad-triad-welcome-js\"\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(() => {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(() => {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = () => (Object.keys(map));\nwebpackAsyncContext.id = \"./build/triads lazy recursive ^\\\\.\\\\/triad\\\\-.*\\\\.js$\";\nmodule.exports = webpackAsyncContext;","// App.js\n// Import utility modules and managers\nimport { BASE_PATH, COCO_SSD_MODEL } from './config/paths.js';\nimport { ImageUtils } from './utils/ImageUtils.js';\nimport { VisualEffectsManager } from './managers/VisualEffectsManager.js';\n\nimport { SQLiteDataManager } from './managers/SQLiteDataManager.js';\nimport { DatabaseManager } from './managers/DatabaseManager.js';\n\nimport { StateManager } from './managers/StateManager.js';\nimport { ErrorManager } from './managers/ErrorManager.js';\n\nimport { ViewManager } from './managers/ViewManager.js';\n\nimport { LanguageManager } from './managers/LanguageManager.js';\nimport { CameraSectionManager } from './managers/CameraSectionManager.js';\nimport { ProfileManager } from './managers/ProfileManager.js';\nimport { GhostManager } from './managers/GhostManager.js';\nimport { EventManager } from './managers/EventManager.js';\nimport { QuestManager } from './managers/QuestManager.js';\nimport { GameEventManager } from './managers/GameEventManager.js';\nimport { ShowProfileModal } from './managers/ShowProfileModal.js';\n\n// NEW IMPORTS FOR CHAT MODULE using the wrapper for simplified instantiation\nimport { ChatManager } from './managers/ChatManager.js';\n\n/**\n * Main application class.\n * This class initializes core managers, sets up the UI,\n * loads persisted state, and launches the test chat section (\"support\").\n *\n * All chat-related logic (state management, dialogue, localization)\n * is encapsulated within ChatManager.\n */\nexport class App {\n  constructor(deps = {}) {\n    // Initialize or inject ViewManager and bind UI events.\n    this.viewManager = deps.viewManager || new ViewManager(this);\n    this.viewManager.bindEvents(this);\n\n    // Create or inject persistence managers.\n    this.sqliteDataManager = deps.sqliteDataManager || new SQLiteDataManager();\n    this.databaseManager = deps.databaseManager || new DatabaseManager(this.sqliteDataManager);\n\n    // Application state variables.\n    this.isCameraOpen = false;\n    this.selfieData = null;\n\n    // Initialize core domain managers.\n    this.languageManager = deps.languageManager || new LanguageManager('language-selector');\n    this.cameraSectionManager = deps.cameraSectionManager || new CameraSectionManager();\n    this.viewManager.setCameraManager(this.cameraSectionManager);\n    this.profileManager = deps.profileManager || new ProfileManager(this.sqliteDataManager);\n    this.visualEffectsManager = deps.visualEffectsManager || new VisualEffectsManager(this, this.viewManager.controlsPanel);\n    const savedSequenceIndex = parseInt(StateManager.get('currentSequenceIndex'), 10) || 0;\n    this.ghostManager = deps.ghostManager || new GhostManager(savedSequenceIndex, this.profileManager, this);\n    this.eventManager = deps.eventManager || new EventManager(\n      this.databaseManager,\n      this.languageManager,\n      this.ghostManager,\n      this.visualEffectsManager\n    );\n    this.eventManager.viewManager = this.viewManager;\n    this.ghostManager.eventManager = this.eventManager;\n    this.questManager = deps.questManager || new QuestManager(this.eventManager, this);\n    this.gameEventManager = deps.gameEventManager || new GameEventManager(this.eventManager, this, this.languageManager);\n    this.showProfileModal = deps.showProfileModal || new ShowProfileModal(this);\n\n    // Initialize ChatManager for the \"support\" chat section using the wrapper.\n    this.chatManager = deps.chatManager || ChatManager.createChatManagerWrapper({\n      databaseManager: this.databaseManager,\n      languageManager: this.languageManager,\n      sectionKey: 'support'\n    });\n\n    // Begin application initialization.\n    this.init();\n  }\n\n  /**\n   * Loads previously saved application state.\n   */\n  loadAppState() {\n    const savedGhostId = StateManager.get('currentGhostId');\n    if (savedGhostId) {\n      this.ghostManager.setCurrentGhost(parseInt(savedGhostId));\n    } else {\n      this.ghostManager.setCurrentGhost(1);\n    }\n  }\n\n  /**\n   * Initializes the application.\n   * Among other tasks, this method launches the support chat section.\n   */\n  async init() {\n    await this.databaseManager.initDatabasePromise;\n    console.log(\"Database initialization complete.\");\n    this.loadAppState();\n    // Preload AI model before any camera usage\n    await this.cameraSectionManager.preloadModel();\n    await this.questManager.syncQuestState();\n    this.questManager.restoreAllActiveQuests();\n    // If the camera was marked as open before reload, restore the button state,\n    // but do NOT reopen the camera or call getUserMedia automatically.\n    if (StateManager.isCameraOpen()) {\n      this.viewManager.setCameraButtonActive(true);\n      console.log(\"Camera button active state restored based on saved state.\");\n    }\n\n    this.viewManager.showToggleCameraButton();\n    this.viewManager.createTopCameraControls();\n\n    // Initialize the chat section for \"support\"\n    await this.chatManager.init();\n    // Schedule support chat conversation to start after 5 seconds.\n    this.chatManager.scheduleConversationStartIfInactive(5000);\n\n    // If a profile exists, switch to main screen (and only then re-call updateDiaryDisplay).\n    // IMPORTANT: Pass `this` as the third param so `ViewManager` can reference your main app instance.\n    if (await this.profileManager.isProfileSaved()) {\n      const profile = await this.profileManager.getProfile();\n      console.log(\"Profile found:\", profile);\n\n      await this.viewManager.switchScreen('main-screen', 'main-buttons', this);\n      this.viewManager.showToggleCameraButton();\n\n      // Read state from previous save\n      const postButtonDisabled = StateManager.get(\"postButtonDisabled\") === \"true\";\n      this.viewManager.setPostButtonEnabled(!postButtonDisabled);\n\n      this.viewManager.updateProfileDisplay(profile);\n      this.selfieData = profile.selfie;\n\n      // Render only the latest posts (lazy mode)\n      await this.viewManager.loadLatestDiaryPosts();\n    } else {\n      console.log(\"Profile not found, showing landing screen.\");\n\n      // ALSO pass `this` here. Without it, `app` will be undefined in `ViewManager`.\n      await this.viewManager.switchScreen('landing-screen', 'landing-buttons', this);\n    }\n\n    // In src/App.js, at the very end of init():\n    const preloader = document.getElementById('preloader');\n    if (preloader) {\n      preloader.style.display = 'none';\n      console.log(\"[App] Preloader hidden after AI model preload and app init.\");\n    }\n  }\n}","// src/config/paths.js\nexport const BASE_PATH = window.location.hostname.includes(\"github.io\")\n  ? \"/testerer-deploy.github.io\"\n  : \"\";\nexport const ASSETS_PATH    = `${BASE_PATH}/assets`;\nexport const SQL_WASM_URL   = `${ASSETS_PATH}/libs/db/sql-wasm.js`;\nexport const TFJS_URL       = `${ASSETS_PATH}/libs/tf.min.js`;\nexport const COCO_SSD_URL   = `${ASSETS_PATH}/libs/coco-ssd.min.js`;\nexport const COCO_SSD_MODEL = `${ASSETS_PATH}/models/coco-ssd/model.json`;","// src/config/stateKeys.js\nexport default {\n  CURRENT_SEQUENCE_INDEX: 'currentSequenceIndex',\n  POST_BUTTON_DISABLED:   'postButtonDisabled',\n  CAMERA_BUTTON_ACTIVE:   'cameraButtonActive',\n  CAMERA_OPEN:            'cameraOpen',\n  ACTIVE_QUEST_KEY:       'activeQuestKey',\n  MIRROR_QUEST_READY:     'mirrorQuestReady',\n  WELCOME_DONE:           'welcomeDone',\n  REPEATING_QUEST_STATE:  'quest_state_repeating_quest',\n  GAME_FINALIZED:         'gameFinalized'\n};","const chatLocales_en = {\n  // Initial greeting from the chat bot\n  \"greeting\": \"Hello! How may I assist you today?\",\n  // Prompt for the user to choose an option\n  \"response_prompt\": \"Please choose one of the following options:\",\n  // Answer options for the initial dialogue\n  \"option_1\": \"Tell me more about this.\",\n  \"option_2\": \"I don't understand.\",\n  \"option_3\": \"Ignore.\",\n  // Additional option variants (if needed)\n  \"option_1_1\": \"Could you elaborate further?\",\n  \"option_1_2\": \"I'd like more details.\",\n  \"option_2_1\": \"Please explain further.\",\n  // User and spirit messages in subsequent dialogues\n  \"user_reply_1\": \"I have a question regarding the service.\",\n  \"spirit_response_1\": \"Certainly, let me explain.\",\n  \"user_reply_2\": \"I'm still not clear on this.\",\n  \"spirit_response_2\": \"Allow me to provide additional information.\",\n  \"user_reply_3\": \"Thank you for the clarification.\",\n  \"spirit_response_3\": \"You're welcome.\",\n  // End-of-conversation message\n  \"end_of_conversation\": \"Thank you for chatting!\",\n  // Conversation section name for support chat\n  \"chat_support\": \"Support Chat\"\n};\n\nexport default chatLocales_en;","const chatLocales_ru = {\n  // Initial greeting from the chat bot\n  \"greeting\": \"Здравствуйте! Чем могу помочь?\",\n  // Prompt for the user to choose an option\n  \"response_prompt\": \"Пожалуйста, выберите один из вариантов:\",\n  // Answer options for the initial dialogue\n  \"option_1\": \"Расскажите подробнее.\",\n  \"option_2\": \"Я не понимаю.\",\n  \"option_3\": \"Игнорировать.\",\n  // Additional option variants (if needed)\n  \"option_1_1\": \"Можете рассказать подробнее?\",\n  \"option_1_2\": \"Нужны дополнительные детали.\",\n  \"option_2_1\": \"Пожалуйста, объясните подробнее.\",\n  // User and spirit messages in subsequent dialogues\n  \"user_reply_1\": \"У меня есть вопрос по услуге.\",\n  \"spirit_response_1\": \"Конечно, разрешите объяснить.\",\n  \"user_reply_2\": \"Я все еще не понимаю.\",\n  \"spirit_response_2\": \"Позвольте предоставить дополнительную информацию.\",\n  \"user_reply_3\": \"Спасибо за разъяснение.\",\n  \"spirit_response_3\": \"Пожалуйста.\",\n  // End-of-conversation message\n  \"end_of_conversation\": \"Спасибо за беседу!\",\n  // Conversation section name for support chat\n  \"chat_support\": \"Служба поддержки\"\n};\n\nexport default chatLocales_ru;","const chatLocales_uk = {\n  // Initial greeting from the chat bot\n  \"greeting\": \"Вітаємо! Чим можу допомогти?\",\n  // Prompt for the user to choose an option\n  \"response_prompt\": \"Будь ласка, оберіть один із варіантів:\",\n  // Answer options for the initial dialogue\n  \"option_1\": \"Розкажіть докладніше.\",\n  \"option_2\": \"Я не розумію.\",\n  \"option_3\": \"Ігнорувати.\",\n  // Additional option variants (if needed)\n  \"option_1_1\": \"Будь ласка, розкажіть детальніше.\",\n  \"option_1_2\": \"Мені потрібні додаткові подробиці.\",\n  \"option_2_1\": \"Поясніть, будь ласка, детальніше.\",\n  // User and spirit messages in subsequent dialogues\n  \"user_reply_1\": \"У мене є питання щодо послуги.\",\n  \"spirit_response_1\": \"Звичайно, дозвольте пояснити.\",\n  \"user_reply_2\": \"Я все ще не розумію.\",\n  \"spirit_response_2\": \"Дозвольте надати додаткову інформацію.\",\n  \"user_reply_3\": \"Дякую за роз'яснення.\",\n  \"spirit_response_3\": \"Будь ласка.\",\n  // End-of-conversation message\n  \"end_of_conversation\": \"Дякуємо за розмову!\",\n  // Conversation section name for support chat\n  \"chat_support\": \"Підтримка\"\n};\n\nexport default chatLocales_uk;","const locales = {\n  \"en\": {\n    \"welcome\": \"Welcome!\",\n    \"post_repeating_event\": \"Отлично, ты справился с предыдущим заданием! Вот тебе новое.\",\n    \"enter_name\": \"Enter your name:\",\n    \"select_gender\": \"Select your gender:\",\n    \"male\": \"Male\",\n    \"female\": \"Female\",\n    \"other\": \"Other\",\n    \"next\": \"Next\",\n    \"take_selfie\": \"Take a Selfie\",\n    \"capture\": \"Capture\",\n    \"complete\": \"Complete\",\n    \"diary\": \"Your Diary\",\n    \"empty_diary\": \"No entries yet...\",\n    \"select_language\": \"Select Language\",\n    \"reset\": \"Reset Data\",\n    \"export\": \"Export Profile\",\n    \"import_profile\": \"Import Profile\",\n    \"import\": \"Import\",\n    \"answer\": \"Answer\",\n    \"ignore\": \"Ignore\",\n    \"open_camera\": \"Open Camera\",\n    \"open_diary\": \"Open Diary\",\n    \"mirror_quest\": \"They are asking me to come to the mirror...\",\n    \"ignored_call\": \"I didn't answer, I don't know who it was. Hm.... Text. “З”. What would that mean...\",\n    \"what_was_it\": \"What was that?\"\n  },\n  \"ru\": {\n    \"welcome\": \"Добро пожаловать!\",\n    \"post_repeating_event\": \"Отлично, ты справился с предыдущим заданием! Вот тебе новое.\",\n    \"enter_name\": \"Введите ваше имя:\",\n    \"select_gender\": \"Выберите ваш пол:\",\n    \"male\": \"Мужской\",\n    \"female\": \"Женский\",\n    \"other\": \"Другой\",\n    \"next\": \"Далее\",\n    \"take_selfie\": \"Сделайте селфи\",\n    \"capture\": \"Сделать фото\",\n    \"complete\": \"Завершить\",\n    \"diary\": \"Ваш дневник\",\n    \"empty_diary\": \"Записей пока нет...\",\n    \"select_language\": \"Выберите язык\",\n    \"reset\": \"Сбросить данные\",\n    \"export\": \"Экспорт профиля\",\n    \"import_profile\": \"Импорт профиля\",\n    \"import\": \"Импорт\",\n    \"answer\": \"Ответить\",\n    \"ignore\": \"Игнорировать\",\n    \"open_camera\": \"Открыть камеру\",\n    \"open_diary\": \"Открыть дневник\",\n    \"mirror_quest\": \"Они просят подойти меня к зеркалу.\",\n    \"ignored_call\": \"Я не ответил(а), я не знаю, кто это. Хм.... Смс. \\\"З\\\". Что бы это значило...\",\n    \"what_was_it\": \"Что это было?\"\n  },\n  \"uk\": {\n    \"welcome\": \"Ласкаво просимо!\",\n    \"post_repeating_event\": \"Отлично, ты справился с предыдущим заданием! Вот тебе новое.\",\n    \"enter_name\": \"Введіть ваше ім'я:\",\n    \"select_gender\": \"Оберіть вашу стать:\",\n    \"male\": \"Чоловіча\",\n    \"female\": \"Жіноча\",\n    \"other\": \"Інша\",\n    \"next\": \"Далі\",\n    \"take_selfie\": \"Зробіть селфі\",\n    \"capture\": \"Зробити фото\",\n    \"complete\": \"Завершити\",\n    \"diary\": \"Ваш щоденник\",\n    \"empty_diary\": \"Записів поки немає...\",\n    \"select_language\": \"Оберіть мову\",\n    \"reset\": \"Скинути дані\",\n    \"export\": \"Експорт профілю\",\n    \"import_profile\": \"Імпорт профілю\",\n    \"import\": \"Імпорт\",\n    \"answer\": \"Відповісти\",\n    \"ignore\": \"Ігнорувати\",\n    \"open_camera\": \"Відкрити камеру\",\n    \"open_diary\": \"Відкрити щоденник\",\n    \"mirror_quest\": \"Вони просять підійти мене до дзеркала.\",\n    \"ignored_call\": \"Я не відповів(ла), я не знаю, хто це. Хм.... Смс. «З». Що б це означало...\",\n    \"what_was_it\": \"What was that?\"\n  }\n};\n\nexport default locales;","import { ErrorManager } from './ErrorManager.js';\nimport { StateManager } from './StateManager.js';\n\nexport class ApartmentPlanManager {\n  /**\n   * Constructor for ApartmentPlanManager.\n   * @param {string} containerId - ID of the container where the apartment plan will be displayed.\n   * @param {DatabaseManager} dbManager - Manager for database persistence.\n   * @param {App} appInstance - Reference to the main application instance.\n   */\n  constructor(containerId, dbManager, appInstance) {\n    this.app = appInstance; // Reference to main app (for UI delegation)\n    this.container = document.getElementById(containerId);\n    this.dbManager = dbManager;\n\n    // Array of room objects for the current floor.\n    // Each room has properties: { floor, startRow, startCol, endRow, endCol, type }\n    this.rooms = [];\n\n    // Current floor.\n    this.currentFloor = 1;\n\n    // Flags for cell selection.\n    this.isSelecting = false;\n    this.startCell = null;\n    this.endCell = null;\n\n    // Grid dimensions (16×16 cells).\n    this.gridRows = 16;\n    this.gridCols = 16;\n\n    // Create grid and bind events.\n    this.createGrid();\n    this.attachEvents();\n\n    // Load plan data for the current floor after DB initialization.\n    this.dbManager.initDatabasePromise.then(() => {\n      this.loadFromDB();\n    });\n\n    // Bind event listener for the \"Next\" button on the apartment plan screen.\n    const nextBtn = document.getElementById(\"apartment-plan-next-btn\");\n    if (nextBtn) {\n      nextBtn.addEventListener(\"click\", () => {\n        // Optionally disable the button to prevent double-clicks.\n        nextBtn.disabled = true;\n        // Delegate transition to the selfie screen via ViewManager.\n        this.app.viewManager.goToSelfieScreen(this.app);\n      });\n    } else {\n      ErrorManager.logError(\"Apartment plan Next button not found during initialization.\", \"ApartmentPlanManager\");\n    }\n  }\n\n  /**\n   * createGrid – Creates a grid container for the apartment plan.\n   */\n  createGrid() {\n    this.gridContainer = document.createElement('div');\n    this.gridContainer.style.display = \"grid\";\n    this.gridContainer.style.gridTemplateColumns = `repeat(${this.gridCols}, 50px)`;\n    this.gridContainer.style.gridAutoRows = \"50px\";\n    this.gridContainer.style.gap = \"1px\";\n    this.container.innerHTML = \"\";\n    this.container.appendChild(this.gridContainer);\n    this.initGrid();\n  }\n\n  /**\n   * initGrid – Initializes the grid by creating cells.\n   */\n  initGrid() {\n    this.gridContainer.innerHTML = \"\";\n    for (let r = 0; r < this.gridRows; r++) {\n      for (let c = 0; c < this.gridCols; c++) {\n        const cell = document.createElement(\"div\");\n        cell.dataset.row = r;\n        cell.dataset.col = c;\n        cell.style.width = \"50px\";\n        cell.style.height = \"50px\";\n        cell.style.border = \"1px solid #ccc\";\n        cell.style.textAlign = \"center\";\n        cell.style.verticalAlign = \"middle\";\n        cell.style.cursor = \"pointer\";\n        this.gridContainer.appendChild(cell);\n      }\n    }\n  }\n\n  /**\n   * attachEvents – Binds mouse and touch event handlers for cell selection.\n   */\n  attachEvents() {\n    this.gridContainer.addEventListener(\"mousedown\", (e) => this.startSelection(e));\n    this.gridContainer.addEventListener(\"mousemove\", (e) => this.updateSelection(e));\n    document.addEventListener(\"mouseup\", (e) => this.finishSelection(e));\n\n    this.gridContainer.addEventListener(\"touchstart\", (e) => this.handleTouchStart(e));\n    this.gridContainer.addEventListener(\"touchmove\", (e) => this.handleTouchMove(e));\n    this.gridContainer.addEventListener(\"touchend\", (e) => this.handleTouchEnd(e));\n  }\n\n  handleTouchStart(e) {\n    e.preventDefault();\n    const touch = e.touches[0];\n    const target = document.elementFromPoint(touch.clientX, touch.clientY);\n    if (target && target.tagName === \"DIV\") {\n      this.startSelection({ clientX: touch.clientX, clientY: touch.clientY, target });\n    }\n  }\n\n  handleTouchMove(e) {\n    e.preventDefault();\n    const touch = e.touches[0];\n    const target = document.elementFromPoint(touch.clientX, touch.clientY);\n    if (target && target.tagName === \"DIV\") {\n      this.updateSelection({ clientX: touch.clientX, clientY: touch.clientY, target });\n    }\n  }\n\n  handleTouchEnd(e) {\n    e.preventDefault();\n    this.finishSelection(e);\n  }\n\n  /**\n   * startSelection – Begins cell selection.\n   */\n  startSelection(e) {\n    if (e.target.tagName === \"DIV\") {\n      this.isSelecting = true;\n      const row = parseInt(e.target.dataset.row);\n      const col = parseInt(e.target.dataset.col);\n      this.startCell = { row, col };\n      this.endCell = { row, col };\n      this.highlightSelection();\n    }\n  }\n\n  /**\n   * updateSelection – Updates cell selection as the pointer moves.\n   */\n  updateSelection(e) {\n    if (this.isSelecting && e.target.tagName === \"DIV\") {\n      const row = parseInt(e.target.dataset.row);\n      const col = parseInt(e.target.dataset.col);\n      this.endCell = { row, col };\n      this.highlightSelection();\n    }\n  }\n\n  /**\n   * finishSelection – Completes cell selection and shows the location type modal.\n   */\n  finishSelection(e) {\n    // Ignore events inside modal overlay.\n    if (e.target.closest('#location-type-modal-overlay')) return;\n    if (this.isSelecting) {\n      this.isSelecting = false;\n      if (!this.startCell || !this.endCell) {\n        this.startCell = { row: 0, col: 0 };\n        this.endCell = { row: this.gridRows - 1, col: this.gridCols - 1 };\n      }\n      // Delegate modal display to ViewManager.\n      this.app.viewManager.showLocationTypeModal(\n        (selectedType) => {\n          // Confirm callback: save location type and add room.\n          if (this.app && this.app.profileManager) {\n            this.app.profileManager.saveLocationType(selectedType);\n          }\n          const room = {\n            floor: this.currentFloor,\n            startRow: Math.min(this.startCell.row, this.endCell.row),\n            startCol: Math.min(this.startCell.col, this.endCell.col),\n            endRow: Math.max(this.startCell.row, this.endCell.row),\n            endCol: Math.max(this.startCell.col, this.endCell.col),\n            type: selectedType\n          };\n          this.rooms.push(room);\n          this.saveToDB();\n          this.renderRooms();\n          // Enable the \"Next\" button on the apartment plan screen.\n          if (this.app && this.app.viewManager && typeof this.app.viewManager.setApartmentPlanNextButtonEnabled === 'function') {\n            this.app.viewManager.setApartmentPlanNextButtonEnabled(true);\n          }\n        },\n        () => {\n          // Cancel callback: use default type \"Other\".\n          console.log(\"No location selected, default type 'Other' chosen.\");\n          if (this.app && this.app.profileManager) {\n            this.app.profileManager.saveLocationType(\"Other\");\n          }\n          const room = {\n            floor: this.currentFloor,\n            startRow: Math.min(this.startCell.row, this.endCell.row),\n            startCol: Math.min(this.startCell.col, this.endCell.col),\n            endRow: Math.max(this.startCell.row, this.endCell.row),\n            endCol: Math.max(this.startCell.col, this.endCell.col),\n            type: \"Other\"\n          };\n          this.rooms.push(room);\n          this.saveToDB();\n          this.renderRooms();\n          if (this.app && this.app.viewManager && typeof this.app.viewManager.setApartmentPlanNextButtonEnabled === 'function') {\n            this.app.viewManager.setApartmentPlanNextButtonEnabled(true);\n          }\n        }\n      );\n    }\n  }\n\n  /**\n   * highlightSelection – Visually highlights the selected area in the grid.\n   */\n  highlightSelection() {\n    Array.from(this.gridContainer.children).forEach(cell => {\n      cell.style.backgroundColor = \"\";\n    });\n    if (!this.startCell || !this.endCell) return;\n    const startRow = Math.min(this.startCell.row, this.endCell.row);\n    const endRow = Math.max(this.startCell.row, this.endCell.row);\n    const startCol = Math.min(this.startCell.col, this.endCell.col);\n    const endCol = Math.max(this.startCell.col, this.endCell.col);\n    for (let r = startRow; r <= endRow; r++) {\n      for (let c = startCol; c <= endCol; c++) {\n        const cell = this.gridContainer.querySelector(`div[data-row='${r}'][data-col='${c}']`);\n        if (cell) cell.style.backgroundColor = \"rgba(255, 0, 0, 0.3)\";\n      }\n    }\n  }\n\n  /**\n   * renderRooms – Recreates the grid and highlights cells corresponding to saved rooms for the current floor.\n   */\n  renderRooms() {\n    this.initGrid();\n    this.rooms.forEach(room => {\n      if (room.floor === this.currentFloor) {\n        for (let r = room.startRow; r <= room.endRow; r++) {\n          for (let c = room.startCol; c <= room.endCol; c++) {\n            const cell = this.gridContainer.querySelector(`div[data-row='${r}'][data-col='${c}']`);\n            if (cell) cell.style.backgroundColor = \"rgba(0, 150, 255, 0.5)\";\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * saveToDB – Saves the apartment plan (rooms) for the current floor to the database.\n   */\n  saveToDB() {\n    const currentRooms = this.rooms.filter(room => room.floor === this.currentFloor);\n    console.log(\"Saving rooms to DB: \", currentRooms);\n    this.dbManager.addApartmentRooms(this.currentFloor, currentRooms);\n  }\n\n  /**\n   * loadFromDB – Loads the apartment plan data for the current floor from the database.\n   */\n  loadFromDB() {\n    console.log(\"Loading data for floor: \", this.currentFloor);\n    this.dbManager.getApartmentPlan(this.currentFloor, (rooms) => {\n      if (!rooms || rooms.length === 0) {\n        console.log(`No rooms found for floor ${this.currentFloor}, using default.`);\n      } else {\n        console.log(`Rooms found for floor ${this.currentFloor}: `, rooms);\n      }\n      this.rooms = rooms;\n      this.renderRooms();\n    });\n  }\n\n  /**\n   * nextFloor – Switches to the next floor and loads its data.\n   */\n  nextFloor() {\n    console.log(\"Switching to next floor\");\n    this.currentFloor++;\n    this.loadFromDB();\n  }\n\n  /**\n   * prevFloor – Switches to the previous floor if possible.\n   */\n  prevFloor() {\n    if (this.currentFloor > 1) {\n      console.log(\"Switching to previous floor\");\n      this.currentFloor--;\n      this.loadFromDB();\n    }\n  }\n}","// CameraSectionManager.js\nimport { ErrorManager } from './ErrorManager.js';\nimport { COCO_SSD_MODEL } from '../config/paths.js';\n\nexport class CameraSectionManager {\n  /**\n   * Constructor for CameraSectionManager.\n   * Initializes:\n   * - videoElement: Created dynamically on the first call to attachTo().\n   * - stream: Stores the MediaStream obtained from getUserMedia.\n   * - onVideoReady: Callback invoked when the video stream is ready (after loadedmetadata event).\n   * - onCameraClosed: Callback invoked after the camera is stopped.\n   */\n  constructor() {\n    this.videoElement = null;\n    this.stream = null;\n    this.onVideoReady = null;\n    this.onCameraClosed = null;\n\n    // New properties for extended functionality\n    this.isDetecting = false;\n    this.aiDetectionTimer = null;\n    this.aiModel = null;\n    this.aiDetectionInterval = 5000; // 5 seconds default\n    this.currentDetectionConfig = null; // To be generated for repeating quests\n\n    this.recordingStartTime = null;\n    this.recordingTimerId = null;\n\n    // Persistent detection frame element\n    this.detectionFrame = null;\n\n    // Reset detection frame when repeating quest completes\n    document.addEventListener('questCompleted', (e) => {\n      if (e.detail === 'repeating_quest') {\n        this.resetDetectionFrame();\n      }\n    });\n  }\n\n  /**\n   * preloadModel – Preloads the COCO-SSD model so that detection can start immediately later.\n   * Stores the loading promise to avoid double-loading.\n   */\n  async preloadModel() {\n    if (!this.modelPromise) {\n      console.log(\"[CameraSectionManager] Preloading AI model...\");\n      this.modelPromise = cocoSsd.load({ modelUrl: COCO_SSD_MODEL });\n    }\n    try {\n      this.aiModel = await this.modelPromise;\n      console.log(\"[CameraSectionManager] AI model preloaded successfully.\");\n    } catch (error) {\n      ErrorManager.logError(error, \"CameraSectionManager.preloadModel\");\n    }\n  }\n\n  /**\n   * attachTo(containerId, options)\n   * Attaches the video element to the specified container.\n   * Creates the video element if it doesn't exist, applies style options,\n   * and clears the container before appending.\n   *\n   * @param {string} containerId - The ID of the container.\n   * @param {Object} [options={}] - CSS style properties for the video element.\n   */\n  attachTo(containerId, options = {}) {\n    const container = document.getElementById(containerId);\n    if (!container) {\n      ErrorManager.logError(`Container with id \"${containerId}\" not found!`, \"attachTo\");\n      return;\n    }\n    if (!this.videoElement) {\n      this.videoElement = document.createElement('video');\n      this.videoElement.autoplay = true;\n      this.videoElement.playsInline = true;\n      // Ensure global id for referencing in AR.js\n      this.videoElement.id = \"global-camera-video\";\n    } else if (this.videoElement.parentNode) {\n      this.videoElement.parentNode.removeChild(this.videoElement);\n    }\n    for (const prop in options) {\n      this.videoElement.style[prop] = options[prop];\n    }\n    container.innerHTML = \"\";\n    container.appendChild(this.videoElement);\n  }\n\n  /**\n   * startCamera – Starts the camera by requesting access via getUserMedia.\n   * If already running, logs a message and does nothing.\n   * Upon success, sets the video element's source to the stream.\n   * Once the video metadata is loaded, calls onVideoReady (if defined)\n   * and dispatches the custom \"cameraReady\" event.\n   */\n  async startCamera() {\n    if (this.stream) {\n      console.log(\"Camera already started\");\n      return;\n    }\n    try {\n      // Automatically attach video element if not created yet.\n      if (!this.videoElement) {\n        this.attachTo(\"global-camera\", {\n          width: \"100%\",\n          height: \"100%\",\n          filter: \"grayscale(100%)\"\n        });\n        console.log(\"Video element was not created; auto-attached to 'global-camera'.\");\n      }\n      \n      const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);\n      const constraints = { video: { facingMode: isMobile ? \"environment\" : \"user\" } };\n      console.log(`Starting camera with facing mode: ${constraints.video.facingMode}`);\n      \n      this.stream = await navigator.mediaDevices.getUserMedia(constraints);\n      if (!this.videoElement) {\n        ErrorManager.logError(\"Video element not created!\", \"startCamera\");\n        return;\n      }\n      this.videoElement.srcObject = this.stream;\n\n      // Если метаданные уже загружены (быстрый F5), запускаем сразу\n      if (this.videoElement.readyState >= 2) {\n        console.log(\"Video metadata already ready; dispatching cameraReady immediately\");\n        if (typeof this.onVideoReady === \"function\") {\n          this.onVideoReady();\n        }\n        document.dispatchEvent(new CustomEvent(\"cameraReady\"));\n        // Create persistent detection frame once video is ready\n        this.createDetectionFrame();\n      } else {\n        // Иначе ждём обычный loadedmetadata\n        this.videoElement.addEventListener(\"loadedmetadata\", () => {\n          console.log(\"loadedmetadata: Video stream is ready\");\n          if (typeof this.onVideoReady === \"function\") {\n            this.onVideoReady();\n          }\n          document.dispatchEvent(new CustomEvent(\"cameraReady\"));\n          // Create persistent detection frame once video is ready\n          this.createDetectionFrame();\n        }, { once: true });\n      }\n    } catch (error) {\n      ErrorManager.logError(error, \"startCamera\");\n    }\n  }\n\n  /**\n   * stopCamera – Stops the current camera stream.\n   * Iterates over all tracks in the stream and stops them.\n   * Resets the stream property to null and calls onCameraClosed (if defined).\n   */\n  stopCamera() {\n    if (this.stream) {\n      this.stream.getTracks().forEach(track => track.stop());\n      this.stream = null;\n      if (typeof this.onCameraClosed === \"function\") {\n        this.onCameraClosed();\n      }\n    }\n  }\n\n  // ---------------- Extended Methods ----------------\n\n  /**\n   * createDetectionFrame – Creates a full-screen white border that pulses.\n   */\n  createDetectionFrame() {\n    // Inject pulsing keyframes once\n    if (!document.getElementById('detection-frame-style')) {\n      const style = document.createElement('style');\n      style.id = 'detection-frame-style';\n      style.textContent = `\n  @keyframes detectionPulse {\n    0%   { transform: scale(1);   opacity: 0.8; }\n    50%  { transform: scale(1.02);opacity: 1;   }\n    100% { transform: scale(1);   opacity: 0.8; }\n  }`;\n      document.head.appendChild(style);\n    }\n\n    this.detectionFrame = document.createElement('div');\n    Object.assign(this.detectionFrame.style, {\n      position:       'absolute',\n      top:            '0',\n      left:           '0',\n      width:          '100%',\n      height:         '100%',\n      border:         '3px solid #fff',\n      boxSizing:      'border-box',\n      pointerEvents:  'none',\n      animation:      'detectionPulse 2s infinite'\n    });\n    document.body.appendChild(this.detectionFrame);\n    console.log('Detection frame initialized and pulsing.');\n  }\n\n  /**\n   * updateDetectionFrame – Shrinks the frame to match detected object's bbox.\n   * @param {Array<number>} bbox – [x, y, width, height]\n   */\n  updateDetectionFrame(bbox) {\n    const [x, y, w, h] = bbox;\n    this.detectionFrame.style.transition = 'all 0.3s ease-out';\n    this.detectionFrame.style.left       = `${x}px`;\n    this.detectionFrame.style.top        = `${y}px`;\n    this.detectionFrame.style.width      = `${w}px`;\n    this.detectionFrame.style.height     = `${h}px`;\n    // Stop pulsing while focused on object\n    this.detectionFrame.style.animation  = '';\n    console.log(`Detection frame moved to bbox: ${bbox}`);\n  }\n\n  /**\n   * resetDetectionFrame – Returns the frame back to full-screen and re-enables pulsing.\n   */\n  resetDetectionFrame() {\n    this.detectionFrame.style.transition = 'all 0.5s ease-out';\n    this.detectionFrame.style.left       = '0';\n    this.detectionFrame.style.top        = '0';\n    this.detectionFrame.style.width      = '100%';\n    this.detectionFrame.style.height     = '100%';\n    this.detectionFrame.style.animation  = 'detectionPulse 2s infinite';\n    console.log('Detection frame reset to full-screen and pulsing.');\n  }\n\n  /**\n   * startARMode\n   * Activates AR mode by inserting an AR.js scene that uses the same video stream.\n   */\n  startARMode() {\n    // Use the global video element id for AR.js reference\n    if (!this.videoElement || !this.stream) {\n      console.warn(\"Camera is not active. AR mode cannot be started.\");\n      return;\n    }\n    // Create AR scene markup with reference to the video element id\n    const arMarkup = `\n      <a-scene embedded arjs=\"sourceType: video; videoElement: #${this.videoElement.id}\">\n        <a-marker preset=\"hiro\">\n          <a-box position=\"0 0.5 0\" material=\"color: red;\"></a-box>\n        </a-marker>\n        <a-camera-static></a-camera-static>\n      </a-scene>\n    `;\n    // Insert AR scene into DOM (for example, at the end of the body)\n    document.body.insertAdjacentHTML('beforeend', arMarkup);\n    console.log(\"AR mode activated.\");\n  }\n\n  /**\n   * stopARMode\n   * Deactivates AR mode by removing the AR.js scene from the DOM.\n   */\n  stopARMode() {\n    const arScene = document.querySelector('a-scene[arjs]');\n    if (arScene) {\n      arScene.remove();\n      console.log(\"AR mode deactivated.\");\n    }\n  }\n\n  /**\n   * applyFilter\n   * Applies a CSS filter to the video element.\n   * @param {string} filterType - 'nightVision', 'blackWhite' or '' for none.\n   */\n  applyFilter(filterType) {\n    if (!this.videoElement) return;\n    if (filterType === 'nightVision') {\n      this.videoElement.style.filter = 'brightness(150%) contrast(120%) sepia(100%) hue-rotate(90deg)';\n    } else if (filterType === 'blackWhite') {\n      this.videoElement.style.filter = 'grayscale(100%)';\n    } else {\n      this.videoElement.style.filter = '';\n    }\n    console.log(`Filter applied: ${filterType}`);\n  }\n\n  /**\n   * startRecordingTimer\n   * Starts a timer (via UI overlay managed externally) for recording duration.\n   */\n  startRecordingTimer() {\n    this.recordingStartTime = Date.now();\n    // Here we assume that the UI overlay for timer is created by ViewManager.\n    // In case it is not, you can create a temporary element.\n    const timerElem = document.getElementById(\"recording-timer\");\n    if (timerElem) {\n      timerElem.style.display = \"block\";\n      this.recordingTimerId = setInterval(() => {\n        const elapsed = Math.floor((Date.now() - this.recordingStartTime) / 1000);\n        timerElem.innerText = `Recording: ${elapsed} sec`;\n      }, 1000);\n    }\n  }\n\n  /**\n   * stopRecordingTimer\n   * Stops the recording timer and hides the UI overlay.\n   */\n  stopRecordingTimer() {\n    clearInterval(this.recordingTimerId);\n    const timerElem = document.getElementById(\"recording-timer\");\n    if (timerElem) {\n      timerElem.style.display = \"none\";\n    }\n  }\n\n  /**\n   * updateBatteryStatus\n   * Retrieves battery status using the Battery API and displays it in a UI overlay.\n   */\n  async updateBatteryStatus() {\n    try {\n      const battery = await navigator.getBattery();\n      const batteryElem = document.getElementById(\"battery-status\");\n      const update = () => {\n        if (batteryElem) {\n          batteryElem.innerText = `Battery: ${Math.floor(battery.level * 100)}%`;\n        }\n      };\n      update();\n      battery.addEventListener('levelchange', update);\n      if (batteryElem) {\n        batteryElem.style.display = \"block\";\n      }\n    } catch (error) {\n      ErrorManager.logError(error, \"updateBatteryStatus\");\n    }\n  }\n\n  /**\n   * startAIDetection\n   * Loads the COCO-SSD model if necessary and begins detection loop.\n   * Stores only the `target` property from config for quest logic.\n   * @param {{ target?: string }} config\n   */\n  async startAIDetection(config = {}) {\n    this.currentDetectionConfig = { target: config.target || null };\n    this.isDetecting = true;\n    console.log(`[CameraSectionManager] startAIDetection(): target = \"${this.currentDetectionConfig.target}\"`);\n\n    if (!this.aiModel) {\n      console.log(\"[CameraSectionManager] Waiting for preloaded model…\");\n      await this.modelPromise; // если вы уже сделали preloadModel\n      if (!this.aiModel) {\n        console.error(\"[CameraSectionManager] Model failed to preload\");\n        return;\n      }\n    }\n\n    this.runAIDetection();\n  }\n\n  /**\n   * runAIDetection\n   * Performs object detection on the current video frame and processes predictions.\n   */\n  async runAIDetection() {\n    if (!this.isDetecting) {\n      return;\n    }\n\n    if (!this.videoElement || this.videoElement.readyState < 2) {\n      // video not ready yet; try again shortly\n      this.aiDetectionTimer = setTimeout(() => this.runAIDetection(), this.aiDetectionInterval);\n      return;\n    }\n\n    try {\n      const predictions = await this.aiModel.detect(this.videoElement);\n      console.log(\"[CameraSectionManager] predictions:\", predictions);\n      this.handleAIPredictions(predictions);\n    } catch (error) {\n      console.error(\"[CameraSectionManager] Error during detect():\", error);\n    }\n\n    this.aiDetectionTimer = setTimeout(() => this.runAIDetection(), this.aiDetectionInterval);\n  }\n\n  /**\n   * handleAIPredictions\n   * Filters predictions by the current target and confidence,\n   * draws a frame and dispatches `objectDetected` when found.\n   * @param {Array<{class: string, score: number, bbox: number[]}>} predictions\n   */\n  handleAIPredictions(predictions) {\n    const target = this.currentDetectionConfig?.target;\n    console.log(`[CameraSectionManager] handleAIPredictions(): looking for \"${target}\"`);\n    if (!target) return;\n\n    for (const pred of predictions) {\n      // Only process high-confidence hits for the current target\n      if (pred.score > 0.6 && pred.class === target) {\n        console.log(`[CameraSectionManager] MATCH for \"${target}\" (score=${pred.score.toFixed(3)})`, pred.bbox);\n        this.animateCornerFrame(pred.bbox);\n        // Notify quest logic that the target was found\n        document.dispatchEvent(new CustomEvent(\"objectDetected\", { detail: target }));\n      }\n    }\n  }\n\n  /**\n   * animateCornerFrame – Shrinks the persistent frame to bbox instead of creating a new one.\n   */\n  animateCornerFrame(bbox) {\n    if (!this.detectionFrame) return;\n    this.updateDetectionFrame(bbox);\n  }\n\n  /**\n   * stopAIDetection\n   * Stops the AI detection loop.\n   */\n  stopAIDetection() {\n    this.isDetecting = false;\n    if (this.aiDetectionTimer) {\n      clearTimeout(this.aiDetectionTimer);\n      this.aiDetectionTimer = null;\n    }\n    console.log(\"[CameraSectionManager] AI detection stopped.\");\n  }\n}","import { BASE_PATH } from '../config/paths.js';\nimport { TemplateEngine } from '../utils/TemplateEngine.js';\nimport { animateText } from '../utils/SpiritBoardUtils.js';\nimport { StateManager } from './StateManager.js';\n\nexport class ChatManager {\n  /**\n   * @param {Object} options - Configuration options for the chat.\n   *  - templateUrl: URL to fetch the chat template fragment (default: dynamic base path + '/src/templates/chat_template.html')\n   *  - mode: 'full' (default) for full chat, or 'board-only' for displaying only the spirit board.\n   *  - basePath: (optional) override for the base path.\n   *  - databaseManager: (optional) instance of DatabaseManager to load chat messages.\n   *  - languageManager: (optional) instance of LanguageManager for locale integration.\n   *  - sectionKey: (optional) unique identifier for the chat section.\n   */\n  constructor(options = {}) {\n    this.templateUrl = options.templateUrl || `${BASE_PATH}/src/templates/chat_template.html`;\n    this.mode = options.mode || 'full';\n    this.container = null; // DOM element for the chat section\n    this.databaseManager = options.databaseManager || null;\n    // Optional language manager for localized strings.\n    this.languageManager = options.languageManager || null;\n    // Optional unique key to identify a chat section.\n    this.sectionKey = options.sectionKey || null;\n    // We'll store the scenario manager here if needed.\n    this.scenarioManager = null;\n  }\n\n  /**\n   * Static method to create a ChatManager instance with default options merged with any provided overrides.\n   *\n   * @param {Object} options - Custom options to override default values.\n   * @returns {ChatManager} A new instance of ChatManager.\n   */\n  static createChatManagerWrapper(options = {}) {\n    const defaultOptions = {\n      templateUrl: `${BASE_PATH}/src/templates/chat_template.html`,\n      mode: 'full'\n    };\n    return new ChatManager({ ...defaultOptions, ...options });\n  }\n\n  /**\n   * Returns the full state key by combining the section key (if provided) with the base key.\n   *\n   * @param {string} baseKey - The base key string (e.g. 'chat_started').\n   * @returns {string} The composite state key.\n   */\n  getStateKey(baseKey) {\n    return this.sectionKey ? `${this.sectionKey}_${baseKey}` : baseKey;\n  }\n\n  /**\n   * Helper method to fetch a localized string by key.\n   * If a languageManager is provided and contains the key, it returns the localized value.\n   * Otherwise, returns the defaultValue.\n   *\n   * @param {string} key - The localization key.\n   * @param {string} defaultValue - The fallback value if no localization is found.\n   * @returns {string} Localized string.\n   */\n  getLocalizedString(key, defaultValue) {\n    if (\n      this.languageManager &&\n      this.languageManager.locales &&\n      typeof this.languageManager.getLanguage === 'function'\n    ) {\n      const lang = this.languageManager.getLanguage();\n      if (this.languageManager.locales[lang] && this.languageManager.locales[lang][key]) {\n        return this.languageManager.locales[lang][key];\n      }\n    }\n    return defaultValue;\n  }\n\n  /**\n   * Initializes the ChatManager by fetching the chat template fragment,\n   * rendering it using the TemplateEngine with initial data (loading messages from DB if available),\n   * and inserting it into the chat section in index.html.\n   * Also initializes the conversation if not marked as completed.\n   *\n   * @returns {Promise<void>}\n   */\n  async init() {\n    try {\n      // Fetch the chat template fragment.\n      const response = await fetch(this.templateUrl);\n      if (!response.ok) {\n        throw new Error(`Failed to fetch template from ${this.templateUrl}`);\n      }\n      const templateText = await response.text();\n\n      // Load saved messages from the DatabaseManager.\n      let messagesStr = \"\";\n      if (this.databaseManager) {\n        const chatMessages = this.databaseManager.getChatMessages();\n        if (chatMessages && chatMessages.length > 0) {\n          messagesStr = chatMessages\n            .map(\n              msg =>\n                `<div class=\"chat-message ${msg.sender}\" style=\"margin-bottom: 0.5rem; padding: 0.5rem; border-radius: 4px; max-width: 80%; word-wrap: break-word;\">${msg.message}</div>`\n            )\n            .join(\"\");\n        }\n      }\n\n      // Get localized string for the spirit board content.\n      const localizedSpiritBoardContent = this.getLocalizedString('spirit_board', 'Spirit Board');\n\n      // Render the template.\n      const data = {\n        messages: messagesStr,\n        spiritBoardContent: localizedSpiritBoardContent,\n        options: '' // Initially no dialogue options.\n      };\n      const renderedHTML = TemplateEngine.render(templateText, data);\n\n      // Insert rendered HTML into chat container.\n      this.container = document.getElementById('chat-section');\n      if (!this.container) {\n        throw new Error('Chat section container (id=\"chat-section\") not found in index.html');\n      }\n      this.container.innerHTML = renderedHTML;\n      this.container.style.display = 'none';\n\n      // If mode is 'board-only', hide the options container.\n      if (this.mode === 'board-only') {\n        const optionsEl = this.container.querySelector('#chat-options');\n        if (optionsEl) {\n          optionsEl.style.display = 'none';\n        }\n      }\n\n      console.log('ChatManager initialized.');\n\n      // --- Resume conversation only if it was started and not completed,\n      // and only if no messages are currently shown (to avoid duplicate append) ---\n      if (!this.isConversationActive()) {\n        try {\n          const module = await import('./ChatScenarioManager.js');\n          this.scenarioManager = new module.ChatScenarioManager(this, null);\n          await this.scenarioManager.init();\n        } catch (e) {\n          console.error(\"Failed to resume ChatScenarioManager:\", e);\n        }\n      } else {\n        console.log(\"Conversation already active; skipping dialogue load to prevent duplicates.\");\n      }\n      \n    } catch (error) {\n      console.error('Error initializing ChatManager:', error);\n    }\n  }\n\n  /**\n   * Returns true if a conversation is already active,\n   * i.e. the chat has been started and there are messages in the chat.\n   *\n   * @returns {boolean}\n   */\n  isConversationActive() {\n    const conversationStarted = StateManager.get(this.getStateKey('chat_started')) === 'true';\n    const messagesEl = this.container && this.container.querySelector('#chat-messages');\n    const hasMessages = messagesEl && messagesEl.children.length > 0;\n    return conversationStarted && hasMessages;\n  }\n\n  /**\n   * Shows the chat section.\n   */\n  show() {\n    if (this.container) {\n      this.container.style.display = 'block';\n      console.log('ChatManager is now visible.');\n    }\n  }\n\n  /**\n   * Hides the chat section.\n   */\n  hide() {\n    if (this.container) {\n      this.container.style.display = 'none';\n      console.log('ChatManager is now hidden.');\n    }\n  }\n\n  /**\n   * Sends an initial localized message to the chat.\n   *\n   * @param {string} localizedText - The text to send.\n   */\n  sendInitialMessage(localizedText) {\n    if (!this.container) {\n      console.error('ChatManager is not initialized.');\n      return;\n    }\n    const messagesEl = this.container.querySelector('#chat-messages');\n    if (messagesEl) {\n      const messageHTML = `<div class=\"chat-message spirit\" style=\"margin-bottom: 0.5rem; padding: 0.5rem; border-radius: 4px; max-width: 80%; word-wrap: break-word;\">${localizedText}</div>`;\n      messagesEl.innerHTML += messageHTML;\n      console.log('Initial message sent:', localizedText);\n    }\n  }\n\n  /**\n   * Saves a chat message using the DatabaseManager.\n   * @param {Object} msg - An object with properties: sender and text.\n   */\n  async saveMessage(msg) {\n    if (this.databaseManager && typeof this.databaseManager.addChatMessage === 'function') {\n      await this.databaseManager.addChatMessage(msg.sender, msg.text);\n      console.log(`Message saved: [${msg.sender}] ${msg.text}`);\n    }\n  }\n\n  /**\n   * Loads a dialogue configuration and updates the chat content.\n   *\n   * The expected dialogueConfig format:\n   * {\n   *   messages: [\n   *     { sender: 'spirit'|'user', text: '...', animateOnBoard: true|false },\n   *     ...\n   *   ],\n   *   options: [\n   *     { text: 'Option 1', onSelect: function },\n   *     ...\n   *   ]\n   * }\n   *\n   * @param {Object} dialogueConfig - The dialogue configuration object.\n   */\n  async loadDialogue(dialogueConfig) {\n    if (!this.container) {\n      console.error('ChatManager is not initialized.');\n      return;\n    }\n\n    let messagesHTML = '';\n    for (const msg of dialogueConfig.messages) {\n      // Get localized message text if available.\n      const localizedMsg = this.getLocalizedString(msg.text, msg.text);\n      messagesHTML += `<div class=\"chat-message ${msg.sender}\" style=\"margin-bottom: 0.5rem; padding: 0.5rem; border-radius: 4px; max-width: 80%; word-wrap: break-word;\">${localizedMsg}</div>`;\n      if (msg.animateOnBoard) {\n        const boardEl = this.container.querySelector('#spirit-board');\n        if (boardEl) {\n          animateText(boardEl, localizedMsg);\n        }\n      }\n      await this.saveMessage({ sender: msg.sender, text: localizedMsg });\n    }\n\n    const messagesEl = this.container.querySelector('#chat-messages');\n    if (messagesEl) {\n      // Append new messages (history is preserved).\n      messagesEl.innerHTML += messagesHTML;\n    }\n\n    // Update dialogue options using the new method.\n    this.updateDialogueOptions(dialogueConfig.options);\n\n    const boardEl = this.container.querySelector('#spirit-board');\n    if (boardEl) {\n      boardEl.innerHTML = '';\n    }\n\n    console.log('Dialogue loaded in ChatManager.');\n  }\n\n  /**\n   * Updates the dialogue options block with the given options array.\n   * This method re-renders the options block with localized option texts\n   * and attaches click event listeners for each option.\n   *\n   * @param {Array} options - Array of dialogue option objects.\n   */\n  updateDialogueOptions(options) {\n    const optionsEl = this.container.querySelector('#chat-options');\n    if (optionsEl) {\n      let optionsHTML = '';\n      if (options && options.length > 0) {\n        options.forEach((option, index) => {\n          // Get localized option text if available.\n          const localizedOptionText = this.getLocalizedString(option.text, option.text);\n          optionsHTML += `<button class=\"button is-link dialogue-option\" style=\"margin-bottom: 0.5rem;\">${localizedOptionText}</button>`;\n        });\n      }\n      // Set maxHeight if there are many options.\n      if (options && options.length > 3) {\n        optionsEl.style.maxHeight = '200px';\n        optionsEl.style.overflowY = 'auto';\n      } else {\n        optionsEl.style.maxHeight = '';\n        optionsEl.style.overflowY = '';\n      }\n      // Replace options to show current choices.\n      optionsEl.innerHTML = optionsHTML;\n\n      // Attach click event listeners to each option.\n      const optionButtons = optionsEl.querySelectorAll('.dialogue-option');\n      optionButtons.forEach((btn, index) => {\n        btn.addEventListener('click', () => {\n          if (this.scenarioManager && typeof this.scenarioManager.advanceDialogue === 'function') {\n            this.scenarioManager.advanceDialogue(index);\n          } else {\n            const option = options[index];\n            console.log(`Option selected: ${option.text}`);\n          }\n        });\n      });\n      console.log('Dialogue options updated in ChatManager.');\n    } else {\n      console.error('Options container not found in ChatManager.');\n    }\n  }\n\n  /**\n   * Sets the display mode for the chat.\n   *\n   * @param {string} mode - 'full' for full chat, or 'board-only' for only the spirit board.\n   */\n  setMode(mode) {\n    this.mode = mode;\n    if (this.container) {\n      const optionsEl = this.container.querySelector('#chat-options');\n      if (mode === 'board-only' && optionsEl) {\n        optionsEl.style.display = 'none';\n      } else if (optionsEl) {\n        optionsEl.style.display = 'block';\n      }\n    }\n    console.log(`ChatManager mode set to: ${mode}`);\n  }\n\n  /**\n   * Resets the current conversation by clearing saved state and reinitializing the dialogue.\n   * This allows for independent conversation sessions without restarting the entire chat.\n   */\n  async restartConversation() {\n    // Mark conversation as started.\n    StateManager.set(this.getStateKey('chat_started'), 'true');\n    // Clear conversation state in StateManager.\n    StateManager.remove(this.getStateKey('chat_conversation_completed'));\n    StateManager.remove(this.getStateKey('chat_currentDialogueIndex'));\n\n    // Clear chat messages container to prevent duplicate messages.\n    if (this.container) {\n      const messagesEl = this.container.querySelector('#chat-messages');\n      if (messagesEl) {\n        messagesEl.innerHTML = '';\n      }\n    }\n\n    // Reinitialize the scenario manager to start the dialogue from the beginning.\n    try {\n      const module = await import('./ChatScenarioManager.js');\n      this.scenarioManager = new module.ChatScenarioManager(this, null);\n      await this.scenarioManager.init();\n      console.log('Conversation restarted for section:', this.sectionKey || '(global)');\n    } catch (e) {\n      console.error(\"Failed to restart conversation:\", e);\n    }\n  }\n\n  /**\n   * Schedules a conversation restart after a specified delay.\n   * Automatically checks if a conversation is already active and aborts restart if so.\n   *\n   * @param {number} delay - Delay in milliseconds before restarting the conversation (default: 5000 ms).\n   */\n  scheduleConversationStartIfInactive(delay = 5000) {\n    setTimeout(() => {\n      if (!this.isConversationActive()) {\n        this.restartConversation();\n      } else {\n        console.log('Conversation is already active; restart aborted.');\n      }\n    }, delay);\n    console.log(`Conversation restart scheduled in ${delay} ms.`);\n  }\n\n  /**\n   * Clears the chat state.\n   * If a sectionKey is provided as an argument, clears only that section.\n   * Otherwise, clears the global chat state.\n   *\n   * @param {string} [sectionKey] - Optional section key to clear.\n   */\n  clearChat(sectionKey) {\n    const prefix = sectionKey ? `${sectionKey}_` : '';\n    StateManager.remove(`${prefix}chat_started`);\n    StateManager.remove(`${prefix}chat_currentDialogueIndex`);\n    StateManager.remove(`${prefix}chat_conversation_completed`);\n    console.log(`Chat cleared for section: ${sectionKey || 'global'}`);\n  }\n}","import { SQLiteDataManager } from './SQLiteDataManager.js';\nimport { BASE_PATH } from '../config/paths.js';\nimport { ErrorManager } from './ErrorManager.js';\n\n/**\n * DatabaseManager\n *\n * Responsible for managing the SQL database which stores:\n * - Diary entries\n * - Apartment plans\n * - Quest progress\n * - Ghost states\n * - Events\n * - Quests\n * - Chat messages (new)\n *\n * It uses SQLiteDataManager for persistence (IndexedDB) and ensures that\n * entries (such as diary entries) are stored in a way that the event key checks\n * (via isEventLogged) work correctly.\n */\nexport class DatabaseManager {\n  /**\n   * Constructor for DatabaseManager.\n   * @param {SQLiteDataManager} dataManager - Instance for persistence operations.\n   */\n  constructor(dataManager) {\n    this.dataManager = dataManager; // Reference to the DataManager\n    // The SQL.js database instance will be stored here.\n    this.db = null;\n    // A Promise that resolves after the database has been initialized.\n    this.initDatabasePromise = this.initDatabase();\n  }\n\n  /**\n   * initDatabase – Asynchronously initializes the database.\n   * Restores the database from persistence if available;\n   * otherwise creates a new database instance and sets up the required tables.\n   * Tables: diary, apartment_plan, quest_progress, ghosts, events, quests.\n   */\n  async initDatabase() {\n    try {\n      // Load SQL.js, providing a locateFile function to find necessary files.\n      const SQL = await initSqlJs({\n        locateFile: file => `${BASE_PATH}/assets/libs/db/${file}`\n      });\n      \n      // Restore database from IndexedDB if saved, otherwise create a new instance.\n      this.db = await this.dataManager.initDatabase(SQL);\n      \n      console.log(\"📖 Database initialized!\");\n    } catch (error) {\n      ErrorManager.logError(error, \"DatabaseManager.initDatabase\");\n    }\n  }\n\n  /**\n   * saveDatabase – Exports the database to a base64 string and persists it via the DataManager.\n   */\n  async saveDatabase() {\n    if (!this.db) return;\n    const binaryData = this.db.export();\n    let binaryStr = \"\";\n    for (let i = 0; i < binaryData.length; i++) {\n      binaryStr += String.fromCharCode(binaryData[i]);\n    }\n    const base64 = btoa(binaryStr);\n    await this.dataManager.saveDatabase(base64);\n    console.log(\"Database saved (persisted) successfully.\");\n  }\n\n  /**\n   * addDiaryEntry – Adds a new entry to the diary table.\n   * The entry is stored as a JSON string containing an \"entry\" property and a \"postClass\" property.\n   * This format ensures that isEventLogged (which checks the \"entry\" field) works correctly.\n   *\n   * @param {string} entry - The text of the entry (usually a key or message).\n   */\n  async addDiaryEntry(entry) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"addDiaryEntry\");\n      return;\n    }\n    const timestamp = new Date().toISOString();\n    this.db.run(\"INSERT INTO diary (entry, timestamp) VALUES (?, ?)\", [entry, timestamp]);\n    console.log(\"✅ Entry added:\", entry);\n    await this.saveDatabase();\n  }\n\n  /**\n   * getDiaryEntries – Returns an array of diary entries sorted by descending timestamp.\n   * Each entry is parsed from JSON, so that the \"entry\" property can be used for comparisons.\n   *\n   * @returns {Array} Array of entry objects: { id, entry, postClass, timestamp }.\n   */\n  getDiaryEntries() {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"getDiaryEntries\");\n      return [];\n    }\n    const result = this.db.exec(\"SELECT * FROM diary ORDER BY timestamp DESC\");\n    if (result.length > 0) {\n      return result[0].values.map(row => {\n        let parsed;\n        try {\n          parsed = JSON.parse(row[1]);\n        } catch (e) {\n          // Fallback: if parsing fails, assume a plain entry.\n          parsed = { entry: row[1], postClass: \"user-post\" };\n          ErrorManager.logError(e, \"getDiaryEntries JSON.parse\");\n        }\n        return { id: row[0], ...parsed, timestamp: row[2] };\n      });\n    }\n    return [];\n  }\n\n  /**\n   * addQuestProgress – Adds a quest progress record to the quest_progress table.\n   *\n   * @param {string} questKey - The key of the quest.\n   * @param {string} status - The status of the quest.\n   */\n  addQuestProgress(questKey, status) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"addQuestProgress\");\n      return;\n    }\n    this.db.run(\"INSERT INTO quest_progress (quest_key, status) VALUES (?, ?)\", [questKey, status]);\n    console.log(`✅ Quest progress added: ${questKey} - ${status}`);\n    this.saveDatabase();\n  }\n\n  /**\n   * getQuestProgress – Returns an array of progress records for the specified quest.\n   *\n   * @param {string} questKey - The key of the quest.\n   * @returns {Array} Array of progress objects: { id, quest_key, status }.\n   */\n  getQuestProgress(questKey) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"getQuestProgress\");\n      return null;\n    }\n    const result = this.db.exec(\"SELECT * FROM quest_progress WHERE quest_key = ?\", [questKey]);\n    if (result.length > 0) {\n      return result[0].values.map(row => ({ id: row[0], quest_key: row[1], status: row[2] }));\n    }\n    return [];\n  }\n\n  /**\n   * addApartmentRooms – Saves the apartment plan data for the specified floor.\n   *\n   * @param {number} floor - The floor number.\n   * @param {Array} rooms - An array of room objects.\n   */\n  addApartmentRooms(floor, rooms) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"addApartmentRooms\");\n      return;\n    }\n    const roomData = JSON.stringify(rooms);\n    this.db.run(\"DELETE FROM apartment_plan WHERE floor_number = ?\", [floor]);\n    this.db.run(\"INSERT INTO apartment_plan (floor_number, room_data) VALUES (?, ?)\", [floor, roomData]);\n    console.log(`✅ Apartment plan for floor ${floor} saved.`);\n    this.saveDatabase();\n  }\n\n  /**\n   * getApartmentPlan – Returns the apartment plan data for the specified floor.\n   *\n   * @param {number} floor - The floor number.\n   * @param {function} callback - Callback function receiving the plan data array.\n   */\n  getApartmentPlan(floor, callback) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"getApartmentPlan\");\n      callback([]);\n      return;\n    }\n    const result = this.db.exec(\"SELECT room_data FROM apartment_plan WHERE floor_number = ? ORDER BY id\", [floor]);\n    if (result.length > 0) {\n      const rooms = result[0].values.map(row => {\n        try {\n          return JSON.parse(row[0]);\n        } catch (e) {\n          ErrorManager.logError(e, \"getApartmentPlan JSON.parse\");\n          return row[0];\n        }\n      });\n      callback(rooms);\n    } else {\n      callback([]);\n    }\n  }\n\n  // ===== Methods for ghosts, events, and quests =====\n\n  /**\n   * saveGhostState – Saves or updates the ghost state in the ghosts table.\n   *\n   * @param {Object} ghost - Ghost object containing id (optional), name, status, progress.\n   */\n  saveGhostState(ghost) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"saveGhostState\");\n      return;\n    }\n    this.db.run(\n      `INSERT OR REPLACE INTO ghosts (id, name, status, progress)\n       VALUES ((SELECT id FROM ghosts WHERE id = ?), ?, ?, ?)`,\n      [ghost.id || null, ghost.name, ghost.status || \"\", ghost.progress || 0]\n    );\n    console.log(\"✅ Ghost state saved:\", ghost);\n    this.saveDatabase();\n  }\n\n  /**\n   * getGhostState – Retrieves the ghost state by ghost id.\n   *\n   * @param {number} ghostId - The ID of the ghost.\n   * @returns {Object|null} The ghost object or null if not found.\n   */\n  getGhostState(ghostId) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"getGhostState\");\n      return null;\n    }\n    const result = this.db.exec(\"SELECT * FROM ghosts WHERE id = ?\", [ghostId]);\n    if (result.length > 0) {\n      const row = result[0].values[0];\n      return { id: row[0], name: row[1], status: row[2], progress: row[3] };\n    }\n    return null;\n  }\n\n  /**\n   * saveEvent – Saves an event record in the events table.\n   *\n   * @param {Object} eventData - Object with properties: event_key, event_text, timestamp, completed (0 or 1).\n   */\n  saveEvent(eventData) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"saveEvent\");\n      return;\n    }\n    this.db.run(\n      `INSERT INTO events (event_key, event_text, timestamp, completed)\n       VALUES (?, ?, ?, ?)`,\n      [eventData.event_key, eventData.event_text, eventData.timestamp, eventData.completed ? 1 : 0]\n    );\n    console.log(\"✅ Event saved:\", eventData);\n    this.saveDatabase();\n  }\n\n  /**\n   * getEvents – Retrieves all event records from the events table.\n   *\n   * @returns {Array} An array of event objects.\n   */\n  getEvents() {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"getEvents\");\n      return [];\n    }\n    const result = this.db.exec(\"SELECT * FROM events ORDER BY timestamp DESC\");\n    if (result.length > 0) {\n      return result[0].values.map(row => ({\n        id: row[0],\n        event_key: row[1],\n        event_text: row[2],\n        timestamp: row[3],\n        completed: row[4] === 1\n      }));\n    }\n    return [];\n  }\n\n  /**\n   * saveQuestRecord – Saves or updates a quest record in the quests table.\n   *\n   * @param {Object} questData - Object with properties: quest_key, status, current_stage, total_stages.\n   */\n  saveQuestRecord(questData) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"saveQuestRecord\");\n      return;\n    }\n    this.db.run(\n      `INSERT OR REPLACE INTO quests (id, quest_key, status, current_stage, total_stages)\n       VALUES ((SELECT id FROM quests WHERE quest_key = ?), ?, ?, ?, ?)`,\n      [questData.quest_key, questData.quest_key, questData.status, questData.current_stage, questData.total_stages]\n    );\n    console.log(\"✅ Quest record saved:\", questData);\n    this.saveDatabase();\n  }\n\n  /**\n   * getQuestRecord – Retrieves a quest record by quest key.\n   *\n   * @param {string} questKey - The key of the quest.\n   * @returns {Object|null} The quest record or null if not found.\n   */\n  getQuestRecord(questKey) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"getQuestRecord\");\n      return null;\n    }\n    const result = this.db.exec(\"SELECT * FROM quests WHERE quest_key = ?\", [questKey]);\n    if (result.length > 0) {\n      const row = result[0].values[0];\n      return {\n        id: row[0],\n        quest_key: row[1],\n        status: row[2],\n        current_stage: row[3],\n        total_stages: row[4]\n      };\n    }\n    return null;\n  }\n\n  // ===== New Methods for Chat Integration =====\n\n  /**\n   * addChatMessage – Inserts a new chat message record into the chat_messages table.\n   *\n   * @param {string} sender - The sender of the message (e.g., 'user' or 'spirit').\n   * @param {string} message - The chat message text.\n   * @param {string} [timestamp] - Optional timestamp; if not provided, current ISO string is used.\n   */\n  addChatMessage(sender, message, timestamp = new Date().toISOString()) {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"addChatMessage\");\n      return;\n    }\n    this.db.run(\"INSERT INTO chat_messages (sender, message, timestamp) VALUES (?, ?, ?)\", [sender, message, timestamp]);\n    console.log(`✅ Chat message added: [${sender}] ${message}`);\n    this.saveDatabase();\n  }\n\n  /**\n   * getChatMessages – Retrieves all chat message records from the chat_messages table.\n   *\n   * @returns {Array} Array of chat message objects: { id, sender, message, timestamp }.\n   */\n  getChatMessages() {\n    if (!this.db) {\n      ErrorManager.logError(\"Database not initialized!\", \"getChatMessages\");\n      return [];\n    }\n    const result = this.db.exec(\"SELECT * FROM chat_messages ORDER BY timestamp ASC\");\n    if (result.length > 0) {\n      return result[0].values.map(row => ({\n        id: row[0],\n        sender: row[1],\n        message: row[2],\n        timestamp: row[3]\n      }));\n    }\n    return [];\n  }\n}","import { NotificationManager } from './NotificationManager.js';\n\n/**\n * ErrorManager\n *\n * Centralized module for logging errors and displaying error notifications.\n * All errors in the application should be handled using logError and showError.\n */\nexport class ErrorManager {\n  /**\n   * Logs an error with optional contextual information.\n   *\n   * @param {any} error - The error object or message.\n   * @param {string} [context] - Optional context indicating where the error occurred.\n   */\n  static logError(error, context = \"\") {\n    console.error(`Error${context ? \" in \" + context : \"\"}:`, error);\n  }\n\n  /**\n   * Displays an error notification to the user.\n   * Uses NotificationManager to show the error message.\n   *\n   * @param {string} message - The error message to display.\n   */\n  static showError(message) {\n    const notificationManager = new NotificationManager();\n    notificationManager.showNotification(message);\n  }\n}","import { ErrorManager } from './ErrorManager.js';\n\n/**\n * EventManager\n * Responsible for handling diary (log) operations and recording system events.\n * - Adds diary entries (both user and ghost posts).\n * - Delegates the diary UI update to ViewManager.\n * - Can trigger short events (e.g., ghost quests) if needed.\n *\n * NOTE: The sequential linking of events is managed by GhostManager.\n */\nexport class EventManager {\n  /**\n   * @param {DatabaseManager} databaseManager - Instance of the database manager.\n   * @param {LanguageManager} languageManager - Localization manager.\n   * @param {GhostManager} ghostManager - Manager handling ghost-related operations.\n   * @param {VisualEffectsManager} visualEffectsManager - Manager handling visual effects.\n   *\n   * Note: The viewManager reference is expected to be set externally (e.g. in App.js).\n   */\n  constructor(databaseManager, languageManager, ghostManager, visualEffectsManager) {\n    this.databaseManager = databaseManager;\n    this.languageManager = languageManager;\n    this.ghostManager = ghostManager;\n    this.visualEffectsManager = visualEffectsManager;\n    // viewManager is assigned externally after instantiation.\n  }\n\n  /**\n   * isEventLogged\n   * Checks whether an entry with the given event key has already been logged.\n   * This method compares the stored entry key with the provided key.\n   *\n   * @param {string} eventKey - The event key to check.\n   * @returns {boolean} True if the event is already logged, otherwise false.\n   */\n  isEventLogged(eventKey) {\n    const entries = this.databaseManager.getDiaryEntries();\n    // Compare the stored entry key with the provided key.\n    return entries.some(entry => entry.entry === eventKey);\n  }\n\n  /**\n   * addDiaryEntry\n   * Adds an entry to the diary. It constructs an object with the entry text and post type,\n   * serializes it as JSON, and saves it to the database. If the entry represents a system event\n   * (e.g., from a ghost), it is additionally saved to the events table.\n   *\n   * After saving, it delegates the UI update (diary rendering) to the ViewManager.\n   * Then, it calls the centralized visual effects method to animate the newly added entry.\n   *\n   * @param {string} entry - The text of the diary entry.\n   * @param {boolean} [isPostFromGhost=false] - Flag to mark the entry as a ghost post.\n   */\n  async addDiaryEntry(entry, isPostFromGhost = false) {\n    // Determine post class based on the source.\n    const postClass = isPostFromGhost ? \"ghost-post\" : \"user-post\";\n    const entryData = { entry, postClass };\n    const serializedEntry = JSON.stringify(entryData);\n\n    // Save the diary entry to the database.\n    await this.databaseManager.addDiaryEntry(serializedEntry);\n\n    // If this is a system event (ghost post), also record it in the events table.\n    if (isPostFromGhost) {\n      const eventData = {\n        event_key: entry,\n        event_text: entry,\n        timestamp: new Date().toISOString(),\n        completed: 0\n      };\n      this.databaseManager.saveEvent(eventData);\n    }\n\n    // Delegate UI update of the diary to the ViewManager.\n    if (this.viewManager?.addSingleDiaryPost) {\n      this.viewManager.addSingleDiaryPost({\n        text: entry,               // original message\n        img: entry.startsWith(\"data:image\") ? entry : \"\", // best‑effort\n        timestamp: new Date().toLocaleString(),\n        postClass\n      });\n    } else {\n      this.updateDiaryDisplay();\n    }\n\n    // After updating the diary display, apply visual effects to newly added diary entries.\n    // It is expected that the rendered diary entries have the attribute data-animate-on-board=\"true\"\n    // if they need to be animated.\n    if (this.viewManager && this.visualEffectsManager && this.viewManager.diaryContainer) {\n      const newEntries = this.viewManager.diaryContainer.querySelectorAll('[data-animate-on-board=\"true\"]');\n      this.visualEffectsManager.applyEffectsToNewElements(newEntries);\n    }\n  }\n\n  /**\n   * updateDiaryDisplay\n   * Retrieves diary entries from the database and instructs the ViewManager\n   * to render them. Uses the current language from the LanguageManager.\n   */\n  updateDiaryDisplay() {\n    if (this.viewManager && typeof this.viewManager.renderDiary === 'function') {\n      const entries = this.databaseManager.getDiaryEntries();\n      const currentLanguage = this.languageManager.getLanguage();\n      // Delegate rendering of the diary entries to the ViewManager.\n      this.viewManager.renderDiary(entries, currentLanguage, this.visualEffectsManager);\n    } else {\n      // Log and display an error if the viewManager is not available.\n      ErrorManager.logError(\"ViewManager is not available. Cannot update diary display.\", \"updateDiaryDisplay\");\n      ErrorManager.showError(\"Unable to update diary display.\");\n    }\n  }\n}","import { StateManager } from './StateManager.js';\nimport { ErrorManager } from './ErrorManager.js';\nimport { loadGameEntitiesConfig } from '../utils/GameEntityLoader.js';\n\n/**\n * GameEventManager class\n * \n * Manages one-time game events. It loads event definitions dynamically from\n * a unified JSON configuration. The configuration (including event class names,\n * dependencies and keys) is defined entirely in the config file.\n *\n * NOTE: Sequential linking of events and quests is now handled by GhostManager and QuestManager.\n */\nexport class GameEventManager {\n  /**\n   * @param {EventManager} eventManager - Manager for diary/event operations.\n   * @param {App} appInstance - The main application instance.\n   * @param {LanguageManager} languageManager - Localization manager.\n   */\n  constructor(eventManager, appInstance, languageManager) {\n    this.eventManager    = eventManager;\n    this.app             = appInstance;\n    this.languageManager = languageManager;\n    this.events          = [];\n\n    // Load the unified configuration and instantiate events dynamically.\n    loadGameEntitiesConfig()\n      .then(async config => {\n        for (const eventCfg of config.events) {\n          // Build dependency mapping.\n          const dependencyMapping = {\n            \"eventManager\":    this.eventManager,\n            \"app\":             this.app,\n            \"languageManager\": this.languageManager\n          };\n          const params = eventCfg.dependencies.map(dep => dependencyMapping[dep]);\n\n          // Dynamically import the event class from the triad entry for eventCfg.key\n          try {\n            // Import the entire triad bundle for this eventKey via alias \"triads\"\n            const module = await import(\n              /* webpackChunkName: \"triads/triad-[request]\" */\n              `triads/triad-${eventCfg.key}.js`\n            );\n            const EventClass = module[eventCfg.className];\n            if (!EventClass) {\n              ErrorManager.logError(\n                `Event class \"${eventCfg.className}\" is not exported from triads/triad-${eventCfg.key}.js.`,\n                \"GameEventManager\"\n              );\n              continue;\n            }\n            const instance = new EventClass(...params);\n            // Set the key as specified in the config.\n            instance.key = eventCfg.key;\n            this.events.push(instance);\n          } catch (error) {\n            ErrorManager.logError(\n              `Failed to import triad for event \"${eventCfg.key}\": ${error.message}`,\n              \"GameEventManager\"\n            );\n          }\n        }\n        console.log(\"Game events loaded from configuration:\", this.events.map(e => e.key));\n      })\n      .catch(error => {\n        ErrorManager.logError(error, \"GameEventManager.loadConfig\");\n        ErrorManager.showError(\"Failed to load game events configuration\");\n      });\n  }\n\n  /**\n   * Activates an event by its key.\n   * @param {string} key - The event key.\n   */\n  async activateEvent(key) {\n    let event = this.events.find(e => e.key === key);\n    // Fallback for dynamic keys (e.g. \"post_repeating_event_stage_X\")\n    if (!event && key.startsWith(\"post_repeating_event\")) {\n      event = this.events.find(e => e.key === \"post_repeating_event\");\n    }\n    if (event) {\n      await event.activate(key);\n      console.log(`Event '${key}' activated.`);\n    } else {\n      ErrorManager.logError(`Event \"${key}\" not found`, \"GameEventManager.activateEvent\");\n      ErrorManager.showError(`Cannot activate event \"${key}\"`);\n    }\n  }\n\n  /**\n   * Automatically launches the welcome event (after 5 seconds) post-registration,\n   * if the \"welcomeDone\" flag is not set.\n   */\n  async autoLaunchWelcomeEvent() {\n    if (StateManager.get(StateManager.KEYS.WELCOME_DONE) === \"true\") {\n      console.log(\"Welcome event already completed; auto-launch skipped.\");\n      return;\n    }\n    console.log(\"Auto-launching welcome event in 5 seconds...\");\n    setTimeout(async () => {\n      await this.activateEvent(\"welcome\");\n    }, 5000);\n  }\n}","// File: src/managers/GhostManager.js\n\nimport { ErrorManager } from './ErrorManager.js';\nimport { StateManager } from './StateManager.js';\nimport { loadGameEntitiesConfig } from '../utils/GameEntityLoader.js';\nimport { SequenceManager } from '../utils/SequenceManager.js';\n\n/**\n * GhostManager class\n * \n * Manages the list of ghosts and their state. Responsibilities include:\n * - Maintaining the active ghost and tracking its phenomenon (quest step) progress.\n * - Saving ghost state via DatabaseManager.\n * - Triggering events (e.g., final event) via GameEventManager.\n *\n * NEW CHANGES:\n * - The event–quest sequence is now loaded from a unified JSON configuration.\n * - The active quest key is stored persistently using StateManager.\n * - A unified method 'canStartQuest' is provided to check if a quest can start:\n *    1. A non-finished quest record does not exist.\n *    2. There is no active quest registered in the StateManager.\n *    3. The quest key matches the expected next quest in the sequence.\n * - Auto-launch of the first event (e.g., \"welcome\") is performed if registration is complete.\n * - Dynamic update of the Post button state added via updatePostButtonState():\n *    the button is enabled only if no quest is active.\n * - **New:** On starting a quest the camera button is set to active,\n *   and upon quest completion the active state (class) is removed.\n */\nexport class GhostManager {\n  /**\n   * @param {number} currentSequenceIndex - Starting index for the event–quest sequence (from StateManager).\n   * @param {ProfileManager} profileManager - Manager for saving ghost progress.\n   * @param {App} app - The main application instance.\n   */\n  constructor(currentSequenceIndex, profileManager, app) {\n    // Set initial sequence index (will be updated after loading config).\n    this.currentSequenceIndex = currentSequenceIndex;\n    this.profileManager = profileManager;\n    this.app = app;\n\n    // In-memory flag for the active quest key (persisted in StateManager).\n    this.activeQuestKey = StateManager.getActiveQuestKey();\n    this.questActive = !!this.activeQuestKey; // true if an active quest key is stored.\n\n    // eventManager will be assigned externally (see App.js).\n    this.eventManager = null;\n\n    // Initialize ghost list with only the default ghost.\n    this.ghosts = [];\n    this.setupGhosts();\n\n    // Set the active ghost (default ID = 1).\n    this.currentGhostId = 1;\n    // Current phenomenon (quest step) index for the active ghost.\n    this.currentPhenomenonIndex = 0;\n\n    const currentGhost = this.getCurrentGhost();\n    console.log(`Current active ghost: ${currentGhost ? currentGhost.name : 'not found'}`);\n\n    // Load the unified configuration and initialize the sequence manager from the \"sequence\" section.\n    loadGameEntitiesConfig()\n      .then(config => {\n        this.sequenceManager = new SequenceManager(config.sequence);\n        const savedIndex = parseInt(StateManager.get(StateManager.KEYS.CURRENT_SEQUENCE_INDEX), 10) || 0;\n        this.sequenceManager.currentIndex = savedIndex;\n        console.log(`Sequence configuration loaded. Current index: ${this.sequenceManager.currentIndex}`);\n\n        // Auto-launch the first event if registration is complete and the welcome event has not been executed.\n        if (StateManager.get(\"registrationCompleted\") === \"true\" && StateManager.get(\"welcomeDone\") !== \"true\") {\n          const firstEntry = this.sequenceManager.getCurrentEntry();\n          if (firstEntry) {\n            console.log(`Auto-launching initial event: ${firstEntry.eventKey}`);\n            this.eventManager.activateEvent(firstEntry.eventKey);\n            // Save the active quest key using the universal mechanism.\n            this.activeQuestKey = firstEntry.questKey;\n            StateManager.set(\"activeQuestKey\", this.activeQuestKey);\n          }\n        }\n      })\n      .catch(error => {\n        ErrorManager.logError(error, \"GhostManager.loadConfig\");\n        ErrorManager.showError(\"Failed to load game configuration\");\n      });\n\n    // Subscribe to global events for completions.\n    document.addEventListener(\"gameEventCompleted\", (e) => {\n      this.onEventCompleted(e.detail);\n    });\n    document.addEventListener(\"questCompleted\", (e) => {\n      this.onQuestCompleted(e.detail);\n    });\n  }\n\n  /**\n   * Generates the list of ghosts.\n   * CURRENT CHANGE: Only the default ghost is created.\n   */\n  setupGhosts() {\n    const defaultGhost = {\n      id: 1,\n      name: \"ghost 1\", // Default ghost name.\n      phenomenaCount: 3, // Fixed number of phenomena (quest steps).\n      isFinished: false\n    };\n    this.ghosts = [defaultGhost];\n  }\n\n  /**\n   * Returns the active ghost based on currentGhostId.\n   * @returns {object|undefined} The ghost object, or undefined if not found.\n   */\n  getCurrentGhost() {\n    return this.ghosts.find(g => g.id === this.currentGhostId);\n  }\n\n  /**\n   * Sets the active ghost by its ID and saves its state.\n   * @param {number} ghostId - The ID of the ghost to activate.\n   */\n  async setCurrentGhost(ghostId) {\n    this.currentGhostId = ghostId;\n    const ghost = this.getCurrentGhost();\n    if (ghost) {\n      console.log(`Ghost ${ghost.name} activated.`);\n      await this.app.databaseManager.saveGhostState(ghost);\n    } else {\n      ErrorManager.logError(`Ghost with ID=${ghostId} not found!`, \"setCurrentGhost\");\n    }\n  }\n\n  /**\n   * Marks the current ghost as finished and saves its state.\n   */\n  async finishCurrentGhost() {\n    const ghost = this.getCurrentGhost();\n    if (ghost) {\n      ghost.isFinished = true;\n      console.log(`Ghost ${ghost.name} finished.`);\n      await this.app.databaseManager.saveGhostState(ghost);\n    } else {\n      ErrorManager.logError(\"Cannot finish ghost: ghost not found.\", \"finishCurrentGhost\");\n    }\n  }\n\n  /**\n   * Checks if the current ghost is finished.\n   * @returns {boolean} True if finished; otherwise, false.\n   */\n  isCurrentGhostFinished() {\n    const ghost = this.getCurrentGhost();\n    return ghost ? ghost.isFinished : false;\n  }\n\n  /**\n   * Initiates the next phenomenon (quest step) for the current ghost.\n   * Adds a diary entry and updates progress. If all steps are complete, triggers the final event.\n   */\n  async triggerNextPhenomenon() {\n    const ghost = this.getCurrentGhost();\n    if (!ghost) {\n      ErrorManager.logError(\"No ghost found to trigger phenomenon.\", \"triggerNextPhenomenon\");\n      return;\n    }\n    if (ghost.isFinished) {\n      ErrorManager.logError(`Ghost \"${ghost.name}\" is already finished; phenomena unavailable.`, \"triggerNextPhenomenon\");\n      return;\n    }\n    if (this.currentPhenomenonIndex < ghost.phenomenaCount) {\n      const phenomenonNumber = this.currentPhenomenonIndex + 1;\n      const phenomenonEntry = `${ghost.name}: Phenomenon ${phenomenonNumber} - Approach the mirror`;\n      await this.eventManager.addDiaryEntry(phenomenonEntry);\n      console.log(`Triggered phenomenon for ${ghost.name}: ${phenomenonEntry}`);\n      this.currentPhenomenonIndex++;\n      await this.profileManager.saveGhostProgress({\n        ghostId: this.currentGhostId,\n        phenomenonIndex: this.currentPhenomenonIndex\n      });\n      if (this.currentPhenomenonIndex === ghost.phenomenaCount) {\n        const finalEntry = `${ghost.name}: Final phenomenon – ghost finished!`;\n        await this.eventManager.addDiaryEntry(finalEntry);\n        console.log(finalEntry);\n        console.log(`Triggering final event for ghost \"${ghost.name}\"...`);\n        await this.app.gameEventManager.activateEvent(\"ghost_final_event\");\n      }\n    } else {\n      ErrorManager.logError(`All phenomena for ghost ${ghost.name} have been completed (index=${this.currentPhenomenonIndex}).`, \"triggerNextPhenomenon\");\n    }\n  }\n\n  /**\n   * Resets the ghost chain: sets active ghost to default, resets phenomenon index,\n   * clears ghost progress, and updates the database.\n   */\n  async resetGhostChain() {\n    this.currentGhostId = 1;\n    this.currentPhenomenonIndex = 0;\n    await this.profileManager.resetGhostProgress();\n    console.log(\"Ghost chain has been reset.\");\n    const ghost = this.getCurrentGhost();\n    if (ghost) {\n      ghost.isFinished = false;\n      await this.app.databaseManager.saveGhostState(ghost);\n    } else {\n      ErrorManager.logError(\"Failed to reset ghost chain: default ghost not found.\", \"resetGhostChain\");\n    }\n  }\n\n  // --------------- New API: Sequential Event and Quest Management ---------------\n\n  /**\n   * Checks if the provided quest key matches the expected quest from the sequence configuration.\n   * @param {string} questKey - The quest key to check.\n   * @returns {boolean} True if it matches; otherwise, false.\n   */\n  isNextInSequence(questKey) {\n    return this.sequenceManager ? this.sequenceManager.isNextQuest(questKey) : false;\n  }\n\n  /**\n   * Checks if the provided event key matches the expected event from the sequence configuration.\n   * @param {string} eventKey - The event key to check.\n   * @returns {boolean} True if it matches; otherwise, false.\n   */\n  isNextEvent(eventKey) {\n    return this.sequenceManager ? this.sequenceManager.isNextEvent(eventKey) : false;\n  }\n\n  /**\n   * Determines if a quest can be started.\n   * Checks that there is no active unfinished record in the database, no active quest in the StateManager,\n   * and that the quest key is the next expected in the sequence.\n   * @param {string} questKey - The quest key to start.\n   * @returns {boolean} True if the quest can be launched; false otherwise.\n   */\n  canStartQuest(questKey) {\n    // 1) Check for an existing unfinished quest record.\n    const record = this.app.databaseManager.getQuestRecord(questKey);\n    if (record && record.status !== \"finished\") {\n      console.warn(`Quest \"${questKey}\" is already active with status \"${record.status}\".`);\n      return false;\n    }\n    // 2) Check if an active quest is already recorded.\n    const activeQuestKey = StateManager.getActiveQuestKey();\n    // Block if an active quest exists and it does not match the quest we're trying to start.\n    if (activeQuestKey && activeQuestKey !== questKey) {\n      console.warn(`Another quest \"${activeQuestKey}\" is already active, cannot start quest \"${questKey}\".`);\n      return false;\n    }\n    // 3) Check if this quest is the next expected in the sequence.\n    if (!this.isNextInSequence(questKey)) {\n      console.error(`Quest \"${questKey}\" is not the next expected quest in the sequence.`);\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Starts a quest after verifying eligibility using the unified check.\n   * @param {string} questKey - The quest key to start.\n   */\n  async startQuest(questKey) {\n    if (!this.canStartQuest(questKey)) {\n      console.error(`Cannot start quest with key: ${questKey}. Unified check failed.`);\n      return;\n    }\n    console.log(`GhostManager: Starting quest with key: ${questKey}`);\n    await this.app.questManager.activateQuest(questKey);\n    // Update the active quest key universally.\n    this.activeQuestKey = questKey;\n    StateManager.setActiveQuestKey(questKey);\n    await this.app.questManager.syncQuestState();\n    // When a quest starts, mark the camera button as active.\n    this.app.viewManager.setCameraButtonActive(true);\n  }\n\n  /**\n   * Starts an event.\n   * @param {string} eventKey - The event key to start.\n   * @param {boolean} [isFollowup=false] - If true, bypasses the sequence check.\n   */\n  async startEvent(eventKey, isFollowup = false) {\n    if (!isFollowup && !this.isNextEvent(eventKey)) {\n      console.error(`Event \"${eventKey}\" is not next in sequence.`);\n      return;\n    }\n    console.log(`GhostManager: Starting event with key: ${eventKey}`);\n    await this.app.gameEventManager.activateEvent(eventKey);\n  }\n\n  /**\n   * Updates the Post button state based on whether an active quest is present.\n   * If an active quest exists, the button is disabled; otherwise, it is enabled.\n   */\n  updatePostButtonState() {\n    // Получаем следующий элемент последовательности (или null)\n    const nextEntry = this.sequenceManager\n      ? this.sequenceManager.getCurrentEntry()\n      : null;\n    // Есть ли валидный questKey и можно ли его запустить?\n    const canStart = nextEntry\n      ? this.canStartQuest(nextEntry.questKey)\n      : false;\n    // Применяем к ViewManager\n    this.app.viewManager.setPostButtonEnabled(canStart);\n    console.log(\n      `[GhostManager] Post button state updated: enabled=${canStart}`\n    );\n  }\n\n  /**\n   * Handles the Post button click.\n   * Immediately disables the button, retrieves the next sequence entry, and checks if the quest can be started.\n   */\n  async handlePostButtonClick() {\n    // Disable the Post button immediately to prevent double-clicks.\n    this.app.viewManager.setPostButtonEnabled(false);\n    const nextEntry = this.sequenceManager ? this.sequenceManager.getCurrentEntry() : null;\n    if (!nextEntry) {\n      console.warn(\"No next sequence entry found.\");\n      this.updatePostButtonState();\n      return;\n    }\n    console.log(`GhostManager: Handling Post button click. Next expected quest: ${nextEntry.questKey}`);\n    if (!this.canStartQuest(nextEntry.questKey)) {\n      this.updatePostButtonState();\n      return;\n    }\n    await this.startQuest(nextEntry.questKey);\n    // After starting the quest, update the Post button state.\n    this.updatePostButtonState();\n  }\n\n  /**\n   * Called when a game event completes.\n   * Increments the sequence index if the completed event matches the expected next event.\n   * @param {string} eventKey - The completed event key.\n   */\n  onEventCompleted(eventKey) {\n    console.log(`GhostManager: Event completed with key: ${eventKey}`);\n    if (this.sequenceManager && this.sequenceManager.getCurrentEntry().nextEventKey === eventKey) {\n      this.sequenceManager.increment();\n      StateManager.set(StateManager.KEYS.CURRENT_SEQUENCE_INDEX, String(this.sequenceManager.currentIndex));\n      console.log(`GhostManager: Sequence index incremented to ${this.sequenceManager.currentIndex}`);\n    }\n  }\n\n  /**\n   * Called when a quest completes.\n   * For repeating quests, triggers a dynamic event for intermediate stages;\n   * if the quest is fully completed, uses the final event key from the configuration.\n   * For non-repeating quests, starts the next event as defined in the sequence.\n   * @param {string} questKey - The completed quest key.\n   */\n  async onQuestCompleted(questKey) {\n    console.log(`GhostManager: Quest completed with key: ${questKey}`);\n    // Clear the active quest key.\n    this.activeQuestKey = null;\n    StateManager.setActiveQuestKey(null);\n\n    // Update the Post button state after quest completion.\n    this.updatePostButtonState();\n    // Deactivate the camera button since the quest is finished.\n    this.app.viewManager.setCameraButtonActive(false);\n\n    if (questKey === \"repeating_quest\") {\n      const repeatingQuest = this.app.questManager.quests.find(q => q.key === \"repeating_quest\");\n      const questStatus = repeatingQuest \n        ? await repeatingQuest.getCurrentQuestStatus() \n        : { currentStage: 1, totalStages: 1 };\n      console.log(\"Repeating quest status:\", questStatus);\n      if (questStatus.currentStage <= questStatus.totalStages) {\n        // Intermediate stage: dynamically generate the event key.\n        const dynamicEventKey = `post_repeating_event_stage_${questStatus.currentStage}`;\n        console.log(`Repeating quest stage completed. Triggering generated event: ${dynamicEventKey}`);\n        await this.startEvent(dynamicEventKey, true);\n        return;\n      } else {\n        // Quest has reached its final stage: use the final event key from config.\n        const currentEntry = this.sequenceManager ? this.sequenceManager.getCurrentEntry() : null;\n        if (currentEntry && currentEntry.nextEventKey) {\n          console.log(`Repeating quest fully completed. Now starting ghost event from config: ${currentEntry.nextEventKey}`);\n          await this.startEvent(currentEntry.nextEventKey, true);\n        } else {\n          console.warn(\"No final event configured for repeating quest completion. Unable to start final event.\");\n        }\n        this.sequenceManager.increment();\n        StateManager.set(StateManager.KEYS.CURRENT_SEQUENCE_INDEX, String(this.sequenceManager.currentIndex));\n        return;\n      }\n    }\n\n    const currentEntry = this.sequenceManager ? this.sequenceManager.getCurrentEntry() : null;\n    if (currentEntry && currentEntry.questKey === questKey && currentEntry.nextEventKey) {\n      console.log(`GhostManager: Quest completed. Now starting ghost event: ${currentEntry.nextEventKey}`);\n      await this.startEvent(currentEntry.nextEventKey, true);\n    }\n  }\n}","// Import base locales and chat locales, then merge them\nimport baseLocales from '../locales/locales.js';\nimport chatLocales_en from '../locales/chatLocales_en.js';\nimport chatLocales_ru from '../locales/chatLocales_ru.js';\nimport chatLocales_uk from '../locales/chatLocales_uk.js';\n\n// Merge base and chat locales for each language\nconst mergedLocales = {\n  en: { ...baseLocales.en, ...chatLocales_en },\n  ru: { ...baseLocales.ru, ...chatLocales_ru },\n  uk: { ...baseLocales.uk, ...chatLocales_uk }\n};\n\n/**\n * LanguageManager is responsible for managing localization in the application.\n * It loads the translation dictionaries (locales), listens for changes on the language selector,\n * and updates all page elements that have the data-i18n attribute.\n * This class also saves the selected language in localStorage to preserve the choice between sessions.\n */\nexport class LanguageManager {\n  /**\n   * Constructor for LanguageManager.\n   * @param {string} selectorId - The ID of the <select> element used for language selection.\n   *\n   * During initialization:\n   * - The merged translation dictionary is loaded.\n   * - The current language is set from localStorage (or defaults to 'en').\n   * - The selector's value is updated, and applyLanguage() is called to update the UI.\n   * - A change event listener is added to the selector to handle language switching.\n   */\n  constructor(selectorId) {\n    // Use merged locales (base + chat)\n    this.locales = mergedLocales;\n\n    // Get the language selector element by its ID.\n    this.selector = document.getElementById(selectorId);\n    if (!this.selector) {\n      console.error(`Language selector with id \"${selectorId}\" not found.`);\n    }\n\n    // Set the current language from localStorage, defaulting to 'en'.\n    this.currentLanguage = localStorage.getItem('language') || 'en';\n\n    // Update the selector to reflect the current language.\n    if (this.selector) {\n      this.selector.value = this.currentLanguage;\n    }\n\n    // Apply the selected language to all elements with the data-i18n attribute.\n    this.applyLanguage();\n\n    // Add an event listener to update the language when the selector's value changes.\n    if (this.selector) {\n      this.selector.addEventListener('change', () => {\n        this.currentLanguage = this.selector.value;\n        localStorage.setItem('language', this.currentLanguage);\n        this.applyLanguage();\n      });\n    }\n  }\n\n  /**\n   * applyLanguage – Updates the text content of all elements with the data-i18n attribute\n   * based on the selected language.\n   *\n   * This method iterates over all elements with data-i18n, retrieves the translation key,\n   * and replaces the element's text content with the corresponding translation from the dictionary.\n   */\n  applyLanguage() {\n    document.querySelectorAll('[data-i18n]').forEach(el => {\n      const key = el.getAttribute('data-i18n');\n      // If a translation exists for the key in the current language, update the text.\n      if (this.locales[this.currentLanguage] && this.locales[this.currentLanguage][key]) {\n        el.textContent = this.locales[this.currentLanguage][key];\n      }\n    });\n  }\n\n  /**\n   * updateContainerLanguage – Updates the text content of all elements with the data-i18n attribute\n   * within a specific container. This is useful for dynamically inserted content.\n   *\n   * @param {HTMLElement} container - The container element in which to update localized text.\n   */\n  updateContainerLanguage(container) {\n    if (!container) return;\n    container.querySelectorAll('[data-i18n]').forEach(el => {\n      const key = el.getAttribute('data-i18n');\n      if (this.locales[this.currentLanguage] && this.locales[this.currentLanguage][key]) {\n        el.textContent = this.locales[this.currentLanguage][key];\n      }\n    });\n  }\n\n  /**\n   * Optional method: startObservingContainer\n   * Sets up a MutationObserver on a given container to automatically update any newly\n   * added elements with the data-i18n attribute.\n   *\n   * @param {HTMLElement} container - The container element to observe.\n   * @returns {MutationObserver} The observer instance (can be disconnected when no longer needed).\n   */\n  startObservingContainer(container) {\n    if (!container) return;\n    const observer = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        mutation.addedNodes.forEach(node => {\n          if (node.nodeType === Node.ELEMENT_NODE) {\n            // If the new node itself has data-i18n attribute, update it.\n            if (node.hasAttribute && node.hasAttribute('data-i18n')) {\n              const key = node.getAttribute('data-i18n');\n              if (this.locales[this.currentLanguage] && this.locales[this.currentLanguage][key]) {\n                node.textContent = this.locales[this.currentLanguage][key];\n              }\n            }\n            // Also update any descendant elements.\n            if (node.querySelectorAll) {\n              node.querySelectorAll('[data-i18n]').forEach(el => {\n                const key = el.getAttribute('data-i18n');\n                if (this.locales[this.currentLanguage] && this.locales[this.currentLanguage][key]) {\n                  el.textContent = this.locales[this.currentLanguage][key];\n                }\n              });\n            }\n          }\n        });\n      });\n    });\n    observer.observe(container, { childList: true, subtree: true });\n    console.log(\"[LanguageManager] Started observing container for localization updates.\");\n    return observer;\n  }\n\n  /**\n   * getLanguage – Returns the currently selected language.\n   * @returns {string} The current language (e.g., 'en', 'ru', 'uk').\n   */\n  getLanguage() {\n    return this.currentLanguage;\n  }\n\n  /**\n   * translate – Returns the localized text for the given key.\n   *\n   * @param {string} key - The localization key.\n   * @param {string} [defaultValue=key] - The default value if no translation is found.\n   * @returns {string} The localized text.\n   */\n  translate(key, defaultValue = key) {\n    if (this.locales[this.currentLanguage] && this.locales[this.currentLanguage][key]) {\n      return this.locales[this.currentLanguage][key];\n    }\n    return defaultValue;\n  }\n}","export class NotificationManager {\n  showNotification(message) {\n    if (!(\"Notification\" in window)) {\n      console.warn(\"⚠️ Notifications are not supported in this browser.\");\n      return;\n    }\n    if (Notification.permission === \"granted\") {\n      new Notification(message);\n    } else if (Notification.permission !== \"denied\") {\n      Notification.requestPermission().then(permission => {\n        if (permission === \"granted\") {\n          new Notification(message);\n        }\n      });\n    }\n  }\n}","import { StateManager } from './StateManager.js';\nimport { ErrorManager } from './ErrorManager.js';\n\nexport class ProfileManager {\n  /**\n   * Constructor for ProfileManager.\n   * @param {SQLiteDataManager} dataManager - An instance of the DataManager responsible for profile persistence.\n   */\n  constructor(dataManager) {\n    // Save a reference to the DataManager for profile and related data persistence.\n    this.dataManager = dataManager;\n  }\n\n  /**\n   * isProfileSaved – Asynchronously checks if a profile is saved via the DataManager.\n   * @returns {Promise<boolean>} Resolves to true if a profile exists, otherwise false.\n   */\n  async isProfileSaved() {\n    const profile = await this.dataManager.getProfile();\n    return !!profile;\n  }\n\n  /**\n   * getProfile – Asynchronously retrieves the profile from the DataManager.\n   * @returns {Promise<Object|null>} Resolves to the profile object or null if not found.\n   */\n  async getProfile() {\n    return await this.dataManager.getProfile();\n  }\n\n  /**\n   * saveProfile – Asynchronously saves the given profile object via the DataManager.\n   *\n   * IMPORTANT: Registration data (name, gender, language, selfie, etc.) should be \n   * integrated into the profile object. Do not store additional transient keys.\n   *\n   * @param {Object} profile - The profile object (should include registration fields).\n   * @returns {Promise<void>}\n   */\n  async saveProfile(profile) {\n    await this.dataManager.saveProfile(profile);\n  }\n\n  /**\n   * resetProfile – Resets the profile and all related data.\n   * Calls the DataManager to remove profile data along with ghost and quest progress,\n   * and clears all transient state keys from localStorage (except for the language key).\n   * Also resets the SQL database stored in IndexedDB.\n   * After reset, the service worker cache is cleared and the page is reloaded.\n   */\n  resetProfile() {\n    Promise.all([\n      this.dataManager.resetProfile(),    // Deletes the 'profile' key.\n      this.dataManager.resetDatabase()      // Deletes the SQL database saved under 'sqlite', fully clearing tables.\n    ]).then(() => {\n      // Clear all keys from localStorage except the language-related key.\n      const preserveKeys = [\"language\"]; // Adjust this array if language key is stored under a different name.\n      for (let i = localStorage.length - 1; i >= 0; i--) {\n        const key = localStorage.key(i);\n        if (!preserveKeys.includes(key)) {\n          localStorage.removeItem(key);\n        }\n      }\n\n      // NEW: Tell the Service Worker to skip waiting and clear caches\n      if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {\n        // ask the new SW to activate immediately\n        navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });\n        // clear all caches so that clients navigates and picks up the new version\n        navigator.serviceWorker.controller.postMessage({ action: 'CLEAR_CACHE' });\n        console.log(\"Service Worker skipWaiting and CLEAR_CACHE messages sent.\");\n      }\n      // Reload will be handled by the SW via controllerchange → clients.navigate()\n    }).catch((err) => {\n      ErrorManager.logError(err, \"resetProfile\");\n    });\n  }\n\n  /**\n   * exportProfileData – Exports the profile along with diary entries, apartment plan,\n   * quest progress, and chat messages to a JSON file.\n   * @param {Object} databaseManager - The database manager for retrieving diary, quest, and chat data.\n   * @param {Object} apartmentPlanManager - The apartment plan manager.\n   */\n  exportProfileData(databaseManager, apartmentPlanManager) {\n    this.getProfile().then(profile => {\n      if (!profile) {\n        alert(\"No profile found to export.\");\n        return;\n      }\n      // Filter profile to include only essential registration fields.\n      const filteredProfile = {\n        name: profile.name,\n        gender: profile.gender,\n        language: profile.language,\n        selfie: profile.selfie\n      };\n\n      // Retrieve diary entries.\n      const diaryEntries = databaseManager.getDiaryEntries();\n      // Retrieve chat messages.\n      const chatMessages = databaseManager.getChatMessages();\n      // Retrieve apartment plan data if available.\n      const apartmentPlanData = apartmentPlanManager ? apartmentPlanManager.rooms : [];\n      \n      // Retrieve quest progress data from the database.\n      let questProgressData = [];\n      const result = databaseManager.db.exec(\"SELECT * FROM quest_progress ORDER BY id DESC\");\n      if (result.length > 0) {\n        questProgressData = result[0].values.map(row => ({\n          id: row[0],\n          quest_key: row[1],\n          status: row[2]\n        }));\n      }\n  \n      // Form the export object including chat messages.\n      const exportData = {\n        profile: filteredProfile,\n        diary: diaryEntries,\n        apartment: apartmentPlanData,\n        quests: questProgressData,\n        chat: chatMessages\n      };\n  \n      // Create a Blob from the JSON string.\n      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'profile.json';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n  }\n\n  /**\n   * importProfileData – Imports profile data from the selected JSON file.\n   * After import, updates the profile, diary, apartment plan, quest progress, and chat messages, then reloads the page.\n   * @param {File} file - The file containing the profile data.\n   * @param {Object} databaseManager - The database manager.\n   * @param {Object} apartmentPlanManager - The apartment plan manager.\n   */\n  importProfileData(file, databaseManager, apartmentPlanManager) {\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const importedData = JSON.parse(e.target.result);\n        // Validate essential profile fields.\n        if (!importedData.profile || !importedData.profile.name || !importedData.profile.gender ||\n            !importedData.profile.selfie || !importedData.profile.language) {\n          alert(\"Invalid profile file. Required profile fields are missing.\");\n          return;\n        }\n        // Save the profile via DataManager.\n        this.saveProfile(importedData.profile);\n  \n        // Import diary entries.\n        if (importedData.diary && Array.isArray(importedData.diary)) {\n          importedData.diary.forEach(entry => {\n            if (entry.entry && entry.timestamp) {\n              databaseManager.db.run(\n                \"INSERT INTO diary (entry, timestamp) VALUES (?, ?)\",\n                [entry.entry, entry.timestamp]\n              );\n            }\n          });\n          databaseManager.saveDatabase();\n        }\n  \n        // Import apartment plan data, if available.\n        if (importedData.apartment && Array.isArray(importedData.apartment)) {\n          if (apartmentPlanManager) {\n            apartmentPlanManager.rooms = importedData.apartment;\n            apartmentPlanManager.renderRooms();\n          }\n        }\n  \n        // Import quest progress.\n        if (importedData.quests && Array.isArray(importedData.quests)) {\n          importedData.quests.forEach(progress => {\n            if (progress.quest_key && progress.status) {\n              databaseManager.addQuestProgress(progress.quest_key, progress.status);\n            }\n          });\n        }\n  \n        // Import chat messages.\n        if (importedData.chat && Array.isArray(importedData.chat)) {\n          importedData.chat.forEach(msg => {\n            if (msg.sender && msg.message && msg.timestamp) {\n              databaseManager.db.run(\n                \"INSERT INTO chat_messages (sender, message, timestamp) VALUES (?, ?, ?)\",\n                [msg.sender, msg.message, msg.timestamp]\n              );\n            }\n          });\n          databaseManager.saveDatabase();\n        }\n  \n        // Clear transient state keys using StateManager.\n        StateManager.remove(\"cameraButtonActive\");\n        StateManager.remove(\"shootButtonActive\");\n        StateManager.remove(\"quest_state_repeating_quest\");\n  \n        alert(\"Profile imported successfully. Reloading page.\");\n        window.location.reload();\n      } catch (err) {\n        ErrorManager.logError(err, \"importProfileData\");\n        alert(\"Error parsing the profile file.\");\n      }\n    };\n    reader.readAsText(file);\n  }\n\n  /**\n   * saveGhostProgress – Saves ghost progress data via the DataManager.\n   * @param {Object} progress - Progress data (e.g., { ghostId: number, phenomenonIndex: number }).\n   */\n  saveGhostProgress(progress) {\n    this.dataManager.saveGhostProgress(progress);\n  }\n\n  /**\n   * getGhostProgress – Retrieves the saved ghost progress via the DataManager.\n   * @returns {Object|null} The progress object or null if not set.\n   */\n  getGhostProgress() {\n    return this.dataManager.getGhostProgress();\n  }\n\n  /**\n   * resetGhostProgress – Resets ghost progress via the DataManager.\n   */\n  resetGhostProgress() {\n    this.dataManager.resetGhostProgress();\n  }\n\n  /**\n   * saveLocationType – Saves the user's selected location type via the DataManager.\n   * @param {string} locationType - The location type.\n   */\n  saveLocationType(locationType) {\n    this.dataManager.saveLocationType(locationType);\n  }\n\n  /**\n   * getLocationType – Retrieves the saved location type via the DataManager.\n   * @returns {string|null} The location type or null if not set.\n   */\n  getLocationType() {\n    return this.dataManager.getLocationType();\n  }\n}","// File: src/managers/QuestManager.js\n\nimport { StateManager } from './StateManager.js';\nimport { ErrorManager } from './ErrorManager.js';\nimport { loadGameEntitiesConfig, getQuestKeyToEventKeyMap } from '../utils/GameEntityLoader.js';\n\n/**\n * QuestManager class\n * \n * Responsible for managing quest activation, state updates, and UI restoration.\n * It loads quest definitions dynamically from a unified JSON configuration.\n */\nexport class QuestManager {\n  /**\n   * @param {EventManager} eventManager - The event manager handling diary entries.\n   * @param {App} appInstance - The main application instance.\n   */\n  constructor(eventManager, appInstance) {\n    this.eventManager = eventManager;\n    this.app          = appInstance;\n    this.quests       = [];\n\n    // Load the unified configuration and instantiate quests dynamically.\n    // Also prepare a mapping from questKey to its parent eventKey.\n    Promise.all([ loadGameEntitiesConfig(), getQuestKeyToEventKeyMap() ])\n      .then(async ([config, questKeyToEventKey]) => {\n        for (const questCfg of config.quests) {\n          // Build dependency mapping.\n          const dependencyMapping = {\n            \"eventManager\": this.eventManager,\n            \"app\":          this.app\n          };\n          const params = questCfg.dependencies.map(dep => dependencyMapping[dep]);\n          // If quest-specific configuration exists, append it.\n          if (questCfg.config) {\n            params.push(questCfg.config);\n          }\n\n          // Determine which triad chunk this quest belongs to.\n          const eventKey = questKeyToEventKey[questCfg.key];\n          if (!eventKey) {\n            ErrorManager.logError(\n              `Cannot find parent eventKey for quest \"${questCfg.key}\".`,\n              \"QuestManager\"\n            );\n            continue;\n          }\n\n          // Dynamically import the triad bundle for that eventKey instead of individual quest file.\n          try {\n            // Import via alias \"triads\" so Webpack resolves build/triads/triad-<eventKey>.js\n            const module = await import(\n              /* webpackChunkName: \"triads/triad-[request]\" */\n              `triads/triad-${eventKey}.js`\n            );\n            const QuestClass = module[questCfg.className];\n            if (!QuestClass) {\n              ErrorManager.logError(\n                `Quest class \"${questCfg.className}\" is not exported from triads/triad-${eventKey}.js.`,\n                \"QuestManager\"\n              );\n              continue;\n            }\n            const instance = new QuestClass(...params);\n            // Set the key as specified in the configuration.\n            instance.key = questCfg.key;\n            this.quests.push(instance);\n          } catch (error) {\n            ErrorManager.logError(\n              `Failed to import triad for quest \"${questCfg.key}\": ${error.message}`,\n              \"QuestManager\"\n            );\n          }\n        }\n        console.log(\"Quests loaded from configuration:\", this.quests.map(q => q.key));\n      })\n      .catch(error => {\n        ErrorManager.logError(error, \"QuestManager.loadConfig\");\n        ErrorManager.showError(\"Failed to load quests configuration\");\n      });\n\n    this.initCameraListeners();\n\n    // Restore UI state for the repeating quest if a saved state exists.\n    if (StateManager.get(StateManager.KEYS.REPEATING_QUEST_STATE)) {\n      console.log(\"[QuestManager] Detected saved state for repeating quest.\");\n      this.restoreRepeatingQuestUI();\n    }\n    if (this.app.viewManager && typeof this.app.viewManager.restoreCameraButtonState === 'function') {\n      this.app.viewManager.restoreCameraButtonState();\n    }\n    // *** Add restoration for the Shoot button ***\n    if (this.app.viewManager && typeof this.app.viewManager.restoreShootButtonState === 'function') {\n      this.app.viewManager.restoreShootButtonState();\n    }\n  }\n\n  /**\n   * Registers listeners for camera readiness and closure events.\n   */\n  initCameraListeners() {\n    const cameraManager = this.app.cameraSectionManager;\n    if (!cameraManager) return;\n\n    cameraManager.onVideoReady = async () => {\n      console.log(\"[QuestManager] onVideoReady signal received.\");\n\n      if (StateManager.getActiveQuestKey() === \"repeating_quest\") {\n        const repeatingQuest = this.quests.find(q => q.key === \"repeating_quest\");\n\n        console.log(`[QuestManager] Detection target is \"${repeatingQuest.currentTarget}\"`);\n\n        const config = repeatingQuest.generateDetectionConfig();\n        await this.app.cameraSectionManager.startAIDetection(config);\n      }\n    };\n\n    cameraManager.onCameraClosed = () => {\n      console.log(\"[QuestManager] onCameraClosed signal received. Stopping detection.\");\n      this.app.cameraSectionManager.stopAIDetection();\n    };\n  }\n\n  /**\n   * Universal method to synchronize the state for a given quest.\n   * Uses the universal active quest key stored in StateManager.\n   * If the active quest key matches the provided questKey, the Post button is disabled;\n   * otherwise, the Post button is enabled.\n   * @param {string} questKey - The key of the quest to synchronize.\n   */\n  async syncQuestStateForQuest(questKey) {\n    // If the game is finalized, disable Post button.\n    if (StateManager.get(StateManager.KEYS.GAME_FINALIZED) === \"true\") {\n      if (this.app.viewManager && typeof this.app.viewManager.setPostButtonEnabled === 'function') {\n        this.app.viewManager.setPostButtonEnabled(false);\n      }\n      console.log(`[QuestManager.syncQuestStateForQuest] Game finalized; Post button disabled for quest \"${questKey}\".`);\n      return;\n    }\n    // Retrieve the universal active quest key.\n    const canPost = StateManager.canPost();\n    this.app.viewManager.setPostButtonEnabled(canPost);\n    console.log(`[QuestManager] Post button ${canPost ? \"enabled\" : \"disabled\"} for quest \"${questKey}\".`);\n  }\n\n  /**\n   * Synchronizes the quest state for predefined quests.\n   */\n  async syncQuestState() {\n    for (const quest of this.quests) {\n      await this.syncQuestStateForQuest(quest.key);\n    }\n  }\n\n  /**\n   * Finds a quest by its key and activates it.\n   * After activation, updates the universal active quest key.\n   * @param {string} key - The quest key.\n   */\n  async activateQuest(key) {\n    const quest = this.quests.find(q => q.key === key);\n    if (!quest) {\n      ErrorManager.logError(`Quest \"${key}\" not found`, \"QuestManager.activateQuest\");\n      ErrorManager.showError(`Cannot activate quest \"${key}\"`);\n      return;\n    }\n    console.log(`[QuestManager] Activating quest: ${key}`);\n    await quest.activate();\n    StateManager.setActiveQuestKey(key);\n    await this.syncQuestState();\n  }\n\n  /**\n   * Finalizes a quest by calling its finish() method and updates the UI.\n   * @param {string} key - The quest key.\n   */\n  async checkQuest(key) {\n    const quest = this.quests.find(q => q.key === key);\n    if (!quest) {\n      ErrorManager.logError(`Quest \"${key}\" not found`, \"QuestManager.checkQuest\");\n      ErrorManager.showError(`Cannot finish quest \"${key}\"`);\n      return;\n    }\n    console.log(`[QuestManager] Finishing quest: ${key}`);\n    await quest.finish();\n    await this.syncQuestState();\n  }\n\n  /**\n   * Saves the quest progress to the database.\n   * @param {string} questKey - The quest key.\n   * @param {number} currentStage - The current stage.\n   * @param {number} totalStages - The total number of stages.\n   * @param {string} status - The quest status.\n   */\n  async updateQuestProgress(questKey, currentStage, totalStages, status) {\n    const questData = {\n      quest_key:    questKey,\n      current_stage: currentStage,\n      total_stages: totalStages,\n      status\n    };\n    await this.app.databaseManager.saveQuestRecord(questData);\n    console.log(\"[QuestManager] Quest progress updated:\", questData);\n  }\n\n  /**\n   * Restores the UI for the repeating quest.\n   */\n  restoreRepeatingQuestUI() {\n    const repeatingQuest = this.quests.find(q => q.key === \"repeating_quest\");\n    if (repeatingQuest && typeof repeatingQuest.restoreUI === \"function\") {\n      console.log(\"[QuestManager] Restoring repeating quest UI...\");\n      repeatingQuest.restoreUI();\n    }\n  }\n\n  /**\n   * Re-initializes UI for all active quests.\n   * For each quest, if a corresponding database record exists with active status,\n   * the quest's restoreUI method is called to reinitialize its UI.\n   */\n  restoreAllActiveQuests() {\n    console.log(\"[QuestManager] Attempting to restore UI for all active quests...\");\n    this.quests.forEach(quest => {\n      const record = this.app.databaseManager.getQuestRecord(quest.key);\n      if (\n        record &&\n        (record.status === \"active\" || (record.status === \"finished\" && quest.currentStage <= quest.totalStages)) &&\n        !quest.finished\n      ) {\n        console.log(`[QuestManager] Found active quest \"${quest.key}\". Restoring UI...`);\n        if (typeof quest.restoreUI === \"function\") {\n          quest.restoreUI();\n        } else {\n          console.log(`[QuestManager] Quest \"${quest.key}\" does not implement restoreUI().`);\n        }\n      }\n    });\n    // Update the Post button state after UI restoration\n    if (this.app.ghostManager && typeof this.app.ghostManager.updatePostButtonState === 'function') {\n      this.app.ghostManager.updatePostButtonState();\n    }\n  }\n}","export class SQLiteDataManager {\n  /**\n   * Constructor for SQLiteDataManager.\n   * @param {Object} options - Configuration options.\n   *   - dbName: Name of the IndexedDB database (default: 'sqliteDB').\n   *   - storeName: Name of the object store (default: 'dbStore').\n   *   - key: Key under which the database is stored (default: 'sqlite').\n   */\n  constructor(options = {}) {\n    this.dbName = options.dbName || 'sqliteDB';\n    this.storeName = options.storeName || 'dbStore';\n    this.key = options.key || 'sqlite';\n  }\n\n  /**\n   * openDB – Opens (or creates) the IndexedDB database.\n   * @returns {Promise<IDBDatabase>} Resolves with the opened database instance.\n   */\n  openDB() {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, 1);\n      request.onerror = event => {\n        console.error(\"Error opening IndexedDB:\", event.target.error);\n        reject(event.target.error);\n      };\n      request.onupgradeneeded = event => {\n        const db = event.target.result;\n        if (!db.objectStoreNames.contains(this.storeName)) {\n          db.createObjectStore(this.storeName);\n        }\n      };\n      request.onsuccess = event => {\n        resolve(event.target.result);\n      };\n    });\n  }\n\n  /**\n   * initDatabase – Initializes the SQL.js database.\n   * If saved database data is found in IndexedDB, restores it.\n   * Otherwise, creates a new database instance.\n   *\n   * After restoration or creation, migration queries are executed\n   * to ensure that all required tables (diary, apartment_plan, quest_progress,\n   * ghosts, events, quests, chat_messages) exist.\n   *\n   * @param {Object} SQL - The SQL.js module.\n   * @returns {Promise<SQL.Database>} Resolves to the SQL.js database instance.\n   */\n  async initDatabase(SQL) {\n    const savedDbBase64 = await this.loadDatabase();\n    let dbInstance;\n    if (savedDbBase64) {\n      // Restore database from saved base64 data.\n      const binaryStr = atob(savedDbBase64);\n      const binaryData = new Uint8Array(binaryStr.length);\n      for (let i = 0; i < binaryStr.length; i++) {\n        binaryData[i] = binaryStr.charCodeAt(i);\n      }\n      dbInstance = new SQL.Database(binaryData);\n      console.log(\"Database restored from IndexedDB.\");\n    } else {\n      // Create a new database instance.\n      dbInstance = new SQL.Database();\n      console.log(\"New database instance created.\");\n    }\n    \n    // Run migration queries to ensure all required tables exist.\n    this.migrateDatabase(dbInstance);\n    \n    if (!savedDbBase64) {\n      console.log(\"New database created and tables initialized.\");\n    } else {\n      console.log(\"Database migration complete.\");\n    }\n    return dbInstance;\n  }\n\n  /**\n   * migrateDatabase – Runs migration queries to update the database schema.\n   * Ensures that all required tables exist.\n   *\n   * @param {SQL.Database} dbInstance - The SQL.js database instance.\n   */\n  migrateDatabase(dbInstance) {\n    dbInstance.run(`\n      CREATE TABLE IF NOT EXISTS diary (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        entry TEXT,\n        timestamp TEXT\n      );\n      CREATE TABLE IF NOT EXISTS apartment_plan (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        floor_number INTEGER,\n        room_data TEXT\n      );\n      CREATE TABLE IF NOT EXISTS quest_progress (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        quest_key TEXT,\n        status TEXT\n      );\n      CREATE TABLE IF NOT EXISTS ghosts (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT,\n        status TEXT,\n        progress INTEGER\n      );\n      CREATE TABLE IF NOT EXISTS events (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        event_key TEXT,\n        event_text TEXT,\n        timestamp TEXT,\n        completed INTEGER\n      );\n      CREATE TABLE IF NOT EXISTS quests (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        quest_key TEXT,\n        status TEXT,\n        current_stage INTEGER,\n        total_stages INTEGER\n      );\n      CREATE TABLE IF NOT EXISTS chat_messages (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        sender TEXT,\n        message TEXT,\n        timestamp TEXT\n      );\n    `);\n  }\n\n  /**\n   * saveDatabase – Exports the database to a base64 string and persists it via IndexedDB.\n   *\n   * @param {string} base64Data - The base64-encoded database data.\n   * @returns {Promise<void>} Resolves when saving is complete.\n   */\n  async saveDatabase(base64Data) {\n    const db = await this.openDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction([this.storeName], \"readwrite\");\n      transaction.oncomplete = () => {\n        console.log(\"Database saved successfully in IndexedDB.\");\n        resolve();\n      };\n      transaction.onerror = event => {\n        console.error(\"Transaction error during saveDatabase:\", event.target.error);\n        reject(event.target.error);\n      };\n      const store = transaction.objectStore(this.storeName);\n      const putRequest = store.put(base64Data, this.key);\n      putRequest.onerror = event => {\n        console.error(\"Error saving database data:\", event.target.error);\n        reject(event.target.error);\n      };\n    });\n  }\n\n  /**\n   * loadDatabase – Loads the database data from IndexedDB.\n   *\n   * @returns {Promise<string>} Resolves to the base64 string representing the database, or undefined if not found.\n   */\n  async loadDatabase() {\n    const db = await this.openDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction([this.storeName], \"readonly\");\n      transaction.onerror = event => {\n        console.error(\"Transaction error during loadDatabase:\", event.target.error);\n        reject(event.target.error);\n      };\n      const store = transaction.objectStore(this.storeName);\n      const getRequest = store.get(this.key);\n      getRequest.onsuccess = event => {\n        console.log(\"Database loaded successfully from IndexedDB.\");\n        resolve(event.target.result);\n      };\n      getRequest.onerror = event => {\n        console.error(\"Error loading database data:\", event.target.error);\n        reject(event.target.error);\n      };\n    });\n  }\n\n  /**\n   * resetDatabase – Deletes the saved SQL database data (base64 string) from IndexedDB.\n   *\n   * @returns {Promise<void>} Resolves when the database data is successfully deleted.\n   */\n  async resetDatabase() {\n    const db = await this.openDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction([this.storeName], \"readwrite\");\n      transaction.oncomplete = () => {\n        console.log(\"SQL database reset successfully in IndexedDB.\");\n        resolve();\n      };\n      transaction.onerror = event => {\n        console.error(\"Transaction error during resetDatabase:\", event.target.error);\n        reject(event.target.error);\n      };\n      const store = transaction.objectStore(this.storeName);\n      const deleteRequest = store.delete(this.key);\n      deleteRequest.onerror = event => {\n        console.error(\"Error deleting SQL database data:\", event.target.error);\n        reject(event.target.error);\n      };\n    });\n  }\n\n  /**\n   * saveProfile – Saves the profile data to IndexedDB.\n   *\n   * @param {Object} profile - The profile object to be saved.\n   * @returns {Promise<void>}\n   */\n  async saveProfile(profile) {\n    const profileKey = 'profile';\n    const db = await this.openDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction([this.storeName], \"readwrite\");\n      transaction.oncomplete = () => {\n        console.log(\"Profile saved successfully in IndexedDB.\");\n        resolve();\n      };\n      transaction.onerror = event => {\n        console.error(\"Transaction error during saveProfile:\", event.target.error);\n        reject(event.target.error);\n      };\n      const store = transaction.objectStore(this.storeName);\n      const putRequest = store.put(JSON.stringify(profile), profileKey);\n      putRequest.onerror = event => {\n        console.error(\"Error saving profile data:\", event.target.error);\n        reject(event.target.error);\n      };\n    });\n  }\n\n  /**\n   * getProfile – Loads the profile data from IndexedDB.\n   *\n   * @returns {Promise<Object|null>} Resolves to the profile object or null if not found.\n   */\n  async getProfile() {\n    const profileKey = 'profile';\n    const db = await this.openDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction([this.storeName], \"readonly\");\n      transaction.onerror = event => {\n        console.error(\"Transaction error during getProfile:\", event.target.error);\n        reject(event.target.error);\n      };\n      const store = transaction.objectStore(this.storeName);\n      const getRequest = store.get(profileKey);\n      getRequest.onsuccess = event => {\n        const result = event.target.result;\n        if (result) {\n          resolve(JSON.parse(result));\n        } else {\n          resolve(null);\n        }\n      };\n      getRequest.onerror = event => {\n        console.error(\"Error loading profile data:\", event.target.error);\n        reject(event.target.error);\n      };\n    });\n  }\n\n  /**\n   * resetProfile – Deletes the profile data from IndexedDB.\n   *\n   * @returns {Promise<void>} Resolves when the profile is successfully reset.\n   */\n  async resetProfile() {\n    const profileKey = 'profile';\n    const db = await this.openDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction([this.storeName], \"readwrite\");\n      transaction.oncomplete = () => {\n        console.log(\"Profile reset successfully in IndexedDB.\");\n        resolve();\n      };\n      transaction.onerror = event => {\n        console.error(\"Transaction error during resetProfile:\", event.target.error);\n        reject(event.target.error);\n      };\n      const store = transaction.objectStore(this.storeName);\n      const deleteRequest = store.delete(profileKey);\n      deleteRequest.onerror = event => {\n        console.error(\"Error deleting profile:\", event.target.error);\n        reject(event.target.error);\n      };\n    });\n  }\n\n  // Additional methods for ghosts, events, quests can be added here:\n  // async saveGhostProgress(progress) { ... }\n  // async getGhostProgress() { ... }\n  // async saveLocationType(locationType) { ... }\n  // async getLocationType() { ... }\n}","/**\n * Класс ShowProfileModal отвечает за отображение модального окна профиля,\n * где пользователь может редактировать данные своего профиля, включая селфи,\n * логин, просматривать план квартиры и видеть награды (прогресс призраков).\n */\nexport class ShowProfileModal {\n  /**\n   * Конструктор класса.\n   * @param {App} appInstance - Ссылка на главный объект приложения для доступа ко всем менеджерам и данным.\n   */\n  constructor(appInstance) {\n    // Сохраняем ссылку на главный объект приложения.\n    this.app = appInstance;\n  }\n\n  /**\n   * Метод show – открывает модальное окно профиля.\n   * В этом окне отображается текущий профиль, позволяющее пользователю редактировать данные.\n   */\n  show() {\n    // Получаем текущий профиль через менеджер профиля.\n    const profile = this.app.profileManager.getProfile();\n    if (!profile) {\n      alert(\"Профиль не найден.\");\n      return;\n    }\n\n    // Создаем оверлей для модального окна с фиксированным позиционированием и затемненным фоном.\n    const modalOverlay = document.createElement(\"div\");\n    modalOverlay.id = \"profile-modal-overlay\";\n    Object.assign(modalOverlay.style, {\n      position: \"fixed\",\n      top: \"0\",\n      left: \"0\",\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: \"rgba(0,0,0,0.5)\",\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      zIndex: \"2000\",\n      overflowY: \"auto\"\n    });\n\n    // Создаем контейнер модального окна.\n    const modal = document.createElement(\"div\");\n    modal.id = \"profile-modal\";\n    Object.assign(modal.style, {\n      backgroundColor: \"#fff\",\n      padding: \"20px\",\n      borderRadius: \"8px\",\n      width: \"90%\",\n      maxWidth: \"500px\",\n      maxHeight: \"90%\",\n      overflowY: \"auto\",\n      boxShadow: \"0 0 10px rgba(0,0,0,0.3)\"\n    });\n\n    // Заголовок модального окна.\n    const title = document.createElement(\"h2\");\n    title.textContent = \"Редактирование профиля\";\n    modal.appendChild(title);\n\n    // Блок для отображения аватара (селфи).\n    const avatarContainer = document.createElement(\"div\");\n    avatarContainer.style.textAlign = \"center\";\n\n    // Создаем элемент изображения для аватара.\n    const avatarImg = document.createElement(\"img\");\n    avatarImg.id = \"profile-modal-avatar\";\n    avatarImg.src = profile.selfie;\n    avatarImg.alt = \"Аватар\";\n    Object.assign(avatarImg.style, {\n      width: \"100px\",\n      height: \"100px\",\n      borderRadius: \"50%\"\n    });\n    avatarContainer.appendChild(avatarImg);\n\n    // Кнопка для обновления селфи.\n    const updateSelfieBtn = document.createElement(\"button\");\n    updateSelfieBtn.textContent = \"Обновить селфи\";\n    updateSelfieBtn.style.marginTop = \"10px\";\n    updateSelfieBtn.addEventListener(\"click\", () => {\n      // Открываем отдельное модальное окно для редактирования селфи.\n      this.showSelfieEditModal((newSelfieSrc) => {\n        // После успешного захвата селфи обновляем аватар.\n        avatarImg.src = newSelfieSrc;\n      });\n    });\n    avatarContainer.appendChild(updateSelfieBtn);\n    modal.appendChild(avatarContainer);\n\n    // Поле для редактирования логина.\n    const loginLabel = document.createElement(\"label\");\n    loginLabel.textContent = \"Логин:\";\n    loginLabel.style.display = \"block\";\n    loginLabel.style.marginTop = \"15px\";\n    modal.appendChild(loginLabel);\n\n    const loginInput = document.createElement(\"input\");\n    loginInput.type = \"text\";\n    loginInput.value = profile.name;\n    loginInput.style.width = \"100%\";\n    loginInput.style.marginBottom = \"15px\";\n    modal.appendChild(loginInput);\n\n    // Блок для отображения плана квартиры.\n    const planContainer = document.createElement(\"div\");\n    planContainer.id = \"profile-plan-container\";\n    planContainer.style.border = \"1px solid #ccc\";\n    planContainer.style.padding = \"10px\";\n    planContainer.style.marginBottom = \"15px\";\n    // Если менеджер плана квартиры существует, пытаемся отобразить план.\n    if (this.app.apartmentPlanManager) {\n      // Если таблица еще не создана, пытаемся её создать.\n      if (!this.app.apartmentPlanManager.table) {\n        this.app.apartmentPlanManager.createTable();\n      }\n      // Если таблица успешно создана, клонируем ее для отображения.\n      if (this.app.apartmentPlanManager.table) {\n        const planClone = this.app.apartmentPlanManager.table.cloneNode(true);\n        planContainer.appendChild(planClone);\n        // Если существует несколько этажей, добавляем кнопки переключения этажей.\n        const floors = this.app.apartmentPlanManager.rooms.map(room => room.floor);\n        const uniqueFloors = [...new Set(floors)];\n        if (uniqueFloors.length > 1) {\n          const floorControls = document.createElement(\"div\");\n          floorControls.style.textAlign = \"center\";\n          floorControls.style.marginTop = \"10px\";\n\n          const prevFloorBtn = document.createElement(\"button\");\n          prevFloorBtn.textContent = \"Предыдущий этаж\";\n          prevFloorBtn.addEventListener(\"click\", () => {\n            this.app.apartmentPlanManager.prevFloor();\n            planContainer.innerHTML = \"\";\n            if (this.app.apartmentPlanManager.table) {\n              const newPlan = this.app.apartmentPlanManager.table.cloneNode(true);\n              planContainer.appendChild(newPlan);\n            } else {\n              planContainer.textContent = \"План квартиры отсутствует.\";\n            }\n          });\n\n          const nextFloorBtn = document.createElement(\"button\");\n          nextFloorBtn.textContent = \"Следующий этаж\";\n          nextFloorBtn.style.marginLeft = \"10px\";\n          nextFloorBtn.addEventListener(\"click\", () => {\n            this.app.apartmentPlanManager.nextFloor();\n            planContainer.innerHTML = \"\";\n            if (this.app.apartmentPlanManager.table) {\n              const newPlan = this.app.apartmentPlanManager.table.cloneNode(true);\n              planContainer.appendChild(newPlan);\n            } else {\n              planContainer.textContent = \"План квартиры отсутствует.\";\n            }\n          });\n\n          floorControls.appendChild(prevFloorBtn);\n          floorControls.appendChild(nextFloorBtn);\n          planContainer.appendChild(floorControls);\n        }\n      } else {\n        planContainer.textContent = \"План квартиры отсутствует.\";\n      }\n    } else {\n      planContainer.textContent = \"План квартиры отсутствует.\";\n    }\n    modal.appendChild(planContainer);\n\n    // Информационная надпись.\n    const note = document.createElement(\"p\");\n    note.textContent = \"Переехать и начать с чистого листа - это иногда помогает избавиться от привидений, но не всегда.\";\n    note.style.fontStyle = \"italic\";\n    modal.appendChild(note);\n\n    // Блок для отображения наград (прогресс призраков).\n    const rewardsContainer = document.createElement(\"div\");\n    rewardsContainer.id = \"ghost-rewards-container\";\n    Object.assign(rewardsContainer.style, {\n      display: \"flex\",\n      flexWrap: \"wrap\",\n      justifyContent: \"center\",\n      marginTop: \"20px\"\n    });\n    // Получаем список призраков из менеджера призраков.\n    const ghostList = (this.app.ghostManager && this.app.ghostManager.ghosts) || [];\n    ghostList.forEach(ghost => {\n      const ghostIcon = document.createElement(\"div\");\n      ghostIcon.className = \"ghost-icon\";\n      Object.assign(ghostIcon.style, {\n        width: \"60px\",\n        height: \"60px\",\n        borderRadius: \"50%\",\n        border: \"2px solid #ccc\",\n        margin: \"5px\",\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        fontSize: \"12px\",\n        fontWeight: \"bold\",\n        position: \"relative\"\n      });\n      // Получаем прогресс призрака из менеджера профиля.\n      const ghostProgress = this.app.profileManager.getGhostProgress();\n      if (ghostProgress && ghostProgress.ghostId === ghost.id) {\n        // Если призрак активен, отображаем текущий шаг и общее количество шагов.\n        ghostIcon.textContent = `${ghostProgress.phenomenonIndex}/${ghost.phenomenaCount}`;\n        ghostIcon.style.borderColor = \"#4caf50\"; // Зеленая рамка для активного призрака.\n      } else {\n        // Для остальных призраков отображаем имя с эффектом серой гаммы.\n        ghostIcon.textContent = ghost.name;\n        ghostIcon.style.filter = \"grayscale(100%)\";\n      }\n      rewardsContainer.appendChild(ghostIcon);\n    });\n    modal.appendChild(rewardsContainer);\n\n    // Контейнер для кнопок \"Отмена\" и \"Сохранить изменения\".\n    const btnContainer = document.createElement(\"div\");\n    btnContainer.style.textAlign = \"right\";\n    btnContainer.style.marginTop = \"20px\";\n\n    // Кнопка \"Отмена\" закрывает модальное окно.\n    const cancelBtn = document.createElement(\"button\");\n    cancelBtn.textContent = \"Отмена\";\n    cancelBtn.style.marginRight = \"10px\";\n    cancelBtn.addEventListener(\"click\", () => {\n      document.body.removeChild(modalOverlay);\n    });\n    btnContainer.appendChild(cancelBtn);\n\n    // Кнопка \"Сохранить изменения\" обновляет профиль с новыми данными и закрывает окно.\n    const saveBtn = document.createElement(\"button\");\n    saveBtn.textContent = \"Сохранить изменения\";\n    saveBtn.addEventListener(\"click\", () => {\n      // Обновляем профиль, объединяя старые данные с новыми (логин и селфи).\n      const updatedProfile = Object.assign({}, profile, {\n        name: loginInput.value,\n        selfie: avatarImg.src\n      });\n      this.app.profileManager.saveProfile(updatedProfile);\n      // Обновляем мини-профиль в основном интерфейсе.\n      this.app.profileNameElem.textContent = updatedProfile.name;\n      this.app.profilePhotoElem.src = updatedProfile.selfie;\n      document.body.removeChild(modalOverlay);\n    });\n    btnContainer.appendChild(saveBtn);\n    modal.appendChild(btnContainer);\n\n    // Добавляем контейнер модального окна в оверлей и помещаем его в body.\n    modalOverlay.appendChild(modal);\n    document.body.appendChild(modalOverlay);\n  }\n\n  /**\n   * Метод showSelfieEditModal – открывает отдельное модальное окно для редактирования селфи.\n   * После захвата нового селфи вызывается переданный колбэк для обновления аватара.\n   * @param {Function} onSelfieCaptured - функция, вызываемая с новым селфи (dataURL) после его захвата.\n   */\n  showSelfieEditModal(onSelfieCaptured) {\n    // Создаем оверлей для модального окна редактирования селфи.\n    const selfieOverlay = document.createElement(\"div\");\n    selfieOverlay.id = \"selfie-edit-overlay\";\n    Object.assign(selfieOverlay.style, {\n      position: \"fixed\",\n      top: \"0\",\n      left: \"0\",\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: \"rgba(0,0,0,0.7)\",\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      zIndex: \"2100\",\n      overflowY: \"auto\"\n    });\n\n    // Контейнер для модального окна редактирования селфи.\n    const selfieModal = document.createElement(\"div\");\n    selfieModal.id = \"selfie-edit-modal\";\n    Object.assign(selfieModal.style, {\n      backgroundColor: \"#fff\",\n      padding: \"20px\",\n      borderRadius: \"8px\",\n      width: \"90%\",\n      maxWidth: \"400px\",\n      maxHeight: \"90%\",\n      overflowY: \"auto\",\n      boxShadow: \"0 0 10px rgba(0,0,0,0.3)\"\n    });\n\n    // Заголовок модального окна редактирования селфи.\n    const title = document.createElement(\"h3\");\n    title.textContent = \"Редактирование селфи\";\n    selfieModal.appendChild(title);\n\n    // Контейнер для видео, где будет отображаться видеопоток с камеры.\n    const videoContainer = document.createElement(\"div\");\n    videoContainer.id = \"selfie-video-container\";\n    Object.assign(videoContainer.style, {\n      width: \"100%\",\n      maxWidth: \"400px\",\n      margin: \"10px auto\"\n    });\n    selfieModal.appendChild(videoContainer);\n\n    // Прикрепляем видео к контейнеру с заданными опциями (например, с фильтром).\n    this.app.cameraSectionManager.attachTo(\"selfie-video-container\", {\n      width: \"100%\",\n      maxWidth: \"400px\",\n      filter: \"grayscale(100%)\"\n    });\n    // Запускаем камеру.\n    this.app.cameraSectionManager.startCamera();\n\n    // Кнопка для захвата селфи.\n    const captureBtn = document.createElement(\"button\");\n    captureBtn.textContent = \"Сделать селфи\";\n    captureBtn.style.display = \"block\";\n    captureBtn.style.margin = \"10px auto\";\n    captureBtn.addEventListener(\"click\", () => {\n      // Проверяем, активна ли камера.\n      if (!this.app.cameraSectionManager.videoElement ||\n          !this.app.cameraSectionManager.videoElement.srcObject) {\n        alert(\"Камера не включена.\");\n        return;\n      }\n      const video = this.app.cameraSectionManager.videoElement;\n      const canvas = document.createElement('canvas');\n      canvas.width = video.videoWidth || 640;\n      canvas.height = video.videoHeight || 480;\n      const ctx = canvas.getContext('2d');\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      // Преобразуем изображение в оттенки серого.\n      const selfieData = window.ImageUtils ? window.ImageUtils.convertToGrayscale(canvas) : canvas.toDataURL();\n      // Останавливаем камеру.\n      this.app.cameraSectionManager.stopCamera();\n      // Закрываем окно редактирования селфи.\n      document.body.removeChild(selfieOverlay);\n      // Вызываем колбэк для обновления аватара.\n      if (onSelfieCaptured) onSelfieCaptured(selfieData);\n    });\n    selfieModal.appendChild(captureBtn);\n\n    // Кнопка для отмены редактирования селфи.\n    const cancelBtn = document.createElement(\"button\");\n    cancelBtn.textContent = \"Отмена\";\n    cancelBtn.style.display = \"block\";\n    cancelBtn.style.margin = \"10px auto\";\n    cancelBtn.addEventListener(\"click\", () => {\n      // Останавливаем камеру и закрываем окно редактирования селфи.\n      this.app.cameraSectionManager.stopCamera();\n      document.body.removeChild(selfieOverlay);\n    });\n    selfieModal.appendChild(cancelBtn);\n\n    selfieOverlay.appendChild(selfieModal);\n    document.body.appendChild(selfieOverlay);\n  }\n}","import { ErrorManager } from './ErrorManager.js';\nimport StateKeys from '../config/stateKeys.js';\n\n/**\n * StateManager\n *\n * Centralized module for managing application state.\n * Provides static methods to get, set, and remove values from localStorage.\n * All parts of the application should use these methods to access or modify state.\n *\n * Note: Values are stored as strings, so for objects or arrays use JSON.stringify() before setting,\n * and JSON.parse() when retrieving.\n */\nexport class StateManager {\n  // Load all state-keys from external JS module\n  static KEYS = StateKeys;\n\n  /**\n   * Retrieves the value associated with the specified key from localStorage.\n   *\n   * @param {string} key - The key to retrieve.\n   * @returns {string|null} The stored value as a string, or null if not found or on error.\n   */\n  static get(key) {\n    try {\n      return localStorage.getItem(key);\n    } catch (error) {\n      ErrorManager.logError(`StateManager.get error for key \"${key}\": ${error}`, \"StateManager.get\");\n      return null;\n    }\n  }\n\n  /**\n   * Stores the given value in localStorage under the specified key.\n   *\n   * @param {string} key - The key under which to store the value.\n   * @param {string} value - The value to store (should be a string; use JSON.stringify() if needed).\n   */\n  static set(key, value) {\n    try {\n      localStorage.setItem(key, value);\n    } catch (error) {\n      ErrorManager.logError(`StateManager.set error for key \"${key}\": ${error}`, \"StateManager.set\");\n    }\n  }\n\n  /**\n   * Removes the item with the specified key from localStorage.\n   *\n   * @param {string} key - The key of the item to remove.\n   */\n  static remove(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (error) {\n      ErrorManager.logError(`StateManager.remove error for key \"${key}\": ${error}`, \"StateManager.remove\");\n    }\n  }\n\n  /**\n   * Mark camera as open or closed.\n   * @param {boolean} isOpen\n   */\n  static setCameraOpen(isOpen) {\n    StateManager.set(StateManager.KEYS.CAMERA_OPEN, isOpen ? 'true' : 'false');\n  }\n\n  /**\n   * Check whether camera is currently open.\n   * @returns {boolean}\n   */\n  static isCameraOpen() {\n    return StateManager.get(StateManager.KEYS.CAMERA_OPEN) === 'true';\n  }\n\n  /**\n   * Store or clear the active quest key.\n   * @param {string|null} key\n   */\n  static setActiveQuestKey(key) {\n    if (key) {\n      StateManager.set(StateManager.KEYS.ACTIVE_QUEST_KEY, key);\n    } else {\n      StateManager.remove(StateManager.KEYS.ACTIVE_QUEST_KEY);\n    }\n  }\n\n  /**\n   * Retrieve the current active quest key, or null if none.\n   * @returns {string|null}\n   */\n  static getActiveQuestKey() {\n    return StateManager.get(StateManager.KEYS.ACTIVE_QUEST_KEY);\n  }\n\n  /**\n   * Return true if both the camera is open and a quest is active.\n   * @returns {boolean}\n   */\n  static canShoot() {\n    return this.get(StateManager.KEYS.CAMERA_BUTTON_ACTIVE) === \"true\" && !!this.getActiveQuestKey();\n  }\n\n  /**\n   * Return true if no quest is active (i.e. user may press Post).\n   * @returns {boolean}\n   */\n  static canPost() {\n    return !StateManager.getActiveQuestKey();\n  }\n}","import { BASE_PATH } from '../config/paths.js';\nimport { StateManager } from './StateManager.js';\nimport { ErrorManager } from './ErrorManager.js';\nimport { ImageUtils } from '../utils/ImageUtils.js';\nimport { ApartmentPlanManager } from './ApartmentPlanManager.js';\nimport { TemplateEngine } from '../utils/TemplateEngine.js';\n\n/**\n * ViewManager\n *\n * Central UI module responsible for:\n * - Switching screens.\n * - Managing button states.\n * - Updating profile display.\n * - Rendering the diary.\n * - Handling UI effects and notifications.\n *\n * All UI updates and DOM manipulations are centralized here.\n */\nexport class ViewManager {\n  constructor(appInstance) {\n    this.app = appInstance;\n    // --- Cache static UI elements from index.html ---\n    this.loadingOlderPosts = false;\n    this.controlsPanel = document.getElementById(\"controls-panel\");\n    this.languageSelector = document.getElementById('language-selector');\n    this.globalCamera = document.getElementById(\"global-camera\");\n    this.postBtn = document.getElementById(\"post-btn\");\n    this.toggleCameraBtn = document.getElementById(\"toggle-camera\");\n    this.toggleDiaryBtn = document.getElementById(\"toggle-diary\");\n    this.resetDataBtn = document.getElementById(\"reset-data\");\n    this.exportProfileBtn = document.getElementById(\"export-profile-btn\");\n    this.updateBtn = document.getElementById(\"update-btn\");\n    \n    // Initially, we assign the diaryContainer from the hidden placeholder\n    this.diaryContainer = document.getElementById(\"diary\");\n\n    this.cameraManager = null;\n    this.languageManager = null;\n\n    // Disable \"Post\" button initially.\n    if (this.postBtn) {\n      this.postBtn.disabled = true;\n      // Use universal flag storage; initial state is disabled.\n      StateManager.set(StateManager.KEYS.POST_BUTTON_DISABLED, \"true\");\n      console.log(\"[ViewManager] Post button disabled on initialization.\");\n    }\n  }\n\n  setCameraManager(cameraManager) {\n    this.cameraManager = cameraManager;\n    console.log(\"[ViewManager] Camera manager set.\");\n  }\n\n  setLanguageManager(languageManager) {\n    this.languageManager = languageManager;\n  }\n\n  getRegistrationData() {\n    if (!this.nameInput || !this.genderSelect) {\n      return null;\n    }\n    return {\n      name: this.nameInput.value.trim(),\n      gender: this.genderSelect.value.trim(),\n      language: this.languageSelector ? this.languageSelector.value : 'en'\n    };\n  }\n\n  bindEvents(app) {\n    if (this.languageSelector) {\n      this.languageSelector.addEventListener('change', () => {\n        console.log(\"Language select changed:\", this.languageSelector.value);\n      });\n    }\n    if (this.toggleCameraBtn) {\n      this.toggleCameraBtn.addEventListener(\"click\", () => {\n        this.toggleCameraView(app);\n      });\n    }\n    if (this.toggleDiaryBtn) {\n      this.toggleDiaryBtn.addEventListener(\"click\", () => {\n        this.toggleCameraView(app);\n      });\n    }\n    if (this.resetDataBtn) {\n      this.resetDataBtn.addEventListener(\"click\", () => {\n        console.log(\"Reset Data button clicked.\");\n        app.profileManager.resetProfile();\n      });\n    }\n    if (this.exportProfileBtn) {\n      this.exportProfileBtn.addEventListener(\"click\", () => {\n        console.log(\"Export Profile button clicked.\");\n        this.exportProfile(app);\n      });\n    }\n    if (this.updateBtn) {\n      this.updateBtn.addEventListener(\"click\", () => {\n        console.log(\"Update button clicked.\");\n        this.clearCache();\n      });\n    }\n    const chatBtn = document.getElementById(\"chat-btn\");\n    if (chatBtn) {\n      chatBtn.addEventListener(\"click\", () => {\n        console.log(\"Chat button clicked. Triggering toggleChat().\");\n        this.toggleChat(app);\n      });\n    } else {\n      console.error(\"Chat button (id='chat-btn') not found in the DOM.\");\n    }\n\n    // >>> Add missing event listener for the Post button.\n    if (this.postBtn) {\n      this.postBtn.addEventListener(\"click\", () => {\n        console.log(\"Post button clicked. Delegating to ghostManager.handlePostButtonClick()...\");\n        app.ghostManager.handlePostButtonClick();\n      });\n    } else {\n      console.error(\"Post button (id='post-btn') not found in the DOM.\");\n    }\n  }\n\n  // ------------------ Dynamic Template Loading Methods ------------------\n\n  async loadTemplate(screenId, data = {}) {\n    const templateUrl = `${BASE_PATH}/src/templates/${screenId}_template.html`;\n    try {\n      const response = await fetch(templateUrl);\n      if (!response.ok) {\n        throw new Error(`Failed to load template: ${templateUrl}`);\n      }\n      const templateText = await response.text();\n      const renderedHTML = TemplateEngine.render(templateText, data);\n      const container = document.getElementById(\"global-content\");\n      if (container) {\n        container.innerHTML += renderedHTML;\n        const newScreen = container.lastElementChild;\n        console.log(`[ViewManager] Loaded template for screen: ${screenId}`);\n        if (this.languageManager && typeof this.languageManager.updateContainerLanguage === 'function') {\n          this.languageManager.updateContainerLanguage(newScreen);\n        }\n        // APPLY VISUAL EFFECTS TO NEW ELEMENTS IN THE LOADED SCREEN\n        if (this.app && this.app.visualEffectsManager && typeof this.app.visualEffectsManager.applyEffectsToNewElements === 'function') {\n          const newElements = newScreen.querySelectorAll(\"[data-animate-on-board='true']\");\n          this.app.visualEffectsManager.applyEffectsToNewElements(newElements);\n        }\n        return newScreen;\n      } else {\n        throw new Error(\"Global content container (id='global-content') not found.\");\n      }\n    } catch (error) {\n      ErrorManager.logError(error, \"loadTemplate\");\n      return null;\n    }\n  }\n\n  /**\n   * switchScreen\n   * Switches the UI to the target screen. If the screen element does not exist,\n   * it dynamically loads the template from the templates folder.\n   * Also re-binds dynamic event handlers for newly loaded screens\n   * and toggles the global language selector (on landing only).\n   *\n   * @param {string} screenId - The id of the target screen.\n   * @param {string} buttonsGroupId - The id of the control button group to display.\n   * @param {App} [app] - The main application instance (if needed for event callbacks).\n   */\n  async switchScreen(screenId, buttonsGroupId, app) {\n    // Hide all sections\n    document.querySelectorAll('section').forEach(section => {\n      section.style.display = 'none';\n    });\n    let targetScreen = document.getElementById(screenId);\n    if (!targetScreen) {\n      // If not found, load the template dynamically.\n      targetScreen = await this.loadTemplate(screenId, {});\n      if (!targetScreen) {\n        console.error(`[ViewManager] Failed to load screen: ${screenId}`);\n        return;\n      }\n    }\n    targetScreen.style.display = 'block';\n    console.log(`[ViewManager] Switched to screen: ${screenId}`);\n\n    // APPLY VISUAL EFFECTS TO NEW ELEMENTS IN THE SWITCHED SCREEN\n    if (this.app && this.app.visualEffectsManager && typeof this.app.visualEffectsManager.applyEffectsToNewElements === 'function') {\n      const newElements = targetScreen.querySelectorAll(\"[data-animate-on-board='true']\");\n      this.app.visualEffectsManager.applyEffectsToNewElements(newElements);\n    }\n\n    // If main-screen, update diaryContainer to the newly loaded #diary\n    if (screenId === \"main-screen\") {\n      const diaryElem = targetScreen.querySelector('#diary');\n      if (diaryElem) {\n        this.diaryContainer = diaryElem;\n        console.log(\"[ViewManager] Updated diary container for main-screen.\");\n        await this.loadLatestDiaryPosts();\n        // подгружаем старые посты при приближении к низу страницы\n        window.addEventListener(\n          \"scroll\",\n          this.onScrollLoadOlder.bind(this),\n          { passive: true }\n        );\n      }\n    }\n\n    // If landing-screen, bind the start-registration button\n    if (screenId === \"landing-screen\") {\n      const startRegistrationBtn = targetScreen.querySelector('#start-registration-btn');\n      if (startRegistrationBtn) {\n        startRegistrationBtn.addEventListener('click', () => {\n          this.switchScreen('registration-screen', 'registration-buttons', app);\n          console.log(\"[ViewManager] Start registration button clicked, switching to registration screen.\");\n        });\n      }\n    }\n\n    // If registration-screen, re-assign dynamic fields and event handlers\n    if (screenId === \"registration-screen\") {\n      this.nameInput = targetScreen.querySelector('#player-name');\n      this.genderSelect = targetScreen.querySelector('#player-gender');\n      this.nextStepBtn = targetScreen.querySelector('#next-step-btn');\n\n      const checkRegistrationValidity = () => {\n        const nameValid = this.nameInput && this.nameInput.value.trim().length > 0;\n        const genderValid = this.genderSelect && this.genderSelect.value !== \"\";\n        if (this.nextStepBtn) {\n          this.nextStepBtn.disabled = !(nameValid && genderValid);\n        }\n      };\n      if (this.nameInput) {\n        this.nameInput.addEventListener('input', () => {\n          console.log(\"Name input changed:\", this.nameInput.value);\n          checkRegistrationValidity();\n        });\n      }\n      if (this.genderSelect) {\n        this.genderSelect.addEventListener('change', () => {\n          console.log(\"Gender select changed:\", this.genderSelect.value);\n          checkRegistrationValidity();\n        });\n      }\n      if (this.nextStepBtn) {\n        this.nextStepBtn.addEventListener('click', async () => {\n          await this.goToApartmentPlanScreen(app);\n          console.log(\"[ViewManager] Registration next button clicked. Moving to apartment plan screen.\");\n        });\n      }\n    }\n\n    // If selfie-screen: the capture and complete buttons are static in index.html\n    if (screenId === \"selfie-screen\") {\n      const captureBtn = document.getElementById('capture-btn');\n      if (captureBtn) {\n        captureBtn.onclick = () => {\n          console.log(\"Capture button clicked. Capturing selfie...\");\n          this.captureSelfie(app);\n        };\n      } else {\n        console.error(\"Capture button (id='capture-btn') not found in the DOM.\");\n      }\n      const completeBtn = document.getElementById('complete-registration');\n      if (completeBtn) {\n        completeBtn.onclick = () => {\n          console.log(\"Complete registration button clicked.\");\n          this.completeRegistration(app);\n        };\n      } else {\n        console.error(\"Complete registration button (id='complete-registration') not found in the DOM.\");\n      }\n    }\n\n    // If apartment-plan-screen\n    if (screenId === \"apartment-plan-screen\" && app) {\n      const prevFloorBtn = document.getElementById(\"prev-floor-btn\");\n      if (prevFloorBtn) {\n        prevFloorBtn.addEventListener(\"click\", () => {\n          if (app.apartmentPlanManager) {\n            app.apartmentPlanManager.prevFloor();\n          }\n        });\n      }\n      const nextFloorBtn = document.getElementById(\"next-floor-btn\");\n      if (nextFloorBtn) {\n        nextFloorBtn.addEventListener(\"click\", () => {\n          if (app.apartmentPlanManager) {\n            app.apartmentPlanManager.nextFloor();\n          }\n        });\n      }\n      const planNextBtn = targetScreen.querySelector('#apartment-plan-next-btn');\n      if (planNextBtn) {\n        planNextBtn.addEventListener('click', () => {\n          console.log(\"Apartment Plan next button clicked. Going to selfie screen.\");\n          this.goToSelfieScreen(app);\n        });\n      }\n    }\n\n    // Hide all groups in the controls panel, then show the relevant group\n    document.querySelectorAll('#controls-panel > .buttons').forEach(group => {\n      group.style.display = 'none';\n      group.style.pointerEvents = 'none';\n    });\n    if (buttonsGroupId) {\n      const targetGroup = document.getElementById(buttonsGroupId);\n      if (targetGroup) {\n        targetGroup.style.display = 'flex';\n        targetGroup.style.pointerEvents = 'auto';\n        // On main-screen, hide toggle-diary and btn_shoot to avoid confusion\n        if (screenId === \"main-screen\") {\n          const td = targetGroup.querySelector(\"#toggle-diary\");\n          if (td) td.style.display = \"none\";\n          const shootBtn = targetGroup.querySelector(\"#btn_shoot\");\n          if (shootBtn) shootBtn.style.display = \"none\";\n        }\n        console.log(`[ViewManager] Controls panel updated for group: ${buttonsGroupId}`);\n      }\n    }\n\n    // Make the chat button visible\n    const chatContainer = document.getElementById(\"chat-button-container\");\n    if (chatContainer) {\n      chatContainer.style.display = 'flex';\n      chatContainer.style.pointerEvents = 'auto';\n      console.log(\"[ViewManager] Chat button container set to visible.\");\n    }\n\n    // Show/hide the global language container depending on the screen\n    const languageContainer = document.getElementById(\"language-container\");\n    if (languageContainer) {\n      if (screenId === \"landing-screen\") {\n        languageContainer.style.display = \"block\";\n      } else {\n        languageContainer.style.display = \"none\";\n      }\n    }\n  }\n\n  showToggleCameraButton() {\n    if (this.toggleCameraBtn) {\n      this.toggleCameraBtn.style.display = 'inline-block';\n      console.log(\"[ViewManager] Toggle Camera button shown.\");\n    }\n  }\n\n  updateProfileDisplay(profile) {\n    const profileNameElem = document.getElementById('profile-name');\n    const profilePhotoElem = document.getElementById('profile-photo');\n    if (profileNameElem) {\n      profileNameElem.textContent = profile.name;\n    }\n    if (profilePhotoElem) {\n      profilePhotoElem.src = profile.selfie;\n      profilePhotoElem.style.display = 'block';\n    }\n    console.log(\"[ViewManager] Profile display updated.\");\n  }\n\n  updateSelfiePreview(imageData) {\n    const selfiePreview = document.getElementById('selfie-thumbnail');\n    if (selfiePreview) {\n      selfiePreview.src = imageData;\n      selfiePreview.style.display = 'block';\n      console.log(\"[ViewManager] Selfie preview updated.\");\n    } else {\n      ErrorManager.logError(\"Selfie preview element not found.\", \"updateSelfiePreview\");\n    }\n  }\n\n  enableCompleteButton() {\n    const completeBtn = document.getElementById('complete-registration');\n    if (completeBtn) {\n      completeBtn.disabled = false;\n      console.log(\"[ViewManager] Complete button enabled.\");\n    }\n  }\n\n  disableCompleteButton() {\n    const completeBtn = document.getElementById('complete-registration');\n    if (completeBtn) {\n      completeBtn.disabled = true;\n      console.log(\"[ViewManager] Complete button disabled.\");\n    }\n  }\n\n  getSelfieSource() {\n    const selfiePreview = document.getElementById('selfie-thumbnail');\n    return selfiePreview ? selfiePreview.src : \"\";\n  }\n\n  getImportFile() {\n    const importFileInput = document.getElementById('import-file');\n    if (importFileInput && importFileInput.files.length > 0) {\n      return importFileInput.files[0];\n    }\n    return null;\n  }\n\n  showGlobalCamera() {\n    if (this.globalCamera) {\n      this.globalCamera.style.display = 'block';\n      console.log(\"[ViewManager] Global camera displayed.\");\n    } else {\n      ErrorManager.logError(\"Global camera element not found.\", \"showGlobalCamera\");\n    }\n  }\n\n  hideGlobalCamera() {\n    if (this.globalCamera) {\n      this.globalCamera.style.display = 'none';\n      console.log(\"[ViewManager] Global camera hidden.\");\n    } else {\n      ErrorManager.logError(\"Global camera element not found.\", \"hideGlobalCamera\");\n    }\n  }\n\n  showDiaryView() {\n    const diary = document.getElementById(\"diary\");\n    if (diary && this.globalCamera) {\n      diary.style.display = \"block\";\n      this.globalCamera.style.display = \"none\";\n      if (this.toggleCameraBtn) this.toggleCameraBtn.style.display = 'inline-block';\n      if (this.toggleDiaryBtn) this.toggleDiaryBtn.style.display = \"none\";\n      const shootBtn = document.getElementById(\"btn_shoot\");\n      if (shootBtn) shootBtn.style.display = \"none\";\n      this.showPostButton();\n      console.log(\"[ViewManager] Switched to diary view.\");\n    }\n  }\n\n  showCameraView() {\n    const diary = document.getElementById(\"diary\");\n    if (diary && this.globalCamera) {\n      diary.style.display = \"none\";\n      this.globalCamera.style.display = \"flex\";\n      if (this.toggleCameraBtn) this.toggleCameraBtn.style.display = 'none';\n      if (this.toggleDiaryBtn)  this.toggleDiaryBtn.style.display = 'inline-block';\n      this.hidePostButton();\n      const shootBtn = document.getElementById(\"btn_shoot\");\n      if (shootBtn) {\n        shootBtn.style.display = \"inline-block\";\n        console.log(\"[ViewManager] Shoot button shown for camera view; quest UI will manage its enabled state.\");\n      }\n      console.log(\"[ViewManager] Switched to camera view.\");\n    }\n  }\n\n  showPostButton() {\n    if (this.postBtn) {\n      this.postBtn.style.display = 'inline-block';\n      console.log(\"[ViewManager] Post button shown.\");\n    }\n  }\n\n  hidePostButton() {\n    if (this.postBtn) {\n      this.postBtn.style.display = 'none';\n      console.log(\"[ViewManager] Post button hidden.\");\n    }\n  }\n\n  /**\n   * setPostButtonEnabled\n   * Sets the Post button state.\n   * The passed parameter (isEnabled) is assumed to be pre-computed based on the universal quest state,\n   * such as the presence of an active quest key (\"activeQuestKey\").\n   */\n  setPostButtonEnabled(isEnabled) {\n    const postBtn = document.getElementById(\"post-btn\");\n    if (postBtn) {\n      const gameFinalized = StateManager.get(StateManager.KEYS.GAME_FINALIZED) === \"true\";\n      if (gameFinalized) {\n        postBtn.disabled = true;\n        StateManager.set(StateManager.KEYS.POST_BUTTON_DISABLED, \"true\");\n        console.log(\"[ViewManager] Game finalized. Post button disabled.\");\n      } else {\n        postBtn.disabled = !isEnabled;\n        StateManager.set(StateManager.KEYS.POST_BUTTON_DISABLED, isEnabled ? \"false\" : \"true\");\n        console.log(`[ViewManager] Post button set to ${isEnabled ? \"enabled\" : \"disabled\"}.`);\n      }\n    }\n  }\n\n  /**\n   * setCameraButtonActive\n   * Sets the active state of the camera button.\n   */\n  setCameraButtonActive(isActive) {\n    const cameraBtn = document.getElementById(\"toggle-camera\");\n    if (cameraBtn) {\n      if (isActive) {\n        cameraBtn.classList.add(\"active\");\n      } else {\n        cameraBtn.classList.remove(\"active\");\n      }\n      // Optionally, you might remove the old fixed key and rely on universal state instead.\n      StateManager.set(StateManager.KEYS.CAMERA_BUTTON_ACTIVE, JSON.stringify(isActive));\n      console.log(`[ViewManager] Camera button active state set to ${isActive}.`);\n    }\n  }\n\n  /**\n   * restoreCameraButtonState\n   * Restores the camera button state based on the universal quest state (\"activeQuestKey\").\n   */\n  restoreCameraButtonState() {\n    const activeQuestKey = StateManager.getActiveQuestKey();\n    // If an active quest is present, assume camera button should be active.\n    const isActive = activeQuestKey ? true : false;\n    this.setCameraButtonActive(isActive);\n    console.log(\"[ViewManager] Camera button state restored using activeQuestKey:\", isActive);\n  }\n\n  /**\n   * setShootButtonActive\n   * Sets the active state of the Shoot button.\n   */\n  setShootButtonActive(isActive) {\n    const shootBtn = document.getElementById(\"btn_shoot\");\n    if (shootBtn) {\n      // disabled и pointerEvents в одном месте\n      shootBtn.disabled = !isActive;\n      shootBtn.style.pointerEvents = isActive ? \"auto\" : \"none\";\n      if (isActive) {\n        shootBtn.classList.add(\"active\");\n      } else {\n        shootBtn.classList.remove(\"active\");\n      }\n      console.log(`[ViewManager] Shoot button active state set to ${isActive}.`);\n    } else {\n      ErrorManager.logError(\"Shoot button not found.\", \"setShootButtonActive\");\n    }\n  }\n\n  /**\n   * restoreShootButtonState\n   * Restores the Shoot button state based on the universal quest state (\"activeQuestKey\").\n   */\n  restoreShootButtonState() {\n    // Always start with Shoot disabled on page load.\n    this.setShootButtonActive(false);\n    console.log(\"[ViewManager] Shoot button state reset to disabled on restore.\");\n  }\n\n  setApartmentPlanNextButtonEnabled(isEnabled) {\n    const nextBtn = document.getElementById(\"apartment-plan-next-btn\");\n    if (nextBtn) {\n      nextBtn.disabled = !isEnabled;\n      console.log(`Apartment Plan Next button is now ${isEnabled ? \"enabled\" : \"disabled\"}.`);\n    } else {\n      ErrorManager.logError(\"Apartment plan Next button not found.\", \"setApartmentPlanNextButtonEnabled\");\n    }\n  }\n\n  startMirrorQuestUI(options) {\n    const statusElem = document.getElementById(options.statusElementId);\n    if (statusElem) {\n      statusElem.style.display = \"block\";\n      statusElem.textContent = \"No match...\";\n      console.log(\"[ViewManager] Mirror quest UI started, status set to 'No match...'\");\n    }\n    const shootBtn = document.getElementById(options.shootButtonId);\n    if (shootBtn) {\n      shootBtn.style.display = \"inline-block\";\n      const initialActive = (typeof options.initialActive !== 'undefined') ? options.initialActive : false;\n      this.setShootButtonActive(initialActive);\n      shootBtn.style.pointerEvents = initialActive ? \"auto\" : \"none\";\n      shootBtn.onclick = () => {\n        this.setShootButtonActive(false);\n        if (typeof options.onShoot === 'function') {\n          options.onShoot();\n        }\n      };\n      console.log(\"[ViewManager] Shoot button for mirror quest initialized.\");\n    } else {\n      ErrorManager.logError(\"Shoot button not found in the DOM.\", \"startMirrorQuestUI\");\n    }\n  }\n\n  updateMirrorQuestStatus(success, statusElementId, shootButtonId) {\n    const statusElem = document.getElementById(statusElementId);\n    if (statusElem) {\n      statusElem.textContent = success ? \"You are in front of the mirror!\" : \"No match...\";\n    }\n    const shootBtn = document.getElementById(shootButtonId);\n    if (shootBtn) {\n      shootBtn.disabled = !success;\n      shootBtn.style.pointerEvents = success ? \"auto\" : \"none\";\n    }\n    console.log(`[ViewManager] Mirror quest status updated. Success: ${success}`);\n  }\n\n  stopMirrorQuestUI(statusElementId) {\n    const statusElem = document.getElementById(statusElementId);\n    if (statusElem) {\n      statusElem.style.display = \"none\";\n    }\n    this.setCameraButtonActive(false);\n    this.setShootButtonActive(false);\n    console.log(\"[ViewManager] Mirror quest UI stopped.\");\n  }\n\n  /**\n   * startRepeatingQuestUI\n   * Displays the current target item and stage, and enables the Shoot button.\n   * @param {{ statusElementId: string, shootButtonId: string, stage: number, totalStages: number, target?: string, onShoot: Function, quest?: Object }} options\n   */\n  startRepeatingQuestUI(options) {\n    const statusElem = document.getElementById(options.statusElementId);\n    if (statusElem) {\n      statusElem.style.display = 'block';\n      statusElem.textContent = `Stage ${options.stage} of ${options.totalStages}: find \"${options.quest.currentTarget}\"`;\n    }\n\n    const shootBtn = document.getElementById(options.shootButtonId);\n    if (shootBtn) {\n      shootBtn.style.display = 'inline-block';\n      // English comment: disable Shoot by default until AI confirms detection\n      this.setShootButtonActive(false);\n      shootBtn.style.pointerEvents = 'none';\n\n      shootBtn.onclick = () => {\n        // English comment: prevent click if quest already finished\n        if (options.quest && options.quest.finished) {\n          console.log(\"[ViewManager] Quest is finished; ignoring Shoot click.\");\n          return;\n        }\n        // English comment: turn off again to avoid double clicks\n        this.setShootButtonActive(false);\n        if (typeof options.onShoot === \"function\") {\n          options.onShoot();\n        }\n      };\n\n      console.log(\"[ViewManager] Shoot button for repeating quest initialized.\");\n    } else {\n      ErrorManager.logError(\"Shoot button not found in the DOM.\", \"startRepeatingQuestUI\");\n    }\n  }\n\n  disableShootButton(shootButtonId) {\n    const shootBtn = document.getElementById(shootButtonId);\n    if (shootBtn) {\n      shootBtn.disabled = true;\n      shootBtn.style.pointerEvents = \"none\";\n      console.log(\"[ViewManager] Shoot button disabled.\");\n    }\n  }\n\n  stopRepeatingQuestUI(statusElementId) {\n    const statusElem = document.getElementById(statusElementId);\n    if (statusElem) {\n      statusElem.style.display = \"none\";\n    }\n    this.setCameraButtonActive(false);\n    this.setShootButtonActive(false);\n    console.log(\"[ViewManager] Repeating quest UI stopped.\");\n  }\n\n  updateUIAfterQuestStage({ postEnabled, cameraActive, shootActive }) {\n    if (typeof postEnabled === 'boolean') {\n      this.setPostButtonEnabled(postEnabled);\n    }\n    if (typeof cameraActive === 'boolean') {\n      this.setCameraButtonActive(cameraActive);\n    }\n    if (typeof shootActive === 'boolean') {\n      this.setShootButtonActive(shootActive);\n    }\n    console.log(\"[ViewManager] UI updated after quest stage:\", { postEnabled, cameraActive, shootActive });\n  }\n\n  createTopCameraControls() {\n    const existing = document.getElementById(\"top-camera-controls\");\n    if (existing) existing.remove();\n\n    const topControls = document.createElement(\"div\");\n    topControls.id = \"top-camera-controls\";\n    Object.assign(topControls.style, {\n      position: \"fixed\",\n      top: \"0\",\n      left: \"0\",\n      width: \"100%\",\n      padding: \"10px\",\n      background: \"rgba(0, 0, 0, 0.5)\",\n      display: \"flex\",\n      justifyContent: \"center\",\n      zIndex: \"2100\"\n    });\n\n    const arBtn = document.createElement(\"button\");\n    arBtn.className = \"button is-info\";\n    arBtn.innerText = \"AR Mode\";\n    arBtn.onclick = () => {\n      if (this.cameraManager) {\n        this.cameraManager.startARMode();\n      }\n    };\n    topControls.appendChild(arBtn);\n\n    const aiBtn = document.createElement(\"button\");\n    aiBtn.className = \"button is-primary\";\n    aiBtn.style.marginLeft = \"10px\";\n    aiBtn.innerText = \"Start AI Detection\";\n    aiBtn.onclick = () => {\n      if (this.cameraManager) {\n        this.cameraManager.startAIDetection();\n      }\n    };\n    topControls.appendChild(aiBtn);\n\n    const nightVisionBtn = document.createElement(\"button\");\n    nightVisionBtn.className = \"button is-warning\";\n    nightVisionBtn.style.marginLeft = \"10px\";\n    nightVisionBtn.innerText = \"Night Vision\";\n    nightVisionBtn.onclick = () => {\n      if (this.cameraManager) {\n        this.cameraManager.applyFilter('nightVision');\n      }\n    };\n    topControls.appendChild(nightVisionBtn);\n\n    const blackWhiteBtn = document.createElement(\"button\");\n    blackWhiteBtn.className = \"button is-warning\";\n    blackWhiteBtn.style.marginLeft = \"10px\";\n    blackWhiteBtn.innerText = \"Black & White\";\n    blackWhiteBtn.onclick = () => {\n      if (this.cameraManager) {\n        this.cameraManager.applyFilter('blackWhite');\n      }\n    };\n    topControls.appendChild(blackWhiteBtn);\n\n    const clearFilterBtn = document.createElement(\"button\");\n    clearFilterBtn.className = \"button\";\n    clearFilterBtn.style.marginLeft = \"10px\";\n    clearFilterBtn.innerText = \"Clear Filter\";\n    clearFilterBtn.onclick = () => {\n      if (this.cameraManager) {\n        this.cameraManager.applyFilter('');\n      }\n    };\n    topControls.appendChild(clearFilterBtn);\n\n    document.body.appendChild(topControls);\n    console.log(\"[ViewManager] Top camera controls created.\");\n  }\n\n  applyBackgroundTransition(color, duration) {\n    document.body.style.transition = `background ${duration}ms`;\n    document.body.style.background = color;\n    setTimeout(() => {\n      document.body.style.background = \"\";\n    }, duration);\n    console.log(`[ViewManager] Applied background transition with color ${color} for ${duration}ms.`);\n  }\n\n  showGhostAppearanceEffect(ghostId) {\n    const ghostEffect = document.createElement(\"div\");\n    Object.assign(ghostEffect.style, {\n      position: \"absolute\",\n      top: \"50%\",\n      left: \"50%\",\n      transform: \"translate(-50%, -50%)\",\n      width: \"200px\",\n      height: \"200px\",\n      background: `url('${BASE_PATH}/assets/images/${ghostId}.png') no-repeat center center`,\n      backgroundSize: \"contain\",\n      opacity: \"0.7\",\n      transition: \"opacity 2s\"\n    });\n    document.body.appendChild(ghostEffect);\n    setTimeout(() => { ghostEffect.style.opacity = \"0\"; }, 3000);\n    setTimeout(() => { ghostEffect.remove(); }, 5000);\n    console.log(`[ViewManager] Ghost appearance effect triggered for ghost ${ghostId}.`);\n  }\n\n  showNotification(message) {\n    const notification = document.createElement(\"div\");\n    notification.textContent = message;\n    Object.assign(notification.style, {\n      position: \"fixed\",\n      bottom: \"20px\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\",\n      backgroundColor: \"rgba(0,0,0,0.8)\",\n      color: \"white\",\n      padding: \"10px 20px\",\n      borderRadius: \"5px\",\n      zIndex: 10000,\n      opacity: \"0\",\n      transition: \"opacity 0.5s\"\n    });\n    document.body.appendChild(notification);\n    setTimeout(() => {\n      notification.style.opacity = \"1\";\n    }, 100);\n    setTimeout(() => {\n      notification.style.opacity = \"0\";\n      setTimeout(() => {\n        notification.remove();\n      }, 500);\n    }, 3000);\n    console.log(\"[ViewManager] Notification shown:\", message);\n  }\n\n  setControlsBlocked(shouldBlock) {\n    if (this.controlsPanel) {\n      this.controlsPanel.style.pointerEvents = shouldBlock ? \"none\" : \"auto\";\n      console.log(`[ViewManager] Controls ${shouldBlock ? \"blocked\" : \"unblocked\"}.`);\n    }\n  }\n\n  clearCache() {\n    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {\n      navigator.serviceWorker.controller.postMessage({ action: 'CLEAR_CACHE' });\n      console.log(\"Clear cache message sent to Service Worker.\");\n    } else {\n      console.warn(\"No active Service Worker controller found.\");\n    }\n  }\n\n  // ------------------ Modified goToApartmentPlanScreen ------------------\n  async goToApartmentPlanScreen(app) {\n    const regData = this.getRegistrationData();\n    if (!regData) {\n      ErrorManager.showError(\"Registration data missing.\");\n      return;\n    }\n    StateManager.set('regData', JSON.stringify(regData));\n    // Await the template loading so that the container is in the DOM.\n    await this.switchScreen('apartment-plan-screen', 'apartment-plan-buttons', app);\n    if (!app.apartmentPlanManager) {\n      app.apartmentPlanManager = new ApartmentPlanManager('apartment-plan-container', app.databaseManager, app);\n    }\n  }\n  // --------------------------------------------------------------------\n\n  goToSelfieScreen(app) {\n    this.switchScreen('selfie-screen', 'selfie-buttons', app);\n    this.showGlobalCamera();\n    if (app.cameraSectionManager) {\n      app.cameraSectionManager.startCamera();\n    }\n    this.disableCompleteButton();\n  }\n\n  captureSelfie(app) {\n    const video = app.cameraSectionManager.videoElement;\n    if (!video || !video.srcObject) {\n      ErrorManager.logError(\"Camera is not active!\", \"captureSelfie\");\n      ErrorManager.showError(\"Error: Camera is not active.\");\n      return;\n    }\n    if (video.readyState < 2) {\n      ErrorManager.logError(\"Camera is not ready yet.\", \"captureSelfie\");\n      ErrorManager.showError(\"Please wait for the camera to load.\");\n      return;\n    }\n    try {\n      const canvas = document.createElement('canvas');\n      canvas.width = video.videoWidth || 640;\n      canvas.height = video.videoHeight || 480;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        throw new Error(\"Failed to get 2D drawing context.\");\n      }\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      const grayscaleData = ImageUtils.convertToGrayscale(canvas);\n      this.updateSelfiePreview(grayscaleData);\n      this.enableCompleteButton();\n      app.selfieData = grayscaleData;\n      console.log(\"✅ Selfie captured successfully!\");\n    } catch (error) {\n      ErrorManager.logError(error, \"captureSelfie\");\n      ErrorManager.showError(\"Error capturing selfie! Please try again.\");\n    }\n  }\n\n  completeRegistration(app) {\n    const selfieSrc = this.getSelfieSource();\n    if (!selfieSrc || selfieSrc === \"\") {\n      ErrorManager.showError(\"Please capture your selfie before completing registration.\");\n      return;\n    }\n    const regDataStr = StateManager.get('regData');\n    if (!regDataStr) {\n      ErrorManager.showError(\"Registration data missing.\");\n      return;\n    }\n    const regData = JSON.parse(regDataStr);\n    const profile = {\n      name: regData.name,\n      gender: regData.gender,\n      language: this.languageSelector ? this.languageSelector.value : 'en',\n      selfie: selfieSrc\n    };\n    app.profileManager.saveProfile(profile).then(() => {\n      StateManager.set(\"registrationCompleted\", \"true\");\n      app.cameraSectionManager.stopCamera();\n      this.hideGlobalCamera();\n      this.switchScreen('main-screen', 'main-buttons', app);\n      this.showToggleCameraButton();\n      // Use universal activeQuestKey to determine Post button state.\n      const activeQuestKey = StateManager.getActiveQuestKey();\n      this.setPostButtonEnabled(Boolean(activeQuestKey));\n      app.profileManager.getProfile().then((profile) => {\n        this.updateProfileDisplay(profile);\n        app.selfieData = profile.selfie;\n      });\n      app.gameEventManager.autoLaunchWelcomeEvent();\n    });\n  }\n\n  /**\n   * toggleCameraView\n   * Switches between camera view and diary view, and persists the camera-open state.\n   */\n  toggleCameraView(app) {\n    if (!app.isCameraOpen) {\n      this.showCameraView();\n      // Mark camera as open in memory and in persistent state\n      app.isCameraOpen = true;\n      StateManager.setCameraOpen(true);\n      app.cameraSectionManager.startCamera();\n      console.log(\"Camera opened and state saved.\");\n    } else {\n      this.showDiaryView();\n      app.cameraSectionManager.stopCamera();\n      // Mark camera as closed in memory and in persistent state\n      app.isCameraOpen = false;\n      StateManager.setCameraOpen(false);\n      console.log(\"Camera closed and state saved.\");\n    }\n  }\n\n  exportProfile(app) {\n    app.profileManager.exportProfileData(app.databaseManager, app.apartmentPlanManager);\n  }\n\n  importProfile(app) {\n    const file = this.getImportFile();\n    if (!file) {\n      ErrorManager.showError(\"Please select a profile file to import.\");\n      return;\n    }\n    app.profileManager.importProfileData(file, app.databaseManager, app.apartmentPlanManager);\n  }\n\n  toggleChat(app) {\n    if (app.chatManager && app.chatManager.container) {\n      if (app.chatManager.container.style.display === 'block') {\n        app.chatManager.hide();\n      } else {\n        app.chatManager.show();\n      }\n    } else {\n      console.error(\"ChatManager is not initialized or chat container not found.\");\n    }\n  }\n\n  showLocationTypeModal(onConfirm, onCancel) {\n    const modalOverlay = document.createElement(\"div\");\n    modalOverlay.id = \"location-type-modal-overlay\";\n    Object.assign(modalOverlay.style, {\n      position: \"fixed\",\n      top: \"0\",\n      left: \"0\",\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: \"rgba(0,0,0,0.5)\",\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      zIndex: \"3000\"\n    });\n    \n    const modal = document.createElement(\"div\");\n    modal.id = \"location-type-modal\";\n    Object.assign(modal.style, {\n      backgroundColor: \"#fff\",\n      padding: \"20px\",\n      borderRadius: \"8px\",\n      maxWidth: \"400px\",\n      width: \"90%\",\n      textAlign: \"center\"\n    });\n    \n    const title = document.createElement(\"h3\");\n    title.textContent = \"Select location type\";\n    modal.appendChild(title);\n    \n    const selectElem = document.createElement(\"select\");\n    const locationTypes = [\n      \"Kitchen\", \"Bedroom\", \"Living Room\", \"Bathroom\", \"Corridor\", \"Other\",\n      \"Entrance\", \"Office\", \"Library\", \"Kids Room\", \"Storage\", \"Garage\"\n    ];\n    locationTypes.forEach(type => {\n      const option = document.createElement(\"option\");\n      option.value = type;\n      option.textContent = type;\n      selectElem.appendChild(option);\n    });\n    selectElem.value = \"Other\";\n    selectElem.style.marginBottom = \"15px\";\n    selectElem.style.display = \"block\";\n    selectElem.style.width = \"100%\";\n    modal.appendChild(selectElem);\n    \n    const btnContainer = document.createElement(\"div\");\n    btnContainer.style.marginTop = \"15px\";\n    \n    const confirmBtn = document.createElement(\"button\");\n    confirmBtn.textContent = \"Confirm\";\n    confirmBtn.style.marginRight = \"10px\";\n    confirmBtn.addEventListener(\"click\", () => {\n      console.log(\"Confirm button clicked, selected type:\", selectElem.value);\n      const selectedType = selectElem.value;\n      if (onConfirm) onConfirm(selectedType);\n      setTimeout(() => {\n        modalOverlay.remove();\n      }, 50);\n    });\n    btnContainer.appendChild(confirmBtn);\n    \n    const cancelBtn = document.createElement(\"button\");\n    cancelBtn.textContent = \"Cancel\";\n    cancelBtn.addEventListener(\"click\", () => {\n      console.log(\"Cancel button clicked.\");\n      if (onCancel) onCancel();\n      modalOverlay.remove();\n    });\n    btnContainer.appendChild(cancelBtn);\n    \n    modal.appendChild(btnContainer);\n    modalOverlay.appendChild(modal);\n    document.body.appendChild(modalOverlay);\n  }\n\n  /**\n   * renderDiary\n   * Renders the diary entries from the database into the diary container.\n   * Now checks if entry text *contains* base64 data (`data:image`) anywhere;\n   * if found, we separate text + image and render them properly.\n   */\n  renderDiary(entries, currentLanguage, visualEffectsManager) {\n    if (!this.diaryContainer) {\n      console.error(\"Diary container not set. Cannot render diary entries.\");\n      return;\n    }\n    this.diaryContainer.innerHTML = \"\";\n    if (!entries || entries.length === 0) {\n      const emptyMessage = (this.languageManager && this.languageManager.translate(\"no_diary_entries\", \"Diary is empty.\")) || \"Diary is empty.\";\n      const emptyDiv = document.createElement(\"div\");\n      emptyDiv.className = \"diary-empty\";\n      emptyDiv.textContent = emptyMessage;\n      this.diaryContainer.appendChild(emptyDiv);\n      return;\n    }\n\n    entries.forEach(entry => {\n      let rendered;\n      if (entry.entry.includes(\"data:image\")) {\n        // Находим начало base64\n        const full = entry.entry;\n        const idx = full.indexOf(\"data:image\");\n        const textLines = full.slice(0, idx).trim();\n        const base64Line = full.slice(idx).trim();\n\n        const entryWithImageTemplate = `\n          <div class=\"diary-entry {{postClass}}\" data-animate-on-board=\"true\">\n            <p>{{text}}</p>\n            <img src=\"{{img}}\" alt=\"Diary Image\" data-animate-on-board=\"true\" />\n            <span class=\"diary-timestamp\">{{timestamp}}</span>\n          </div>\n        `;\n        rendered = TemplateEngine.render(entryWithImageTemplate, {\n          postClass: entry.postClass,\n          text: textLines,\n          img: base64Line,\n          timestamp: entry.timestamp\n        });\n      } else {\n        const diaryEntryTemplate = `\n          <div class=\"diary-entry {{postClass}}\" data-animate-on-board=\"true\">\n            <p>{{entry}}</p>\n            <span class=\"diary-timestamp\">{{timestamp}}</span>\n          </div>\n        `;\n        rendered = TemplateEngine.render(diaryEntryTemplate, {\n          postClass: entry.postClass,\n          entry: entry.entry,\n          timestamp: entry.timestamp\n        });\n      }\n\n      this.diaryContainer.innerHTML += rendered;\n    });\n    console.log(\"[ViewManager] Diary updated with \" + entries.length + \" entries.\");\n  }\n\n  /**\n   * Loads and renders the latest `limit` diary posts, newest first.\n   */\n  async loadLatestDiaryPosts(limit = 3) {\n    // Получаем все записи\n    const entries = await this.app.databaseManager.getDiaryEntries();\n    // Сортируем по timestamp: от новых к старым\n    entries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n    // Берём первые `limit` самых свежих\n    const latest = entries.slice(0, limit);\n    // Рендерим\n    this.renderDiary(latest, this.app.languageManager.getLanguage(), this.app.visualEffectsManager);\n  }\n\n  /**\n   * Inserts a single diary post without re‑rendering the whole list.\n   * @param {Object} entryData { text, img, timestamp, postClass }\n   */\n  async addSingleDiaryPost(entryData) {\n    if (!this.diaryContainer) return;\n\n    // разбираем текст на до изображения и само изображение (если есть)\n    let textPart = entryData.text;\n    let imgSrc = \"\";\n    if (entryData.text.includes(\"data:image\")) {\n      const idx = entryData.text.indexOf(\"data:image\");\n      textPart = entryData.text.slice(0, idx).trim();\n      imgSrc = entryData.text.slice(idx).trim();\n    }\n\n    // строим тег <img> только если нашли base64\n    const imgTag = imgSrc\n      ? `<img src=\"${imgSrc}\" alt=\"Diary image\" />`\n      : \"\";\n\n    // абсолютный URL к шаблону\n    const templateUrl = `${BASE_PATH}/src/templates/diaryentry_screen-template.html`;\n\n    // рендерим, подставляя разделённый текст и картинку\n    const html = await TemplateEngine.renderFile(templateUrl, {\n      postClass: entryData.postClass,\n      text: textPart,\n      imgTag,\n      timestamp: entryData.timestamp\n    });\n\n    // вставляем сверху\n    this.diaryContainer.insertAdjacentHTML(\"afterbegin\", html);\n\n    // запускаем анимацию печатания только для <p>\n    const p = this.diaryContainer.querySelector(\n      '.diary-entry:first-child p[data-animate-on-board=\"true\"]'\n    );\n    if (p && this.app.visualEffectsManager) {\n      this.app.visualEffectsManager.applyEffectsToNewElements([p]);\n    }\n  }\n\n  async loadEarlierDiaryPosts(step = 3) {\n    const displayed = this.diaryContainer.querySelectorAll('.diary-entry').length;\n    const allEntries = await this.app.databaseManager.getDiaryEntries();\n    // Сортируем от новых к старым\n    allEntries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n    // Берём следующий кусок\n    const nextChunk = allEntries.slice(displayed, displayed + step);\n    const templateUrl = `${BASE_PATH}/src/templates/diaryentry_screen-template.html`;\n\n    for (const entry of nextChunk) {\n      // разбираем текст и картинку\n      let text = entry.entry;\n      let imgTag = \"\";\n      if (text.includes(\"data:image\")) {\n        const idx = text.indexOf(\"data:image\");\n        const imgSrc = text.slice(idx).trim();\n        text = text.slice(0, idx).trim();\n        imgTag = `<img src=\"${imgSrc}\" alt=\"Diary image\" />`;\n      }\n\n      const html = await TemplateEngine.renderFile(templateUrl, {\n        postClass: entry.postClass,\n        text,\n        imgTag,\n        timestamp: entry.timestamp\n      });\n\n      this.diaryContainer.insertAdjacentHTML(\"beforeend\", html);\n    }\n  }\n\n  /**\n   * При скролле вниз подгружает ещё по 3 поста.\n   */\n  async onScrollLoadOlder() {\n    if (this.loadingOlderPosts) return;\n    const threshold = 150; // px до низа, чтобы сработало чуть раньше\n    if (window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - threshold) {\n      this.loadingOlderPosts = true;\n      await this.loadEarlierDiaryPosts();\n      this.loadingOlderPosts = false;\n    }\n  }\n}","import { ASSETS_PATH } from '../config/paths.js';\nimport { ErrorManager } from './ErrorManager.js';\n\n/**\n * VisualEffectsManager\n *\n * Manages visual effects (fades, animations, transitions) for the application.\n * It delegates UI updates to the ViewManager when available and uses ErrorManager\n * for error handling.\n *\n * @param {App} appInstance - Reference to the main application instance.\n * @param {HTMLElement} controlsPanel - The controls panel element used for blocking interactions.\n */\nexport class VisualEffectsManager {\n  constructor(appInstance, controlsPanel) {\n    this.app = appInstance;\n    this.controlsPanel = controlsPanel;\n    // Default effect configuration (can be updated from external config)\n    this.effectConfig = {\n      userText: { speed: 100 },\n      ghostText: { speed: 100 }\n    };\n  }\n\n  /**\n   * playAudioWithStop\n   * Plays an audio file and stops it automatically after the specified delay.\n   *\n   * @param {string} audioSrc - Path to the audio file.\n   * @param {number} stopDelay - Time in milliseconds after which to stop playback.\n   * @returns {HTMLAudioElement|null} The audio object, or null if an error occurred.\n   */\n  playAudioWithStop(audioSrc, stopDelay) {\n    try {\n      const audio = new Audio(audioSrc);\n      audio.play();\n      if (stopDelay && stopDelay > 0) {\n        setTimeout(() => {\n          audio.pause();\n        }, stopDelay);\n      }\n      return audio;\n    } catch (error) {\n      ErrorManager.logError(error, \"playAudioWithStop\");\n      return null;\n    }\n  }\n\n  /**\n   * setControlsBlocked\n   * Blocks or unblocks user interaction with the controls.\n   * Delegates to the ViewManager if available.\n   *\n   * @param {boolean} shouldBlock - True to block controls, false to unblock.\n   */\n  setControlsBlocked(shouldBlock) {\n    // Do not block controls if the camera is open.\n    if (this.app.isCameraOpen) {\n      shouldBlock = false;\n    }\n    if (this.app.viewManager && typeof this.app.viewManager.setControlsBlocked === 'function') {\n      this.app.viewManager.setControlsBlocked(shouldBlock);\n    } else if (this.controlsPanel) {\n      try {\n        this.controlsPanel.style.pointerEvents = shouldBlock ? \"none\" : \"auto\";\n      } catch (error) {\n        ErrorManager.logError(error, \"setControlsBlocked\");\n      }\n    }\n  }\n\n  /**\n   * animateHTMLText\n   * Animates HTML text by \"typing\" it into the target element.\n   *\n   * @param {HTMLElement} targetElem - The target element for text animation.\n   * @param {string} text - The text (including HTML tags) to animate.\n   * @param {number} speed - Typing speed in milliseconds.\n   * @param {HTMLAudioElement} [audioObj] - Optional audio object to play during animation.\n   * @param {Function} [callback] - Callback invoked after animation completes.\n   * @param {Function} [onChar] - Callback invoked after each character is inserted.\n   */\n  animateHTMLText(targetElem, text, speed, audioObj, callback, onChar) {\n    targetElem.innerHTML = \"\";\n    let pos = 0;\n    let currentHTML = \"\";\n    let isTag = false;\n    let tagBuffer = \"\";\n\n    const intervalId = setInterval(() => {\n      const char = text[pos];\n      if (!char) {\n        clearInterval(intervalId);\n        if (audioObj) audioObj.pause();\n        if (callback) callback();\n        return;\n      }\n      // If the character is a newline, insert a <br>\n      if (char === \"\\n\") {\n        currentHTML += \"<br>\";\n      } else {\n        // Check for HTML tags.\n        if (char === \"<\") {\n          isTag = true;\n        }\n        if (isTag) {\n          tagBuffer += char;\n          if (char === \">\") {\n            currentHTML += tagBuffer;\n            tagBuffer = \"\";\n            isTag = false;\n          }\n        } else {\n          currentHTML += char;\n        }\n      }\n      targetElem.innerHTML = currentHTML;\n      pos++;\n      if (typeof onChar === \"function\") {\n        onChar(targetElem, currentHTML);\n      }\n    }, speed);\n  }\n\n  /**\n   * triggerMirrorEffect\n   * Triggers the mirror effect by applying a background transition and playing a ringtone.\n   * Delegates the background transition to the ViewManager when available.\n   */\n  triggerMirrorEffect() {\n    if (!this.app.isCameraOpen) {\n      ErrorManager.logError(\"Mirror effect not triggered: camera is closed.\", \"triggerMirrorEffect\");\n      return;\n    }\n    if (this.app.viewManager && typeof this.app.viewManager.applyBackgroundTransition === 'function') {\n      // Delegate background transition to ViewManager.\n      this.app.viewManager.applyBackgroundTransition(\"black\", 1000);\n    } else {\n      try {\n        // Fallback: Direct DOM manipulation.\n        document.body.style.transition = \"background 1s\";\n        document.body.style.background = \"black\";\n        setTimeout(() => {\n          document.body.style.background = \"\";\n        }, 1000);\n      } catch (error) {\n        ErrorManager.logError(error, \"triggerMirrorEffect - fallback\");\n      }\n    }\n    // Play the ringtone audio for 3 seconds.\n    this.playAudioWithStop(`${ASSETS_PATH}/audio/phone_ringtone.mp3`, 3000);\n  }\n\n  /**\n   * triggerGhostAppearanceEffect\n   * Triggers the ghost appearance effect.\n   * Delegates display to ViewManager if available, otherwise uses a fallback.\n   *\n   * @param {string} ghostId - Identifier for the ghost effect image.\n   */\n  triggerGhostAppearanceEffect(ghostId) {\n    if (!this.app.isCameraOpen) {\n      ErrorManager.logError(\"Ghost appearance effect not triggered: camera is closed.\", \"triggerGhostAppearanceEffect\");\n      return;\n    }\n    if (this.app.viewManager && typeof this.app.viewManager.showGhostAppearanceEffect === 'function') {\n      this.app.viewManager.showGhostAppearanceEffect(ghostId);\n    } else {\n      try {\n        // Fallback: Direct DOM manipulation.\n        const ghostEffect = document.createElement(\"div\");\n        Object.assign(ghostEffect.style, {\n          position: \"absolute\",\n          top: \"50%\",\n          left: \"50%\",\n          transform: \"translate(-50%, -50%)\",\n          width: \"200px\",\n          height: \"200px\",\n          background: `url('${ASSETS_PATH}/images/${ghostId}.png') no-repeat center center`,\n          backgroundSize: \"contain\",\n          opacity: \"0.7\",\n          transition: \"opacity 2s\"\n        });\n        document.body.appendChild(ghostEffect);\n        setTimeout(() => { ghostEffect.style.opacity = \"0\"; }, 3000);\n        setTimeout(() => { ghostEffect.remove(); }, 5000);\n      } catch (error) {\n        ErrorManager.logError(error, \"triggerGhostAppearanceEffect - fallback\");\n      }\n    }\n  }\n\n  /**\n   * triggerWhisperEffect\n   * Triggers the whisper effect by playing a whisper audio for 5 seconds.\n   */\n  triggerWhisperEffect() {\n    this.playAudioWithStop('${ASSETS_PATH}/audio/whisper.mp3', 5000);\n  }\n\n  /**\n   * triggerGhostTextEffect\n   * Triggers a ghost text effect by \"typing\" ghostly text into the target element.\n   * Blocks controls during the animation.\n   *\n   * @param {HTMLElement} targetElem - The target element for text animation.\n   * @param {string} text - The ghost text to animate.\n   * @param {Function} callback - Callback invoked after animation completes.\n   * @param {Object} [effectConfig] - Optional configuration for the effect (e.g. speed).\n   */\n  triggerGhostTextEffect(targetElem, text, callback, effectConfig) {\n    // Use provided configuration or default ghostText config.\n    const config = effectConfig || this.effectConfig.ghostText;\n\n    // Block controls.\n    this.setControlsBlocked(true);\n\n    // Play ghost sound.\n    const ghostSound = new Audio('../../../../assets/audio/ghost_effect.mp3');\n    ghostSound.play();\n\n    this.animateHTMLText(\n      targetElem,\n      text,\n      config.speed,\n      ghostSound,\n      () => {\n        this.setControlsBlocked(false);\n        if (callback) callback();\n      }\n    );\n  }\n\n  /**\n   * triggerUserTextEffect\n   * Triggers a user text effect that simulates typing with a moving pencil icon.\n   * Blocks controls during the animation.\n   *\n   * @param {HTMLElement} targetElem - The target element for text animation.\n   * @param {string} text - The text to animate.\n   * @param {Function} callback - Callback invoked after animation completes.\n   * @param {Object} [effectConfig] - Optional configuration for the effect (e.g. speed).\n   */\n  triggerUserTextEffect(targetElem, text, callback, effectConfig) {\n    // Use provided configuration or default userText config.\n    const config = effectConfig || this.effectConfig.userText;\n\n    // Create a pencil icon.\n    const pencilIcon = document.createElement(\"img\");\n    pencilIcon.src = \"../../../../assets/images/pencil.png\";\n    pencilIcon.alt = \"Typing...\";\n    Object.assign(pencilIcon.style, {\n      width: \"24px\",\n      height: \"24px\",\n      position: \"absolute\"\n    });\n\n    // Insert the pencil icon into the parent element.\n    const parentElem = targetElem.parentElement;\n    parentElem.style.position = \"relative\";\n    parentElem.insertBefore(pencilIcon, targetElem);\n\n    // Block controls.\n    this.setControlsBlocked(true);\n\n    // Play typing sound.\n    const typeSound = new Audio('../../../../assets/audio/type_sound.mp3');\n    typeSound.loop = true;\n    typeSound.play();\n\n    const onChar = () => {\n      const dummySpan = document.createElement(\"span\");\n      dummySpan.innerHTML = \"&nbsp;\"; // For positioning.\n      targetElem.appendChild(dummySpan);\n\n      const rectDummy = dummySpan.getBoundingClientRect();\n      const rectParent = parentElem.getBoundingClientRect();\n      // Update pencil icon position.\n      pencilIcon.style.left = (rectDummy.left - rectParent.left) + \"px\";\n      pencilIcon.style.top  = (rectDummy.top - rectParent.top) + \"px\";\n\n      dummySpan.remove();\n    };\n\n    this.animateHTMLText(\n      targetElem,\n      text,\n      config.speed,\n      typeSound,\n      () => {\n        pencilIcon.remove();\n        this.setControlsBlocked(false);\n        if (callback) callback();\n      },\n      onChar\n    );\n  }\n\n  /**\n   * slideUpPanel\n   * Animates the appearance of a panel by sliding it up from the bottom.\n   *\n   * @param {HTMLElement} panel - The panel element to animate.\n   * @param {number} duration - Animation duration in milliseconds.\n   * @param {string} soundPath - Path to the sound to play during the animation.\n   */\n  slideUpPanel(panel, duration = 1000, soundPath = 'assets/audio/panel_slide.mp3') {\n    if (!panel) return;\n    // Set initial state: slide the panel out of view (translateY(100%)) and transparent.\n    panel.style.transition = `transform ${duration}ms ease-out, opacity ${duration}ms ease-out`;\n    panel.style.transform = \"translateY(100%)\";\n    panel.style.opacity = \"0\";\n    // Force reflow.\n    panel.offsetHeight;\n    // Play slide-up sound.\n    this.playAudioWithStop(soundPath, duration);\n    // Animate panel into view.\n    panel.style.transform = \"translateY(0)\";\n    panel.style.opacity = \"1\";\n  }\n\n  /**\n   * showControlsPanelForUnregistered\n   * If the user is not registered (i.e. registrationCompleted flag is not \"true\"),\n   * animates the controls panel by sliding it up from the bottom with sound.\n   */\n  showControlsPanelForUnregistered() {\n    if (StateManager.get(\"registrationCompleted\") !== \"true\") {\n      this.slideUpPanel(this.controlsPanel, 1000, 'assets/audio/panel_slide.mp3');\n    }\n  }\n\n  /**\n   * applyEffectsToNewElements\n   * Applies visual effects to newly added DOM elements.\n   * It iterates over the provided elements, checks for a data-attribute \"data-animate-on-board\",\n   * and, depending on the \"data-animate-effect\" attribute (\"ghost\" or \"user\", default \"user\"),\n   * triggers the corresponding text effect. After animation, the marker is removed.\n   *\n   * @param {Array<HTMLElement>} newElements - Array or NodeList of newly added DOM elements.\n   */\n  applyEffectsToNewElements(newElements) {\n    // Ensure we always iterate over a concrete array\n    Array.from(newElements).forEach((elem) => {\n      // Gather only <p data-animate-on-board=\"true\"> inside the element\n      const textTargets = elem.matches('p[data-animate-on-board=\"true\"]')\n        ? [elem]\n        : elem.querySelectorAll('p[data-animate-on-board=\"true\"]');\n\n      textTargets.forEach((p) => {\n        const effectType = p.dataset.animateEffect || 'user';\n        const rawText    = p.textContent;\n        p.textContent    = '';\n        if (effectType === 'ghost') {\n          this.triggerGhostTextEffect(p, rawText, () => delete p.dataset.animateOnBoard);\n        } else {\n          this.triggerUserTextEffect(p, rawText, () => delete p.dataset.animateOnBoard);\n        }\n      });\n    });\n  }\n}\n\n/**\n * BaseEffect\n *\n * A base class for visual effects.\n * Subclasses should implement the applyEffect method.\n */\nexport class BaseEffect {\n  /**\n   * @param {Object} config - Configuration object for the effect.\n   */\n  constructor(config) {\n    this.config = config;\n  }\n\n  /**\n   * applyEffect\n   * Applies the effect to the target element.\n   * This method should be overridden in subclasses.\n   *\n   * @param {HTMLElement} target - The target element.\n   * @param {string} text - The text to animate.\n   * @param {Function} callback - Callback to call after effect is complete.\n   */\n  applyEffect(target, text, callback) {\n    throw new Error(\"applyEffect must be implemented by subclass\");\n  }\n}\n\n/**\n * TypewriterEffect\n *\n * An example subclass of BaseEffect that implements a typewriter effect.\n */\nexport class TypewriterEffect extends BaseEffect {\n  /**\n   * Applies the typewriter effect to the target element.\n   *\n   * @param {HTMLElement} target - The target element.\n   * @param {string} text - The text to animate.\n   * @param {Function} callback - Callback to call after effect is complete.\n   */\n  applyEffect(target, text, callback) {\n    // Here we simply delegate to VisualEffectsManager's animateHTMLText using the configured speed.\n    // In a real implementation, additional logic could be added.\n    // For demonstration, we assume a global instance is available.\n    // Alternatively, this method could accept an instance of VisualEffectsManager.\n    target.innerHTML = \"\";\n    let pos = 0;\n    let currentHTML = \"\";\n    const intervalId = setInterval(() => {\n      if (pos >= text.length) {\n        clearInterval(intervalId);\n        if (callback) callback();\n        return;\n      }\n      currentHTML += text[pos];\n      target.innerHTML = currentHTML;\n      pos++;\n    }, this.config.speed);\n  }\n}","/**\n * GameEntityLoader.js\n * \n * Provides functions to load the game entities configuration (events, quests, and sequence)\n * from a unified JSON file and derive mappings for use in managers.\n */\n\n/**\n * Loads the game entities configuration by fetching the JSON file.\n * Returns an object containing `events`, `quests`, and `sequence`.\n */\nexport async function loadGameEntitiesConfig() {\n  const response = await fetch('./src/config/gameEntities.json');\n  if (!response.ok) {\n    throw new Error('Failed to load game entities configuration');\n  }\n  const config = await response.json();\n  return config;\n}\n\n/**\n * Constructs a mapping from questKey to its parent eventKey based on the sequence.\n * \n * Example return value:\n * {\n *   \"mirror_quest\": \"welcome\",\n *   \"repeating_quest\": \"post_repeating_event\",\n *   \"final_quest\": \"final_event\"\n * }\n * \n * Usage:\n *   const questKeyToEventKey = await getQuestKeyToEventKeyMap();\n */\nexport async function getQuestKeyToEventKeyMap() {\n  const config = await loadGameEntitiesConfig();\n  const map = {};\n  config.sequence.forEach(triad => {\n    // triad: { eventKey, questKey, nextEventKey }\n    map[triad.questKey] = triad.eventKey;\n  });\n  return map;\n}","// ImageUtils.js\nexport class ImageUtils {\n  /**\n   * Converts the canvas image to grayscale and returns the data URL.\n   * @param {HTMLCanvasElement} canvas \n   * @returns {string} Data URL with PNG format.\n   */\n  static convertToGrayscale(canvas) {\n    const ctx = canvas.getContext(\"2d\");\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    const pixels = imageData.data;\n    for (let i = 0; i < pixels.length; i += 4) {\n      const avg = (pixels[i] + pixels[i+1] + pixels[i+2]) / 3;\n      pixels[i] = avg;\n      pixels[i+1] = avg;\n      pixels[i+2] = avg;\n    }\n    ctx.putImageData(imageData, 0, 0);\n    return canvas.toDataURL(\"image/png\");\n  }\n\n  /**\n   * Performs pixel-wise comparison between two base64 images.\n   * @param {string} img1 Base64 string of the first image.\n   * @param {string} img2 Base64 string of the second image.\n   * @returns {number} Matching coefficient between 0 and 1.\n   */\n  static pixelWiseComparison(img1, img2) {\n    const decodeBase64 = img => atob(img.split(',')[1]);\n    const image1 = decodeBase64(img1);\n    const image2 = decodeBase64(img2);\n    let matchCount = 0;\n    const len = Math.min(image1.length, image2.length);\n    for (let i = 0; i < len; i++) {\n      if (Math.abs(image1.charCodeAt(i) - image2.charCodeAt(i)) < 100) {\n        matchCount++;\n      }\n    }\n    return matchCount / len;\n  }\n\n  /**\n   * Performs histogram comparison between two base64 images.\n   * @param {string} img1 Base64 string of the first image.\n   * @param {string} img2 Base64 string of the second image.\n   * @returns {number} Matching coefficient between 0 and 1.\n   */\n  static histogramComparison(img1, img2) {\n    const hist1 = this.createHistogram(img1);\n    const hist2 = this.createHistogram(img2);\n    const diff = hist1.reduce((acc, val, i) => acc + Math.abs(val - hist2[i]), 0);\n    const totalPixels = hist1.reduce((sum, val) => sum + val, 0);\n    return 1 - (diff / (totalPixels * 1.2));\n  }\n\n  /**\n   * Creates a histogram (256 levels) for a base64 image.\n   * @param {string} img Base64 string of the image.\n   * @returns {number[]} Array of length 256 with pixel counts.\n   */\n  static createHistogram(img) {\n    const hist = new Array(256).fill(0);\n    const imgData = atob(img.split(',')[1]);\n    for (let i = 0; i < imgData.length; i++) {\n      hist[imgData.charCodeAt(i)]++;\n    }\n    return hist;\n  }\n\n  /**\n   * applyFilterToCanvas\n   * Applies a filter effect to a canvas and returns a new data URL.\n   * For example, for 'nightVision' the image brightness/contrast can be adjusted.\n   * @param {HTMLCanvasElement} canvas\n   * @param {string} filterType - 'nightVision', 'blackWhite', or ''.\n   * @returns {string} Data URL of the processed image.\n   */\n  static applyFilterToCanvas(canvas, filterType) {\n    const ctx = canvas.getContext(\"2d\");\n    // Save current state\n    ctx.save();\n    if (filterType === 'nightVision') {\n      // Example: increase brightness and add a green tint\n      ctx.filter = 'brightness(150%) contrast(120%) sepia(100%) hue-rotate(90deg)';\n    } else if (filterType === 'blackWhite') {\n      ctx.filter = 'grayscale(100%)';\n    } else {\n      ctx.filter = 'none';\n    }\n    // Redraw the current canvas content with the filter applied\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.putImageData(imageData, 0, 0);\n    // Restore state and return new data URL\n    ctx.restore();\n    return canvas.toDataURL(\"image/png\");\n  }\n}","/**\n * SequenceManager.js\n * \n * Provides methods to manage the event–quest sequence.\n *\n * @typedef {Object} SequenceEntry\n * @property {string} eventKey - The event key.\n * @property {string} questKey - The quest key that will be started after the event.\n * @property {string|null} nextEventKey - The key of the next event (or null if the sequence is complete).\n */\n\nexport class SequenceManager {\n  /**\n   * @param {SequenceEntry[]} sequenceList - The list of sequence entries.\n   */\n  constructor(sequenceList) {\n    this.sequenceList = sequenceList;\n    this.currentIndex = 0;\n  }\n\n  /**\n   * Returns the current sequence entry.\n   * @returns {SequenceEntry|null}\n   */\n  getCurrentEntry() {\n    return (this.sequenceList && this.sequenceList[this.currentIndex]) || null;\n  }\n\n  /**\n   * Checks if the provided quest key matches the expected quest in the current sequence entry.\n   * @param {string} questKey \n   * @returns {boolean}\n   */\n  isNextQuest(questKey) {\n    const entry = this.getCurrentEntry();\n    return entry ? entry.questKey === questKey : false;\n  }\n\n  /**\n   * Checks if the provided event key matches the expected event in the current sequence entry.\n   * @param {string} eventKey \n   * @returns {boolean}\n   */\n  isNextEvent(eventKey) {\n    const entry = this.getCurrentEntry();\n    return entry ? entry.eventKey === eventKey : false;\n  }\n\n  /**\n   * Increments the sequence index if not at the end.\n   */\n  increment() {\n    if (this.currentIndex < this.sequenceList.length - 1) {\n      this.currentIndex++;\n    }\n  }\n\n  /**\n   * Resets the sequence index to the beginning.\n   */\n  reset() {\n    this.currentIndex = 0;\n  }\n}","/**\n * SpiritBoardUtils.js\n *\n * This module provides utility functions for visual effects on the spirit board.\n * It includes functions to animate text by sequentially revealing letters.\n */\n\n/**\n * animateText\n * Sequentially animates each letter of the given text within the provided HTML element.\n * It splits the text into individual letters, wraps each in a span, and applies a fade-in effect.\n *\n * @param {HTMLElement} element - The target element where the text animation will occur.\n * @param {string} text - The text to be animated.\n */\nexport function animateText(element, text) {\n  // Clear the current content of the element\n  element.innerHTML = '';\n\n  // Split the text into individual letters\n  const letters = text.split('');\n\n  // Create a span for each letter and animate its appearance\n  letters.forEach((letter, index) => {\n    const span = document.createElement('span');\n    span.innerText = letter;\n    // Set initial opacity to 0 for the animation effect\n    span.style.opacity = '0';\n    span.style.transition = 'opacity 0.3s ease-in';\n    element.appendChild(span);\n\n    // Reveal each letter sequentially with a delay (e.g., 100ms between letters)\n    setTimeout(() => {\n      span.style.opacity = '1';\n    }, index * 100);\n  });\n}","/**\n * TemplateEngine.js\n *\n * A simple template engine for dynamic HTML rendering.\n * It replaces placeholders in the template string with values from a data object.\n *\n * Placeholders are defined using double curly braces, e.g., {{ variableName }}.\n *\n * Example usage:\n *   const template = \"<h1>{{ title }}</h1><p>{{ content }}</p>\";\n *   const data = { title: \"Hello\", content: \"World\" };\n *   const renderedHTML = TemplateEngine.render(template, data);\n *   // renderedHTML: \"<h1>Hello</h1><p>World</p>\"\n */\nexport class TemplateEngine {\n  /**\n   * Renders an HTML template using the provided data.\n   *\n   * @param {string} template - The template string containing placeholders.\n   * @param {Object} data - The data object with keys corresponding to placeholder names.\n   * @returns {string} - The rendered HTML string with placeholders replaced by data values.\n   */\n  static render(template, data) {\n    return template.replace(/{{\\s*([\\s\\S]+?)\\s*}}/g, (match, key) => {\n      const trimmedKey = key.trim();\n      return data.hasOwnProperty(trimmedKey) ? data[trimmedKey] : match;\n    });\n  }\n\n  /**\n   * Loads an HTML template from `templatePath` with `fetch`, then renders it with the data.\n   * @param {string} templatePath – relative / absolute URL to the HTML file.\n   * @param {Object} [data={}] – placeholder values.\n   */\n  static async renderFile(templatePath, data = {}) {\n    const response = await fetch(templatePath);\n    if (!response.ok) {\n      throw new Error(`[TemplateEngine] Failed to load template: ${templatePath}`);\n    }\n    const templateText = await response.text();\n    return TemplateEngine.render(templateText, data);\n  }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var inProgress = {};\nvar dataWebpackPrefix = \"testerer-deploy.github.io:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t\"main\": 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunktesterer_deploy_github_io\"] = self[\"webpackChunktesterer_deploy_github_io\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import { BASE_PATH, SQL_WASM_URL, TFJS_URL, COCO_SSD_URL } from './src/config/paths.js';\nimport { App } from './src/App.js';\n\n// Function to dynamically load a script and return a Promise\nfunction loadScript(src) {\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    script.src     = src;\n    script.async   = false;           // preserve execution order\n    script.onload  = () => resolve(src);\n    script.onerror = () => reject(new Error(`Failed to load ${src}`));\n    document.head.appendChild(script);\n  });\n}\n\n// 1. Load SQL.js, TF.js and COCO-SSD in sequence before doing anything else\nPromise.all([\n  loadScript(SQL_WASM_URL),\n  loadScript(TFJS_URL),\n  loadScript(COCO_SSD_URL)\n])\n  .then(() => {\n    console.log('All external libraries loaded');\n\n    // 2. Wait for DOM, then initialize App and PWA logic\n    document.addEventListener('DOMContentLoaded', () => {\n      const app = new App();\n\n      // PWA installation prompt handling\n      let deferredPrompt;\n      window.addEventListener('beforeinstallprompt', e => {\n        e.preventDefault();\n        deferredPrompt = e;\n        const btn = document.getElementById('install-btn');\n        if (btn) btn.style.display = 'block';\n      });\n\n      const installBtn = document.getElementById('install-btn');\n      if (installBtn) {\n        installBtn.addEventListener('click', async () => {\n          if (!deferredPrompt) return;\n          deferredPrompt.prompt();\n          const { outcome } = await deferredPrompt.userChoice;\n          console.log(`User response to the install prompt: ${outcome}`);\n          installBtn.style.display = 'none';\n          deferredPrompt = null;\n        });\n      }\n\n      // 3. Service Worker registration with auto-update hooks\n      if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.register(`${BASE_PATH}/sw.js`)\n          .then(reg => {\n            console.log('Service Worker registered with scope:', reg.scope);\n\n            // If there's an update ready, tell it to skip waiting\n            if (reg.waiting) {\n              reg.waiting.postMessage({ type: 'SKIP_WAITING' });\n            }\n\n            // Listen for new SW installations\n            reg.addEventListener('updatefound', () => {\n              const newSW = reg.installing;\n              newSW.addEventListener('statechange', () => {\n                if (newSW.state === 'installed' && navigator.serviceWorker.controller) {\n                  newSW.postMessage({ type: 'SKIP_WAITING' });\n                }\n              });\n            });\n          })\n          .catch(err => console.error('Error during Service Worker registration:', err));\n        // When a new SW takes control, reload the page so that all clients use the new version\n        navigator.serviceWorker.addEventListener('controllerchange', () => {\n          console.log(\"New Service Worker activated; reloading page\");\n          window.location.reload();\n        });\n      }\n\n      // 4. “Update” button clears caches via SW message\n      const updateBtn = document.getElementById('update-btn');\n      if (updateBtn) {\n        updateBtn.addEventListener('click', () => {\n          console.log('Update button clicked; clearing caches');\n          if (navigator.serviceWorker.controller) {\n            navigator.serviceWorker.controller.postMessage({ action: 'CLEAR_CACHE' });\n          }\n        });\n      }\n    });\n  })\n  .catch(err => console.error('Loader error:', err));"],"names":["BASE_PATH","COCO_SSD_MODEL","ImageUtils","VisualEffectsManager","SQLiteDataManager","DatabaseManager","StateManager","ErrorManager","ViewManager","LanguageManager","CameraSectionManager","ProfileManager","GhostManager","EventManager","QuestManager","GameEventManager","ShowProfileModal","ChatManager","App","constructor","deps","viewManager","bindEvents","sqliteDataManager","databaseManager","isCameraOpen","selfieData","languageManager","cameraSectionManager","setCameraManager","profileManager","visualEffectsManager","controlsPanel","savedSequenceIndex","parseInt","get","ghostManager","eventManager","questManager","gameEventManager","showProfileModal","chatManager","createChatManagerWrapper","sectionKey","init","loadAppState","savedGhostId","setCurrentGhost","initDatabasePromise","console","log","preloadModel","syncQuestState","restoreAllActiveQuests","setCameraButtonActive","showToggleCameraButton","createTopCameraControls","scheduleConversationStartIfInactive","isProfileSaved","profile","getProfile","switchScreen","postButtonDisabled","setPostButtonEnabled","updateProfileDisplay","selfie","loadLatestDiaryPosts","preloader","document","getElementById","style","display","window","location","hostname","includes","ASSETS_PATH","SQL_WASM_URL","TFJS_URL","COCO_SSD_URL","CURRENT_SEQUENCE_INDEX","POST_BUTTON_DISABLED","CAMERA_BUTTON_ACTIVE","CAMERA_OPEN","ACTIVE_QUEST_KEY","MIRROR_QUEST_READY","WELCOME_DONE","REPEATING_QUEST_STATE","GAME_FINALIZED","chatLocales_en","chatLocales_ru","chatLocales_uk","locales","ApartmentPlanManager","containerId","dbManager","appInstance","app","container","rooms","currentFloor","isSelecting","startCell","endCell","gridRows","gridCols","createGrid","attachEvents","then","loadFromDB","nextBtn","addEventListener","disabled","goToSelfieScreen","logError","gridContainer","createElement","gridTemplateColumns","gridAutoRows","gap","innerHTML","appendChild","initGrid","r","c","cell","dataset","row","col","width","height","border","textAlign","verticalAlign","cursor","e","startSelection","updateSelection","finishSelection","handleTouchStart","handleTouchMove","handleTouchEnd","preventDefault","touch","touches","target","elementFromPoint","clientX","clientY","tagName","highlightSelection","closest","showLocationTypeModal","selectedType","saveLocationType","room","floor","startRow","Math","min","startCol","endRow","max","endCol","type","push","saveToDB","renderRooms","setApartmentPlanNextButtonEnabled","Array","from","children","forEach","backgroundColor","querySelector","currentRooms","filter","addApartmentRooms","getApartmentPlan","length","nextFloor","prevFloor","videoElement","stream","onVideoReady","onCameraClosed","isDetecting","aiDetectionTimer","aiModel","aiDetectionInterval","currentDetectionConfig","recordingStartTime","recordingTimerId","detectionFrame","detail","resetDetectionFrame","modelPromise","cocoSsd","load","modelUrl","error","attachTo","options","autoplay","playsInline","id","parentNode","removeChild","prop","startCamera","isMobile","test","navigator","userAgent","constraints","video","facingMode","mediaDevices","getUserMedia","srcObject","readyState","dispatchEvent","CustomEvent","createDetectionFrame","once","stopCamera","getTracks","track","stop","textContent","head","Object","assign","position","top","left","boxSizing","pointerEvents","animation","body","updateDetectionFrame","bbox","x","y","w","h","transition","startARMode","warn","arMarkup","insertAdjacentHTML","stopARMode","arScene","remove","applyFilter","filterType","startRecordingTimer","Date","now","timerElem","setInterval","elapsed","innerText","stopRecordingTimer","clearInterval","updateBatteryStatus","battery","getBattery","batteryElem","update","level","startAIDetection","config","runAIDetection","setTimeout","predictions","detect","handleAIPredictions","pred","score","class","toFixed","animateCornerFrame","stopAIDetection","clearTimeout","TemplateEngine","animateText","templateUrl","mode","scenarioManager","defaultOptions","getStateKey","baseKey","getLocalizedString","key","defaultValue","getLanguage","lang","response","fetch","ok","Error","templateText","text","messagesStr","chatMessages","getChatMessages","map","msg","sender","message","join","localizedSpiritBoardContent","data","messages","spiritBoardContent","renderedHTML","render","optionsEl","isConversationActive","module","ChatScenarioManager","conversationStarted","messagesEl","hasMessages","show","hide","sendInitialMessage","localizedText","messageHTML","saveMessage","addChatMessage","loadDialogue","dialogueConfig","messagesHTML","localizedMsg","animateOnBoard","boardEl","updateDialogueOptions","optionsHTML","option","index","localizedOptionText","maxHeight","overflowY","optionButtons","querySelectorAll","btn","advanceDialogue","setMode","restartConversation","set","delay","clearChat","prefix","dataManager","db","initDatabase","SQL","initSqlJs","locateFile","file","saveDatabase","binaryData","export","binaryStr","i","String","fromCharCode","base64","btoa","addDiaryEntry","entry","timestamp","toISOString","run","getDiaryEntries","result","exec","values","parsed","JSON","parse","postClass","addQuestProgress","questKey","status","getQuestProgress","quest_key","roomData","stringify","callback","saveGhostState","ghost","name","progress","getGhostState","ghostId","saveEvent","eventData","event_key","event_text","completed","getEvents","saveQuestRecord","questData","current_stage","total_stages","getQuestRecord","NotificationManager","context","showError","notificationManager","showNotification","isEventLogged","eventKey","entries","some","isPostFromGhost","entryData","serializedEntry","addSingleDiaryPost","img","startsWith","toLocaleString","updateDiaryDisplay","diaryContainer","newEntries","applyEffectsToNewElements","renderDiary","currentLanguage","loadGameEntitiesConfig","events","eventCfg","dependencyMapping","params","dependencies","dep","EventClass","className","instance","catch","activateEvent","event","find","activate","autoLaunchWelcomeEvent","KEYS","SequenceManager","currentSequenceIndex","activeQuestKey","getActiveQuestKey","questActive","ghosts","setupGhosts","currentGhostId","currentPhenomenonIndex","currentGhost","getCurrentGhost","sequenceManager","sequence","savedIndex","currentIndex","firstEntry","getCurrentEntry","onEventCompleted","onQuestCompleted","defaultGhost","phenomenaCount","isFinished","g","finishCurrentGhost","isCurrentGhostFinished","triggerNextPhenomenon","phenomenonNumber","phenomenonEntry","saveGhostProgress","phenomenonIndex","finalEntry","resetGhostChain","resetGhostProgress","isNextInSequence","isNextQuest","isNextEvent","canStartQuest","record","startQuest","activateQuest","setActiveQuestKey","startEvent","isFollowup","updatePostButtonState","nextEntry","canStart","handlePostButtonClick","nextEventKey","increment","repeatingQuest","quests","q","questStatus","getCurrentQuestStatus","currentStage","totalStages","dynamicEventKey","currentEntry","baseLocales","mergedLocales","en","ru","uk","selectorId","selector","localStorage","getItem","value","applyLanguage","setItem","el","getAttribute","updateContainerLanguage","startObservingContainer","observer","MutationObserver","mutations","mutation","addedNodes","node","nodeType","Node","ELEMENT_NODE","hasAttribute","observe","childList","subtree","translate","Notification","permission","requestPermission","saveProfile","resetProfile","Promise","all","resetDatabase","preserveKeys","removeItem","serviceWorker","controller","postMessage","action","err","exportProfileData","apartmentPlanManager","alert","filteredProfile","gender","language","diaryEntries","apartmentPlanData","questProgressData","exportData","diary","apartment","chat","blob","Blob","url","URL","createObjectURL","a","href","download","click","revokeObjectURL","importProfileData","reader","FileReader","onload","importedData","isArray","reload","readAsText","getGhostProgress","locationType","getLocationType","getQuestKeyToEventKeyMap","questKeyToEventKey","questCfg","QuestClass","initCameraListeners","restoreRepeatingQuestUI","restoreCameraButtonState","restoreShootButtonState","cameraManager","currentTarget","generateDetectionConfig","syncQuestStateForQuest","canPost","quest","checkQuest","finish","updateQuestProgress","restoreUI","finished","dbName","storeName","openDB","resolve","reject","request","indexedDB","open","onerror","onupgradeneeded","objectStoreNames","contains","createObjectStore","onsuccess","savedDbBase64","loadDatabase","dbInstance","atob","Uint8Array","charCodeAt","Database","migrateDatabase","base64Data","transaction","oncomplete","store","objectStore","putRequest","put","getRequest","deleteRequest","delete","profileKey","modalOverlay","justifyContent","alignItems","zIndex","modal","padding","borderRadius","maxWidth","boxShadow","title","avatarContainer","avatarImg","src","alt","updateSelfieBtn","marginTop","showSelfieEditModal","newSelfieSrc","loginLabel","loginInput","marginBottom","planContainer","table","createTable","planClone","cloneNode","floors","uniqueFloors","Set","floorControls","prevFloorBtn","newPlan","nextFloorBtn","marginLeft","note","fontStyle","rewardsContainer","flexWrap","ghostList","ghostIcon","margin","fontSize","fontWeight","ghostProgress","borderColor","btnContainer","cancelBtn","marginRight","saveBtn","updatedProfile","profileNameElem","profilePhotoElem","onSelfieCaptured","selfieOverlay","selfieModal","videoContainer","captureBtn","canvas","videoWidth","videoHeight","ctx","getContext","drawImage","convertToGrayscale","toDataURL","StateKeys","setCameraOpen","isOpen","canShoot","loadingOlderPosts","languageSelector","globalCamera","postBtn","toggleCameraBtn","toggleDiaryBtn","resetDataBtn","exportProfileBtn","updateBtn","setLanguageManager","getRegistrationData","nameInput","genderSelect","trim","toggleCameraView","exportProfile","clearCache","chatBtn","toggleChat","loadTemplate","screenId","newScreen","lastElementChild","newElements","buttonsGroupId","section","targetScreen","diaryElem","onScrollLoadOlder","bind","passive","startRegistrationBtn","nextStepBtn","checkRegistrationValidity","nameValid","genderValid","goToApartmentPlanScreen","onclick","captureSelfie","completeBtn","completeRegistration","planNextBtn","group","targetGroup","td","shootBtn","chatContainer","languageContainer","updateSelfiePreview","imageData","selfiePreview","enableCompleteButton","disableCompleteButton","getSelfieSource","getImportFile","importFileInput","files","showGlobalCamera","hideGlobalCamera","showDiaryView","showPostButton","showCameraView","hidePostButton","isEnabled","gameFinalized","isActive","cameraBtn","classList","add","setShootButtonActive","startMirrorQuestUI","statusElem","statusElementId","shootButtonId","initialActive","onShoot","updateMirrorQuestStatus","success","stopMirrorQuestUI","startRepeatingQuestUI","stage","disableShootButton","stopRepeatingQuestUI","updateUIAfterQuestStage","postEnabled","cameraActive","shootActive","existing","topControls","background","arBtn","aiBtn","nightVisionBtn","blackWhiteBtn","clearFilterBtn","applyBackgroundTransition","color","duration","showGhostAppearanceEffect","ghostEffect","transform","backgroundSize","opacity","notification","bottom","setControlsBlocked","shouldBlock","regData","grayscaleData","selfieSrc","regDataStr","Boolean","importProfile","onConfirm","onCancel","selectElem","locationTypes","confirmBtn","emptyMessage","emptyDiv","rendered","full","idx","indexOf","textLines","slice","base64Line","entryWithImageTemplate","diaryEntryTemplate","limit","sort","b","latest","textPart","imgSrc","imgTag","html","renderFile","p","loadEarlierDiaryPosts","step","displayed","allEntries","nextChunk","threshold","innerHeight","scrollY","documentElement","scrollHeight","effectConfig","userText","speed","ghostText","playAudioWithStop","audioSrc","stopDelay","audio","Audio","play","pause","animateHTMLText","targetElem","audioObj","onChar","pos","currentHTML","isTag","tagBuffer","intervalId","char","triggerMirrorEffect","triggerGhostAppearanceEffect","triggerWhisperEffect","triggerGhostTextEffect","ghostSound","triggerUserTextEffect","pencilIcon","parentElem","parentElement","insertBefore","typeSound","loop","dummySpan","rectDummy","getBoundingClientRect","rectParent","slideUpPanel","panel","soundPath","offsetHeight","showControlsPanelForUnregistered","elem","textTargets","matches","effectType","animateEffect","rawText","BaseEffect","applyEffect","TypewriterEffect","json","triad","getImageData","pixels","avg","putImageData","pixelWiseComparison","img1","img2","decodeBase64","split","image1","image2","matchCount","len","abs","histogramComparison","hist1","createHistogram","hist2","diff","reduce","acc","val","totalPixels","sum","hist","fill","imgData","applyFilterToCanvas","save","clearRect","restore","sequenceList","reset","element","letters","letter","span","template","replace","match","trimmedKey","hasOwnProperty","templatePath","loadScript","script","async","deferredPrompt","installBtn","prompt","outcome","userChoice","register","reg","scope","waiting","newSW","installing","state"],"sourceRoot":""}