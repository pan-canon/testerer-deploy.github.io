<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face API Test</title>
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        video {
            width: 300px;
            border: 2px solid black;
        }
        #modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 2px solid black;
        }
    </style>
</head>
<body>

    <h1>Face API Test</h1>
    <video id="video" autoplay></video>
    <br>
    <button id="captureBtn">üì∏ Capture Selfie</button>
    <button id="compareBtn" disabled>üîç Compare Face</button>

    <div id="modal">
        <p id="modalText"></p>
        <button onclick="document.getElementById('modal').style.display = 'none'">Close</button>
    </div>

    <script>
        let selfieDescriptor = null;
        const video = document.getElementById('video');
        const captureBtn = document.getElementById('captureBtn');
        const compareBtn = document.getElementById('compareBtn');
        const modal = document.getElementById('modal');
        const modalText = document.getElementById('modalText');

        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
                video.srcObject = stream;
                console.log("‚úÖ –ö–∞–º–µ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞!");
            } catch (error) {
                console.error("üö® –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∫–∞–º–µ—Ä–µ:", error);
            }
        }

        async function loadModels() {
            console.log("‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π...");
            await faceapi.nets.ssdMobilenetv1.loadFromUri("https://cdn.jsdelivr.net/npm/face-api.js/weights");
            await faceapi.nets.faceLandmark68Net.loadFromUri("https://cdn.jsdelivr.net/npm/face-api.js/weights");
            await faceapi.nets.faceRecognitionNet.loadFromUri("https://cdn.jsdelivr.net/npm/face-api.js/weights");
            console.log("‚úÖ –ú–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!");
        }

        async function captureSelfie() {
            console.log("üì∏ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–ª—Ñ–∏...");
            const detections = await faceapi.detectSingleFace(video).withFaceLandmarks().withFaceDescriptor();
            
            if (!detections) {
                console.log("‚ùå –õ–∏—Ü–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!");
                return;
            }
            
            selfieDescriptor = detections.descriptor;
            compareBtn.disabled = false;
            console.log("‚úÖ –°–µ–ª—Ñ–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å.");
        }

        async function compareFace() {
            console.log("üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–∏—Ü...");
            if (!selfieDescriptor) {
                console.log("‚ùå –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–µ–ª—Ñ–∏!");
                return;
            }

            const detections = await faceapi.detectSingleFace(video).withFaceLandmarks().withFaceDescriptor();
            if (!detections) {
                console.log("‚ùå –õ–∏—Ü–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–∞–º–µ—Ä–µ!");
                return;
            }

            const distance = faceapi.euclideanDistance(selfieDescriptor, detections.descriptor);
            console.log("üìè –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:", distance);

            modal.style.display = "block";
            if (distance < 0.5) {
                modalText.textContent = "‚úÖ –í—ã –ø–µ—Ä–µ–¥ –∑–µ—Ä–∫–∞–ª–æ–º!";
            } else {
                modalText.textContent = "‚ùå –õ–∏—Ü–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!";
            }
        }

        captureBtn.addEventListener("click", captureSelfie);
        compareBtn.addEventListener("click", compareFace);

        loadModels().then(setupCamera);
    </script>

</body>
</html>
